{"version":3,"file":"doboard-widget-bundle.min.js","sources":["doboard-widget-bundle.js"],"sourcesContent":["const DOBOARD_API_URL = 'https://api-next.doboard.com';\n\nconst userConfirmEmailDoboard = async (emailConfirmationToken) => {\n    const response = await fetch(\n        `${DOBOARD_API_URL}/user_confirm_email?email_confirmation_token=${encodeURIComponent(emailConfirmationToken)}`,\n        { method: 'GET' }\n    );\n    if (!response.ok) {\n        throw new Error('Email confirmation failed');\n    }\n    const responseBody = await response.json();\n    if (!responseBody || !responseBody.data) {\n        throw new Error('Invalid response from server');\n    }\n    if (responseBody.data.operation_status !== 'CONFIRMED') {\n        throw new Error('Email not confirmed');\n    }\n    return {\n        sessionId: responseBody.data.session_id,\n        userId: responseBody.data.user_id,\n        email: responseBody.data.email,\n        accounts: responseBody.data.accounts,\n        operationStatus: responseBody.data.operation_status\n    };\n};\n\nconst createTaskDoboard = async (sessionId, taskDetails) => {\n    const accountId = taskDetails.accountId;\n    const formData = new FormData();\n    formData.append('session_id', sessionId);\n    formData.append('project_token', taskDetails.projectToken);\n    formData.append('project_id', taskDetails.projectId);\n    formData.append('user_id', localStorage.getItem('spotfix_user_id'));\n    formData.append('name', taskDetails.taskTitle);\n    formData.append('comment', taskDetails.taskDescription);\n    formData.append('meta', taskDetails.taskMeta);\n    formData.append('task_type', 'PUBLIC');\n    const response = await fetch(DOBOARD_API_URL + '/' + accountId + '/task_add', {\n        method: 'POST',\n        body: formData,\n    });\n\n    if (!response.ok) {\n        throw new Error('Failed to create task');\n    }\n\n    const responseBody = await response.json();\n\n    if ( ! responseBody || ! responseBody.data ) {\n        throw new Error('Invalid response from server');\n    }\n    if ( responseBody.data.operation_status === 'FAILED') {\n        throw new Error(responseBody.data.operation_message);\n    }\n    if ( responseBody.data.operation_status === 'SUCCESS' ) {\n        return {\n            taskId: responseBody.data.task_id,\n            isPublic: 1, //todo MOCK!\n        }\n    }\n    throw new Error('Unknown error occurred during creating task');\n};\n\nconst createTaskCommentDoboard = async (accountId, sessionId, taskId, comment, projectToken, status = 'ACTIVE') => {\n    const response = await fetch(\n        DOBOARD_API_URL + '/' + accountId + '/comment_add' +\n        '?session_id=' + sessionId +\n        '&task_id=' + taskId +\n        '&comment=' + comment +\n        '&project_token=' + projectToken +\n        '&status=' + status,\n    {\n        method: 'GET',\n    });\n\n\n    if (!response.ok) {\n        throw new Error('Failed to create task comment');\n    }\n\n    const responseBody = await response.json();\n\n    if (!responseBody || !responseBody.data) {\n        throw new Error('Invalid response from server');\n    }\n    if (responseBody.data.operation_status === 'FAILED') {\n        throw new Error(responseBody.data.operation_message);\n    }\n    if (responseBody.data.operation_status === 'SUCCESS') {\n        return {\n            commentId: responseBody.data.comment_id,\n        };\n    }\n    throw new Error('Unknown error occurred during creating task comment');\n};\n\nconst registerUserDoboard = async (projectToken, accountId, email, nickname, pageURL) => {\n    const formData = new FormData();\n    formData.append('project_token', projectToken);\n    formData.append('account_id', accountId);\n    formData.append('confirmation_url', pageURL);\n    if (email && nickname) {\n        formData.append('email', email);\n        formData.append('name', nickname);\n    }\n\n    const response = await fetch(DOBOARD_API_URL + '/user_registration', {\n        method: 'POST',\n        body: formData,\n    });\n\n    if ( ! response.ok ) {\n        throw new Error('Registration failed');\n    }\n\n    const responseBody = await response.json();\n\n    if ( ! responseBody || ! responseBody.data ) {\n        throw new Error('Invalid response from server');\n    }\n    if ( responseBody.data.operation_status === 'FAILED') {\n        throw new Error(responseBody.data.operation_message);\n    }\n    if ( responseBody.data.operation_status === 'SUCCESS' ) {\n        const result = {\n            sessionId: responseBody.data.session_id,\n            userId: responseBody.data.user_id,\n            email: responseBody.data.email,\n            accountExists: responseBody.data.user_email_confirmed === 1 ? true : false,\n            operationMessage: responseBody.data.operation_message,\n            operationStatus: responseBody.data.operation_status,\n            userEmailConfirmed: responseBody.data.user_email_confirmed,\n        };\n        return result;\n    }\n    throw new Error('Unknown error occurred during registration');\n};\n\nconst loginUserDoboard = async (email, password) => {\n    const formData = new FormData();\n    formData.append('email', email);\n    formData.append('password', password);\n\n    const response = await fetch(DOBOARD_API_URL + '/user_authorize', {\n        method: 'POST',\n        body: formData,\n    });\n\n    if ( ! response.ok ) {\n        throw new Error('Authorization failed');\n    }\n\n    const responseBody = await response.json();\n\n    if ( ! responseBody || ! responseBody.data ) {\n        throw new Error('Invalid response from server');\n    }\n    if ( responseBody.data.operation_status === 'FAILED') {\n        throw new Error(responseBody.data.operation_message);\n    }\n    if ( responseBody.data.operation_status === 'SUCCESS' ) {\n        return {\n            sessionId: responseBody.data.session_id,\n            userId: responseBody.data.user_id,\n            email: responseBody.data.email,\n            accountExists: responseBody.data.user_email_confirmed === 1 ? true : false,\n            operationMessage: responseBody.data.operation_message,\n            operationStatus: responseBody.data.operation_status,\n            userEmailConfirmed: responseBody.data.user_email_confirmed,\n        }\n    }\n    throw new Error('Unknown error occurred during registration');\n}\n\nconst getTasksDoboard = async (projectToken, sessionId, accountId, projectId, userId) => {\n    const formData = new FormData();\n    formData.append('project_token', projectToken);\n    formData.append('session_id', sessionId);\n    formData.append('project_id', projectId);\n    formData.append('status', 'ACTIVE');\n    formData.append('task_type', 'PUBLIC');\n    if ( userId ) {\n        formData.append('user_id', userId);\n    }\n    const response = await fetch(DOBOARD_API_URL + '/' + accountId + '/task_get', {\n        method: 'POST',\n        body: formData,\n    });\n\n    if ( ! response.ok ) {\n        throw new Error('Getting tasks failed');\n    }\n\n    const responseBody = await response.json();\n\n    if ( ! responseBody || ! responseBody.data ) {\n        throw new Error('Invalid response from server');\n    }\n    if ( responseBody.data.operation_status === 'FAILED') {\n        throw new Error(responseBody.data.operation_message);\n    }\n    if ( responseBody.data.operation_status === 'SUCCESS' ) {\n        return responseBody.data.tasks.map(task => ({\n            taskId: task.task_id,\n            taskTitle: task.name,\n            taskLastUpdate: task.updated,\n            taskCreated: task.created,\n            taskCreatorTaskUser: task.creator_user_id,\n            taskMeta: task.meta,\n        }))\n    }\n    throw new Error('Unknown error occurred during getting tasks');\n}\n\n\nconst getTasksCommentsDoboard = async (sessionId, accountId, projectToken, status = 'ACTIVE') => {\n    let url = DOBOARD_API_URL + '/' + accountId + '/comment_get' +\n        '?session_id=' + sessionId +\n        '&status=' + status +\n        '&project_token=' + projectToken;\n    const response = await fetch(url, {method: 'GET',});\n\n    if ( ! response.ok ) {\n        throw new Error('Getting logs failed');\n    }\n\n    const responseBody = await response.json();\n\n    if ( ! responseBody || ! responseBody.data ) {\n        throw new Error('Invalid response from server');\n    }\n    if ( responseBody.data.operation_status === 'FAILED') {\n        throw new Error(responseBody.data.operation_message);\n    }\n    if ( responseBody.data.operation_status === 'SUCCESS' ) {\n        return responseBody.data.comments.map(comment => ({\n            taskId: comment.task_id,\n            commentId: comment.comment_id,\n            userId: comment.user_id,\n            comment: comment.comment,\n            commentBody: comment.comment_text,\n            commentDate: comment.updated,\n            status: comment.status,\n            issueTitle: comment.task_name,\n        }));\n    }\n    throw new Error('Unknown error occurred during getting comments');\n};\n\nconst getUserDoboard = async (sessionId, projectToken, accountId) => {\n    const response = await fetch(DOBOARD_API_URL + '/' + accountId + '/user_get' +\n        '?session_id=' + sessionId +\n        '&project_token=' + projectToken, {\n        method: 'GET',\n    });\n\n    if (!response.ok) {\n        throw new Error('Getting user failed');\n    }\n\n    const responseBody = await response.json();\n\n    if (!responseBody) {\n        throw new Error('Invalid response from server');\n    }\n    // Format 1: users inside data\n    if (responseBody.data && responseBody.data.operation_status) {\n        if (responseBody.data.operation_status === 'FAILED') {\n            throw new Error(responseBody.data.operation_message);\n        }\n        if (responseBody.data.operation_status === 'SUCCESS') {\n            if (Array.isArray(responseBody.data.users)) {\n                return responseBody.data.users;\n            }\n            return [];\n        }\n    }\n    // Format 2: users at the top level\n    if (responseBody.operation_status) {\n        if (responseBody.operation_status === 'FAILED') {\n            throw new Error(responseBody.operation_message);\n        }\n        if (responseBody.operation_status === 'SUCCESS') {\n            if (Array.isArray(responseBody.users)) {\n                return responseBody.users;\n            }\n            return [];\n        }\n    }\n    throw new Error('Unknown error occurred during getting user');\n};\n\nconst userUpdateDoboard = async (projectToken, accountId, sessionId, userId, timezone) => {\n    const response = await fetch(DOBOARD_API_URL + '/' + accountId + '/user_update' +\n        '?session_id=' + sessionId +\n        '&project_token=' + projectToken +\n        '&user_id=' + userId +\n        '&timezone=' + timezone, {\n        method: 'GET',\n    });\n\n    if (!response.ok) {\n        throw new Error('User update failed');\n    }\n\n    const responseBody = await response.json();\n\n    if (!responseBody || !responseBody.data) {\n        throw new Error('Invalid response from server');\n    }\n    if (responseBody.data.operation_status === 'FAILED') {\n        throw new Error(responseBody.data.operation_message);\n    }\n    if (responseBody.data.operation_status === 'SUCCESS') {\n        return {\n            success: true\n        };\n    }\n    throw new Error('Unknown error occurred during user update');\n}\n\nasync function confirmUserEmail(emailConfirmationToken, params) {\n\tconst result = await userConfirmEmailDoboard(emailConfirmationToken);\n\t// Save session data to LS\n\tlocalStorage.setItem('spotfix_email', result.email);\n\tlocalStorage.setItem('spotfix_session_id', result.sessionId);\n\tlocalStorage.setItem('spotfix_user_id', result.userId);\n\n\t// Get pending task from LS\n\tconst pendingTaskRaw = localStorage.getItem('spotfix_pending_task');\n\tif (!pendingTaskRaw) throw new Error('No pending task data');\n\tconst pendingTask = JSON.parse(pendingTaskRaw);\n\n\t// Form taskDetails for task creation\n\tconst taskDetails = {\n\t\ttaskTitle: pendingTask.selectedText || 'New Task',\n\t\ttaskDescription: pendingTask.description || '',\n\t\tselectedData: pendingTask,\n\t\tprojectToken: params.projectToken,\n\t\tprojectId: params.projectId,\n\t\taccountId: params.accountId,\n\t\ttaskMeta: JSON.stringify(pendingTask)\n\t};\n\n\t// Create task\n\tconst createdTask = await handleCreateTask(result.sessionId, taskDetails);\n\t// Clear pending task\n\tlocalStorage.removeItem('spotfix_pending_task');\n\n\t// Return created task\n\treturn createdTask;\n}\n\nasync function getTasksFullDetails(params, tasks) {\n    if (tasks.length > 0) {\n        const sessionId = localStorage.getItem('spotfix_session_id');\n        const comments = await getTasksCommentsDoboard(sessionId, params.accountId, params.projectToken);\n        const users = await getUserDoboard(sessionId, params.projectToken, params.accountId);\n\n        return {\n            comments: comments,\n            users: users,\n        };\n    }\n}\n\nasync function handleCreateTask(sessionId, taskDetails) {\n\ttry {\n\t\tconst result = await createTaskDoboard(sessionId, taskDetails);\n\t\tif (result && result.taskId && taskDetails.taskDescription) {\n\t\t\tawait addTaskComment({\n\t\t\t\tprojectToken: taskDetails.projectToken,\n\t\t\t\taccountId: taskDetails.accountId\n\t\t\t}, result.taskId, taskDetails.taskDescription);\n\t\t}\n\t\treturn result;\n\t} catch (err) {\n\t\tthrow err;\n\t}\n}\n\nasync function addTaskComment(params, taskId, commentText) {\n\tconst sessionId = localStorage.getItem('spotfix_session_id');\n\tif (!sessionId) throw new Error('No session');\n\tif (!params.projectToken || !params.accountId) throw new Error('Missing params');\n\treturn await createTaskCommentDoboard(params.accountId, sessionId, taskId, commentText, params.projectToken);\n}\n\nfunction getUserTasks(params) {\n\tif (!localStorage.getItem('spotfix_session_id')) {\n\t\treturn {};\n\t}\n\tconst projectToken = params.projectToken;\n\tconst sessionId = localStorage.getItem('spotfix_session_id');\n\tconst userId = localStorage.getItem('spotfix_user_id');\n\treturn getTasksDoboard(projectToken, sessionId, params.accountId, params.projectId, userId);\n}\n\nasync function getAllTasks(params) {\n\tif (!localStorage.getItem('spotfix_session_id')) {\n\t\treturn {};\n\t}\n\tconst projectToken = params.projectToken;\n\tconst sessionId = localStorage.getItem('spotfix_session_id');\n\tconst tasksData = await getTasksDoboard(projectToken, sessionId, params.accountId, params.projectId);\n\n    // Get only tasks with metadata\n\tconst filteredTaskData =  tasksData.filter(task => {\n        return task.taskMeta;\n    });\n\n    return filteredTaskData;\n}\n\nfunction formatDate(dateStr) {\n\t const months = [\n\t \t\"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\n\t \t\"July\", \"August\", \"September\", \"October\", \"November\", \"December\"\n\t ];\n\t // dateStr expected format: 'YYYY-MM-DD HH:mm:ss' or 'YYYY-MM-DDTHH:mm:ssZ'\n\t if (!dateStr) return { date: '', time: '' };\n\t let dateObj;\n\t if (dateStr.includes('T')) {\n\t  dateObj = new Date(dateStr);\n\t } else if (dateStr.includes(' ')) {\n\t  dateObj = new Date(dateStr.replace(' ', 'T'));\n\t } else {\n\t  dateObj = new Date(dateStr);\n\t }\n\t if (isNaN(dateObj.getTime())) return { date: '', time: '' };\n\n\t // Adjust to local timezone\n\t const offsetMinutes = dateObj.getTimezoneOffset();\n\t let localDateObj = new Date(dateObj.getTime() - offsetMinutes * 60000);\n\n\t const month = months[localDateObj.getMonth()];\n\t const day = localDateObj.getDate();\n\t const date = `${month} ${day}`;\n\t const hours = localDateObj.getHours().toString().padStart(2, '0');\n\t const minutes = localDateObj.getMinutes().toString().padStart(2, '0');\n\t const time = `${hours}:${minutes}`;\n\t return { date, time };\n}\n\nfunction getTaskAuthorDetails(params, taskId) {\n\tconst sessionId = localStorage.getItem('spotfix_session_id');\n\tconst mockUsersData =\n\t\t[\n\t\t\t{\n\t\t\t\t'taskId': '1',\n\t\t\t\t'taskAuthorAvatarImgSrc': 'https://s3.eu-central-1.amazonaws.com/cleantalk-ctask-atts/accounts/1/avatars/081a1b65d20fe318/m.jpg',\n\t\t\t\t'taskAuthorName': 'Test All Issues Single Author Name'\n\t\t\t}\n\t\t]\n\n\tconst defaultData =\n\t\t{\n\t\t\t'taskId': null,\n\t\t\t'taskAuthorAvatarImgSrc': null,\n\t\t\t'taskAuthorName': 'Task Author'\n\t\t};\n\n\tconst data = mockUsersData.find((element) => element.taskId === taskId);\n\treturn data === undefined ? defaultData : data;\n}\n\nfunction getIssuesCounterString(onPageSpotsCount, totalSpotsCount) {\n\treturn `(${onPageSpotsCount}/${totalSpotsCount})`;\n}\n\n// Get the author's avatar\nfunction getAvatarSrc(author) {\n\tif (author && author.avatar) {\n\t\tif (typeof author.avatar === 'object' && author.avatar.m) {\n\t\t\treturn author.avatar.m;\n\t\t} else if (typeof author.avatar === 'string') {\n\t\t\treturn author.avatar;\n\t\t}\n\t}\n\treturn null;\n}\n\n// Get the author's name\nfunction getAuthorName(author) {\n\tif (author) {\n\t\tif (author.name && author.name.trim().length > 0) {\n\t\t\treturn author.name;\n\t\t} else if (author.email && author.email.trim().length > 0) {\n\t\t\treturn author.email;\n\t\t}\n\t}\n\treturn 'Unknown Author';\n}\n\nfunction registerUser(taskDetails) {\n\tconst userEmail = taskDetails.userEmail;\n\tconst userName = taskDetails.userName;\n\tconst projectToken = taskDetails.projectToken;\n\tconst accountId = taskDetails.accountId;\n\tconst pageURL = taskDetails.selectedData.pageURL ? taskDetails.selectedData.pageURL : window.location.href;\n\n\tconst resultRegisterUser = (showMessageCallback) => registerUserDoboard(projectToken, accountId, userEmail, userName, pageURL)\n\t\t.then(response => {\n\t\t\tif (response.accountExists) {\n\t\t\t\tdocument.querySelector(\".doboard_task_widget-accordion>.doboard_task_widget-input-container\").innerText = 'Account already exists. Please, login usin your password.';\n\t\t\t\tdocument.querySelector(\".doboard_task_widget-accordion>.doboard_task_widget-input-container.hidden\").classList.remove('hidden');\n\t\t\t\tdocument.getElementById(\"doboard_task_widget-user_password\").focus();\n\t\t\t} else if (response.sessionId) {\n\t\t\t\tlocalStorage.setItem('spotfix_session_id', response.sessionId);\n\t\t\t\tlocalStorage.setItem('spotfix_user_id', response.userId);\n\t\t\t\tlocalStorage.setItem('spotfix_email', response.email);\n\t\t\t\tuserUpdate(projectToken, accountId);\n\t\t\t} else if (response.operationStatus === 'SUCCESS' && response.operationMessage && response.operationMessage.length > 0) {\n\t\t\t\tif (response.operationMessage == 'Waiting for email confirmation') {\n\t\t\t\t\tresponse.operationMessage = 'Waiting for an email confirmation. Please check your Inbox.';\n\t\t\t\t}\n\t\t\t\tif (typeof showMessageCallback === 'function') {\n\t\t\t\t\tshowMessageCallback(response.operationMessage, 'notice');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthrow new Error('Session ID not found in response');\n\t\t\t}\n\t\t})\n\t\t.catch(error => {\n\t\t\tthrow error;\n\t\t});\n\n\t\treturn resultRegisterUser;\n}\n\nfunction loginUser(taskDetails) {\n\tconst userEmail = taskDetails.userEmail;\n\tconst userPassword = taskDetails.userPassword;\n\n\treturn (showMessageCallback) => loginUserDoboard(userEmail, userPassword)\n\t\t.then(response => {\n\t\t\tif (response.sessionId) {\n\t\t\t\tlocalStorage.setItem('spotfix_session_id', response.sessionId);\n\t\t\t\tlocalStorage.setItem('spotfix_user_id', response.userId);\n\t\t\t\tlocalStorage.setItem('spotfix_email', response.email);\n\t\t\t}  else if (response.operationStatus === 'SUCCESS' && response.operationMessage && response.operationMessage.length > 0) {\n\t\t\t\tif (typeof showMessageCallback === 'function') {\n\t\t\t\t\tshowMessageCallback(response.operationMessage, 'notice');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthrow new Error('Session ID not found in response');\n\t\t\t}\n\t\t})\n\t\t.catch(error => {\n\t\t\tthrow error;\n\t\t});\n}\n\nfunction userUpdate(projectToken, accountId) {\n\tconst sessionId = localStorage.getItem('spotfix_session_id');\n\tconst userId = localStorage.getItem('spotfix_user_id');\n\tconst timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n\n\treturn userUpdateDoboard(projectToken, accountId, sessionId, userId, timezone);\n}\n\n/**\n * Widget class to create a task widget\n */\nclass CleanTalkWidgetDoboard {\n    selectedText = '';\n    selectedData = {};\n    widgetElement = null;\n    params = {};\n    currentActiveTaskId = 0;\n    savedIssuesQuantityOnPage = 0;\n    savedIssuesQuantityAll = 0;\n    allTasksData = {};\n\n    /**\n     * Constructor\n     */\n    constructor(selectedData, type) {\n        this.selectedData = selectedData;\n        this.selectedText = selectedData.selectedText;\n        this.init(type);\n    }\n\n    /**\n     * Initialize the widget\n     */\n    async init(type) {\n        this.params = this.getParams();\n\n        // Check if email_confirmation_token is in URL\n        const urlParams = new URLSearchParams(window.location.search);\n        const emailToken = urlParams.get('email_confirmation_token');\n        if (emailToken) {\n            try {\n                // Confirm email and create task\n                const createdTask = await confirmUserEmail(emailToken, this.params);\n                this.allTasksData = await getAllTasks(this.params);\n                // Open task interface\n                this.currentActiveTaskId = createdTask.taskId;\n                type = 'concrete_issue';\n                storageSetWidgetIsClosed(false);\n                // Clear email_confirmation_token from URL\n                urlParams.delete('email_confirmation_token');\n                const newUrl = window.location.pathname + (urlParams.toString() ? '?' + urlParams.toString() : '');\n                window.history.replaceState({}, document.title, newUrl);\n            } catch (err) {\n                this.registrationShowMessage('Error confirming email: ' + err.message, 'error');\n            }\n        } else {\n            // Load all tasks\n            this.allTasksData = await getAllTasks(this.params);\n        }\n\n        // Check if any task has updates\n        let taskHasSiteOwnerUpdate;\n\n        if (storageTasksHasUnreadUpdates()) {\n            taskHasSiteOwnerUpdate = true;\n        } else {\n            if (type === 'wrap') {\n                taskHasSiteOwnerUpdate = await checkIfTasksHasSiteOwnerUpdates(\n                    this.allTasksData,\n                    this.params\n                );\n            }\n        }\n        storageSaveTasksUpdateData(this.allTasksData);\n        //check to hide on first run\n        if (!storageWidgetCloseIsSet()) {\n            storageSetWidgetIsClosed(true);\n        }\n        //check to show if any task has site owner updates\n        if (taskHasSiteOwnerUpdate) {\n            storageSetWidgetIsClosed(false);\n        }\n        this.widgetElement = await this.createWidgetElement(type);\n        this.bindWidgetInputsInteractive();\n    }\n\n    getParams() {\n        const script = document.querySelector(`script[src*=\"doboard-widget-bundle.min.js\"]`);\n        if ( ! script || ! script.src ) {\n            throw new Error('Script not provided');\n        }\n\n        const url = new URL(script.src);\n        let params = Object.fromEntries(url.searchParams.entries());\n        if ( ! params ) {\n            throw new Error('Script params not provided');\n        }\n        if ( ! params.projectToken || ! params.accountId || ! params.projectId ) {\n            throw new Error('Necessary script params not provided');\n\n        }\n        return params;\n    }\n\n    /**\n     * Binding events to create a task\n     */\n    bindCreateTaskEvents() {\n        const submitButton = document.getElementById('doboard_task_widget-submit_button');\n\n        if (submitButton) {\n            submitButton.addEventListener('click', async () => {\n                // Check required fields: Report about and Description\n                const taskTitleElement = document.getElementById('doboard_task_widget-title');\n                const taskTitle = taskTitleElement.value;\n                if ( ! taskTitle ) {\n                    taskTitleElement.style.borderColor = 'red';\n                    taskTitleElement.focus();\n                    taskTitleElement.addEventListener('input', function() {\n                        this.style.borderColor = '';\n                    });\n                    return;\n                }\n                const taskDescriptionElement = document.getElementById('doboard_task_widget-description')\n                const taskDescription = taskDescriptionElement.value;\n                if ( ! taskDescription ) {\n                    taskDescriptionElement.style.borderColor = 'red';\n                    taskDescriptionElement.focus();\n                    taskDescriptionElement.addEventListener('input', function() {\n                        this.style.borderColor = '';\n                    });\n                    return;\n                }\n\n                // If login section is open, check required fields: Nickname, Email\n                let userName = '';\n                let userEmail = '';\n                let userPassword = '';\n                const loginSectionElement = document.querySelector('.doboard_task_widget-login');\n\n                if ( loginSectionElement && loginSectionElement.classList.contains('active') ) {\n                    const userEmailElement = document.getElementById('doboard_task_widget-user_email');\n                    const userNameElement = document.getElementById('doboard_task_widget-user_name');\n                    const userPasswordElement = document.getElementById('doboard_task_widget-user_password');\n\n                    userEmail = userEmailElement.value;\n                    if ( ! userEmail ) {\n                        userEmailElement.style.borderColor = 'red';\n                        userEmailElement.focus();\n                        userEmailElement.addEventListener('input', function() {\n                            this.style.borderColor = '';\n                        });\n                        return;\n                    }\n\n                    // This is the registration request\n                    if ( userEmailElement && userNameElement ) {\n                        userName = userNameElement.value;\n                        if ( ! userName ) {\n                            userNameElement.style.borderColor = 'red';\n                            userNameElement.focus();\n                            userNameElement.addEventListener('input', function() {\n                                this.style.borderColor = '';\n                            });\n                            return;\n                        }\n                    }\n\n                    // This is the login request\n                    if ( userEmailElement && userPasswordElement && ! userNameElement ) {\n                        userPassword = userPasswordElement.value;\n                        if ( ! userPassword ) {\n                            userPasswordElement.style.borderColor = 'red';\n                            userPasswordElement.focus();\n                            userPasswordElement.addEventListener('input', function() {\n                                this.style.borderColor = '';\n                            });\n                            return;\n                        }\n                    }\n\n                }\n\n                // If it is the login request\n                const userEmailElement = document.getElementById('doboard_task_widget-user_email');\n                userEmail = userEmailElement.value;\n\n                // Make the submit button disable with spinner\n                const submitButton = document.getElementById('doboard_task_widget-submit_button');\n                submitButton.disabled = true;\n                submitButton.innerText = 'Creating spot...';\n\n                let taskDetails = {\n                    taskTitle: taskTitle,\n                    taskDescription: taskDescription,\n                    //typeSend: typeSend,\n                    selectedData: this.selectedData,\n                    projectToken: this.params.projectToken,\n                    projectId: this.params.projectId,\n                    accountId: this.params.accountId,\n                    taskMeta: JSON.stringify(this.selectedData),\n                };\n                if ( userEmail ) {\n                    taskDetails.userEmail = userEmail\n                }\n                if ( userName ) {\n                    taskDetails.userName = userName\n                }\n                if ( userPassword ) {\n                    taskDetails.userPassword = userPassword\n                }\n\n                // Save pending task in LS\n                localStorage.setItem('spotfix_pending_task', JSON.stringify({\n                    ...this.selectedData,\n                    description: taskDescription\n                }));\n\n                let submitTaskResult;\n                try {\n                    submitTaskResult = await this.submitTask(taskDetails);\n                } catch (error) {\n                    this.registrationShowMessage(error.message);\n                    return;\n                }\n\n                // Return the submit button normal state\n                submitButton.disabled = false;\n                submitButton.style.cursor = 'pointer';\n\n                if ( submitTaskResult.needToLogin ) {\n                    // @ToDo Do not know what to de here: throw an error or pass log message?\n                    return;\n                }\n\n                if ( submitTaskResult.isPublic !== undefined ) {\n                    this.selectedData.isPublic = submitTaskResult.isPublic\n                }\n\n                // refersh tasks list after creation\n                this.allTasksData = await getAllTasks(this.params);\n                // save updates\n                storageSaveTasksUpdateData(this.allTasksData);\n\n                this.selectedData = {};\n                await this.createWidgetElement('all_issues');\n                storageSetWidgetIsClosed(false);\n                hideContainersSpinner(false);\n            });\n        }\n    }\n\n    /**\n     * Create widget element\n     * @return {HTMLElement} widget element\n     */\n    async createWidgetElement(type, showOnlyCurrentPage = true) {\n        const widgetContainer = document.querySelector('.doboard_task_widget') ? document.querySelector('.doboard_task_widget') : document.createElement('div');\n        widgetContainer.className = 'doboard_task_widget';\n        widgetContainer.innerHTML = '';\n        widgetContainer.removeAttribute('style');\n\n        let templateName = '';\n        let variables = {};\n        let tasksFullDetails;\n\n        switch (type) {\n            case 'create_issue':\n                templateName = 'create_issue';\n                variables = {\n                    selectedText: this.selectedText,\n                    currentDomain: document.location.hostname || ''\n                };\n                storageGetUserIsDefined() && storageSetWidgetIsClosed(false);\n                break;\n            case 'wrap':\n                if (storageGetWidgetIsClosed()) {\n                    return;\n                }\n                templateName = 'wrap';\n                break;\n            case 'all_issues':\n                templateName = 'all_issues';\n                break;\n            case 'concrete_issue':\n                templateName = 'concrete_issue';\n                // Update the number of tasks\n                this.savedIssuesQuantityAll = Array.isArray(this.allTasksData) ? this.allTasksData.length : 0;\n                // Calculate the number of issues on the current page\n                this.savedIssuesQuantityOnPage = Array.isArray(this.allTasksData)\n                    ? this.allTasksData.filter(task => {\n                        try {\n                            const meta = task.taskMeta ? JSON.parse(task.taskMeta) : {};\n                            return meta.pageURL === window.location.href;\n                        } catch (e) { return false; }\n                    }).length\n                    : 0;\n                variables = {\n                    issueTitle: '...',\n                    issuesCounter: getIssuesCounterString(this.savedIssuesQuantityOnPage, this.savedIssuesQuantityAll),\n                    paperclipImgSrc: '/spotfix/img/send-message--paperclip.svg',\n                    sendButtonImgSrc: '/spotfix/img/send-message--button.svg',\n                    msgFieldBackgroundImgSrc: '/spotfix/img/send-message--input-background.svg',\n                };\n                break;\n            default:\n                break;\n        }\n        widgetContainer.innerHTML = await this.loadTemplate(templateName, variables);\n        document.body.appendChild(widgetContainer);\n\n        // remove highlights before any screen called\n        this.removeHighlights();\n\n        switch (type) {\n            case 'create_issue':\n                // highlight selected item during task creation\n                const selection = window.getSelection();\n                if (\n                    selection.type === 'Range'\n                ) {\n                    const selectedData = getSelectedData(selection);\n                    this.highlightElements([selectedData]);\n                    scrollToNodePath(selectedData.nodePath);\n                }\n                // bind creation events\n                this.bindCreateTaskEvents();\n                break;\n            case 'wrap':\n                await this.getTaskCount();\n                document.querySelector('.doboard_task_widget-wrap').addEventListener('click', (e) => {\n                    const widgetElementClasses = e.currentTarget.classList;\n                    if (widgetElementClasses && !widgetElementClasses.contains('hidden')) {\n                        this.createWidgetElement('all_issues');\n                    }\n                });\n                hideContainersSpinner(false);\n                break;\n            case 'all_issues':\n                this.removeHighlights();\n                let issuesQuantityOnPage = 0;\n                let tasks = this.allTasksData;\n                tasksFullDetails = await getTasksFullDetails(this.params, tasks);\n                let spotsToBeHighlighted = [];\n                if (tasks.length > 0) {\n                    document.querySelector(\".doboard_task_widget-all_issues-container\").innerHTML = '';\n                    for (let i = 0; i < tasks.length; i++) {\n                        const elTask = tasks[i];\n\n                        // Data from api\n                        const taskId = elTask.taskId;\n                        const taskTitle = elTask.taskTitle;\n                        const taskMetaString = elTask.taskMeta;\n                        const taskData = taskMetaString ? JSON.parse(taskMetaString) : null;\n                        const currentPageURL = taskData ? taskData.pageURL : '';\n                        const taskNodePath = taskData ? taskData.nodePath : '';\n\n                        // Define publicity details\n                        let taskPublicStatusImgSrc = '';\n                        let taskPublicStatusHint = 'Task publicity is unknown'\n                        if (taskData && taskData.isPublic !== undefined) {\n                            if (taskData.isPublic) {\n                                taskPublicStatusImgSrc = '/spotfix/img/public.svg';\n                                taskPublicStatusHint = 'The task is public';\n                            } else {\n                                taskPublicStatusImgSrc = '/spotfix/img/private.svg';\n                                taskPublicStatusHint = 'The task is private and visible only for registered DoBoard users';\n                            }\n                        }\n\n                        if (!showOnlyCurrentPage || currentPageURL === window.location.href) {\n                            issuesQuantityOnPage++;\n\n                            const taskFullDetails = getTaskFullDetails(tasksFullDetails, taskId)\n\n                            const avatarData = getAvatarData(taskFullDetails);\n                            const variables = {\n                                taskTitle: taskTitle || '',\n                                taskAuthorAvatarImgSrc: taskFullDetails.taskAuthorAvatarImgSrc,\n                                taskAuthorName: taskFullDetails.taskAuthorName,\n                                taskPublicStatusImgSrc: taskPublicStatusImgSrc,\n                                taskPublicStatusHint: taskPublicStatusHint,\n                                taskLastMessage: taskFullDetails.lastMessageText,\n                                taskLastUpdate: taskFullDetails.lastMessageTime,\n                                nodePath: taskNodePath,\n                                taskId: taskId,\n                                avatarCSSClass: avatarData.avatarCSSClass,\n                                avatarStyle: avatarData.avatarStyle,\n                                taskAuthorInitials: avatarData.taskAuthorInitials,\n                                initialsClass: avatarData.initialsClass,\n                                classUnread: ''\n                            };\n                            const taskOwnerReplyIsUnread = storageProvidedTaskHasUnreadUpdates(taskFullDetails.taskId);\n                            if (taskOwnerReplyIsUnread) {\n                                variables.classUnread = 'unread';\n                            }\n                            document.querySelector(\".doboard_task_widget-all_issues-container\").innerHTML += await this.loadTemplate('list_issues', variables);\n\n                            spotsToBeHighlighted.push(taskData);\n                        }\n                    }\n                    this.savedIssuesQuantityOnPage = issuesQuantityOnPage;\n                    this.savedIssuesQuantityAll = tasks.length;\n                    this.highlightElements(spotsToBeHighlighted);\n                    document.querySelector('.doboard_task_widget-header span').innerText += ' ' + getIssuesCounterString(this.savedIssuesQuantityOnPage, this.savedIssuesQuantityAll);\n                }\n                if (tasks.length === 0 || issuesQuantityOnPage === 0) {\n                    document.querySelector(\".doboard_task_widget-all_issues-container\").innerHTML = '<div class=\"doboard_task_widget-issues_list_empty\">The issues list is empty</div>';\n                }\n\n                // Bind the click event to the task elements for scrolling to the selected text and Go to concrete issue interface by click issue-item row\n                this.bindIssuesClick();\n                hideContainersSpinner(false);\n                break;\n\n            case 'concrete_issue':\n\n                tasksFullDetails = await getTasksFullDetails(this.params, this.allTasksData);\n                const taskDetails = await getTaskFullDetails(tasksFullDetails, this.currentActiveTaskId);\n\n                // Update issue title in the interface\n                const issueTitleElement = document.querySelector('.doboard_task_widget-issue-title');\n                if (issueTitleElement) {\n                    issueTitleElement.innerText = taskDetails.issueTitle;\n                }\n\n                variables = {\n                    issueTitle: taskDetails.issueTitle,\n                    issueComments: taskDetails.issueComments,\n                    issuesCounter: getIssuesCounterString(this.savedIssuesQuantityOnPage, this.savedIssuesQuantityAll),\n                    paperclipImgSrc: '/spotfix/img/send-message--paperclip.svg',\n                    sendButtonImgSrc: '/spotfix/img/send-message--button.svg',\n                    msgFieldBackgroundImgSrc: '/spotfix/img/send-message--input-background.svg',\n                };\n\n                widgetContainer.innerHTML = await this.loadTemplate('concrete_issue', variables);\n                document.body.appendChild(widgetContainer);\n\n                // Highlight the task's selected text\n                let nodePath = null;\n                    const currentTaskData = this.allTasksData.find((element) => String(element.taskId) === String(taskDetails.taskId));\n                    let meta = null;\n                    if (currentTaskData && currentTaskData.taskMeta) {\n                        try {\n                            meta = JSON.parse(currentTaskData.taskMeta);\n                            nodePath = meta.nodePath || null;\n                        } catch (e) { nodePath = null; meta = null; }\n                    }\n                    // remove old highlights before adding new ones\n                    this.removeHighlights();\n                    if (meta && nodePath) {\n                        // Pass the task meta object as an array\n                        this.highlightElements([meta]);\n                        if (typeof scrollToNodePath === 'function') {\n                            scrollToNodePath(nodePath);\n                        }\n                    }\n\n                const issuesCommentsContainer = document.querySelector('.doboard_task_widget-concrete_issues-container');\n                let dayMessagesData = [];\n                const initIssuerID = localStorage.getItem('spotfix_user_id');\n                let userIsIssuer = false;\n                if ( taskDetails.issueComments.length > 0 ) {\n                    storageRemoveUnreadUpdateForTaskID(taskDetails.taskId);\n                    issuesCommentsContainer.innerHTML = '';\n                    for (const comment of taskDetails.issueComments) {\n                        userIsIssuer = Number(initIssuerID) === Number(comment.commentUserId);\n                        const avatarData = getAvatarData({\n                            taskAuthorAvatarImgSrc: comment.commentAuthorAvatarSrc,\n                            taskAuthorName: comment.commentAuthorName,\n                            userIsIssuer: userIsIssuer\n                        });\n                        const commentData = {\n                            commentAuthorName: comment.commentAuthorName,\n                            commentBody: comment.commentBody,\n                            commentDate: comment.commentDate,\n                            commentTime: comment.commentTime,\n                            issueTitle: variables.issueTitle,\n                            commentContainerBackgroundSrc: userIsIssuer\n                                ? '/spotfix/img/comment-self-background.png'\n                                : '/spotfix/img/comment-other-background.png',\n                            avatarCSSClass: avatarData.avatarCSSClass,\n                            avatarStyle: avatarData.avatarStyle,\n                            taskAuthorInitials: avatarData.taskAuthorInitials,\n                            initialsClass: avatarData.initialsClass\n                        };\n                        if (dayMessagesData[comment.commentDate] === undefined) {\n                            dayMessagesData[comment.commentDate] = [];\n                            dayMessagesData[comment.commentDate].push(commentData);\n                        } else {\n                            dayMessagesData[comment.commentDate].push(commentData);\n                        }\n                    }\n                    let daysWrapperHTML = '';\n                    for (const day in dayMessagesData) {\n                        let currentDayMessages = dayMessagesData[day];\n                        let dayMessagesWrapperHTML = '';\n                        currentDayMessages.sort((a, b) => a.commentTime.localeCompare(b.commentTime));\n                        for (const messageId in currentDayMessages) {\n                            let currentMessageData = currentDayMessages[messageId];\n                            dayMessagesWrapperHTML += await this.loadTemplate('concrete_issue_messages', currentMessageData);\n                        }\n                        daysWrapperHTML += await this.loadTemplate('concrete_issue_day_content', {dayContentMonthDay: day, dayContentMessages: dayMessagesWrapperHTML});\n                    }\n                    issuesCommentsContainer.innerHTML = daysWrapperHTML;\n                } else {\n                    issuesCommentsContainer.innerHTML = 'No comments';\n                }\n\n                // Hide spinner preloader\n                hideContainersSpinner();\n\n                // Scroll to the bottom comments\n                setTimeout(() => {\n                    const contentContainer = document.querySelector('.doboard_task_widget-content');\n                    contentContainer.scrollTo({\n                        top: contentContainer.scrollHeight,\n                        behavior: 'smooth'\n                    });\n                }, 0);\n\n                const sendForm = document.querySelector('.doboard_task_widget-send_message form');\n                if (sendForm) {\n                    sendForm.addEventListener('submit', async (e) => {\n                        e.preventDefault();\n                        const input = sendForm.querySelector('.doboard_task_widget-send_message_input');\n                        const commentText = input.value.trim();\n                        if (!commentText) return;\n                        input.disabled = true;\n                        try {\n                            await addTaskComment(this.params, this.currentActiveTaskId, commentText);\n                            input.value = '';\n                            await this.createWidgetElement('concrete_issue');\n                            hideContainersSpinner(false);\n                        } catch (err) {\n                            alert('Error when adding a comment: ' + err.message);\n                        }\n                        input.disabled = false;\n                    });\n                }\n                break;\n\n            default:\n                break;\n        }\n\n        const backToAllIssuesController = document.querySelector('.doboard_task_widget_return_to_all');\n        const widgetClass = this;\n        if ( backToAllIssuesController ) {\n            backToAllIssuesController.addEventListener('click', function(e, self = widgetClass) {\n                self.createWidgetElement('all_issues');\n            });\n        }\n\n        const paperclipController = document.querySelector('.doboard_task_widget-send_message_paperclip');\n        if ( paperclipController ) {\n            paperclipController.addEventListener('click', function(e) {\n                e.preventDefault();\n                alert('This action is not implemented yet..');\n            });\n        }\n\n        document.querySelector('.doboard_task_widget-close_btn')?.addEventListener('click', () => {\n            this.hide();\n        }) || '';\n\n        document.querySelector('#doboard_task_widget-task_count')?.addEventListener('click', () => {\n            const widget = document.querySelector('.doboard_task_widget-wrap');\n            widget.classList.add('hidden');\n            storageSetWidgetIsClosed(true);\n        }) || '';\n\n        return widgetContainer;\n    }\n\n    bindIssuesClick() {\n        document.querySelectorAll('.issue-item').forEach(item => {\n            item.addEventListener('click', async () => {\n                const nodePath = JSON.parse(item.getAttribute('data-node-path'));\n                scrollToNodePath(nodePath);\n                this.currentActiveTaskId = item.getAttribute('data-task-id');\n                await this.createWidgetElement('concrete_issue');\n\n                const taskHighlightData = this.getTaskHighlightData(this.currentActiveTaskId)\n\n                if (taskHighlightData) {\n                    this.removeHighlights();\n                    this.highlightElements([taskHighlightData])\n                    this.positionWidgetContainer();\n                }\n\n                hideContainersSpinner(false);\n            });\n        });\n    }\n\n    /**\n     * Load the template\n     *\n     * @param templateName\n     * @param variables\n     * @return {Promise<string>}\n     * @ToDo have to refactor templates loaded method: need to be templates included into the bundle\n     *\n     */\n    async loadTemplate(templateName, variables = {}) {\n        const response = await fetch(`/spotfix/templates/${templateName}.html`);\n        let template = await response.text();\n\n        const escapeHtml = (unsafe) => {\n            return unsafe\n                .replace(/&/g, \"&amp;\")\n                .replace(/</g, \"&lt;\")\n                .replace(/>/g, \"&gt;\")\n                .replace(/\"/g, \"&quot;\")\n                .replace(/'/g, \"&#039;\");\n        };\n        for (const [key, value] of Object.entries(variables)) {\n            const placeholder = `{{${key}}}`;\n            let replacement = escapeHtml(String(value));\n            if ( templateName === 'concrete_issue_messages' || templateName === 'concrete_issue_day_content' ) {\n                replacement = value;\n            }\n            template = template.replaceAll(placeholder, replacement);\n        }\n\n        return template;\n    }\n\n    async getTaskCount() {\n        if (!localStorage.getItem('spotfix_session_id')) {\n            return {};\n        }\n\n        const projectToken = this.params.projectToken;\n        const sessionId = localStorage.getItem('spotfix_session_id');\n\n        const tasks = await getTasksDoboard(projectToken, sessionId, this.params.accountId, this.params.projectId);\n        const filteredTasks = tasks.filter(task => {\n            return task.taskMeta;\n        });\n        const taskCountElement = document.getElementById('doboard_task_widget-task_count');\n        if ( taskCountElement ) {\n            taskCountElement.innerText = filteredTasks.length;\n            taskCountElement.classList.remove('hidden');\n        }\n    }\n\n    /**\n     * Bind events to the widget\n     */\n    /*bindEvents() {\n        this.submitButton.addEventListener('click', () => this.submitTask());\n    }*/\n\n    /**\n     * Submit the task\n     */\n    async submitTask(taskDetails) {\n        if (!localStorage.getItem('spotfix_session_id')) {\n            await registerUser(taskDetails)(this.registrationShowMessage);\n            if ( taskDetails.userPassword ) {\n                await loginUser(taskDetails)(this.registrationShowMessage);\n            }\n        }\n\n        const sessionId = localStorage.getItem('spotfix_session_id');\n\n        if ( ! sessionId ) {\n            // @ToDo move this return in register block code\n            return {needToLogin: true};\n        }\n        return await handleCreateTask(sessionId, taskDetails);\n    }\n\n    /**\n     * Hide the widget\n     */\n    hide() {\n        this.removeHighlights();\n        this.createWidgetElement('wrap');\n    }\n\n    removeHighlights() {\n        const textSelectionclassName = 'doboard_task_widget-text_selection';\n        const spans = document.querySelectorAll('.' + textSelectionclassName);\n        const affectedParents = new Set(); // Track unique parents\n\n        spans.forEach(span => {\n            const parent = span.parentNode;\n            affectedParents.add(parent); // Mark parent as affected\n\n            // Move all child nodes out of the span and into the parent\n            while (span.firstChild) {\n                parent.insertBefore(span.firstChild, span);\n            }\n            parent.removeChild(span);\n        });\n\n        // Normalize all affected parents to merge adjacent text nodes\n        affectedParents.forEach(parent => parent.normalize());\n    }\n\n    wrapElementWithSpotfixHighlight(element) {\n        const newElement = element.cloneNode();\n        const wrapper = document.createElement('span');\n        wrapper.className = 'doboard_task_widget-text_selection image-highlight';\n\n        element.insertAdjacentElement('beforebegin', wrapper);\n        wrapper.appendChild(newElement);\n\n        return wrapper;\n    }\n\n    /**\n     * Get task spot data for highlighting.\n     * @param {string|int} taskIdToSearch\n     * @returns {object|null}\n     */\n    getTaskHighlightData(taskIdToSearch) {\n        const currentTaskData = this.allTasksData.find((element) => element.taskId.toString() === taskIdToSearch.toString());\n        if (currentTaskData && currentTaskData.taskMeta !== undefined) {\n            const currentTaskSpotData = JSON.parse(currentTaskData.taskMeta);\n            if (currentTaskSpotData !== null && typeof currentTaskSpotData === 'object') {\n                return currentTaskSpotData;\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Highlight elements.\n     * @param {[object]} spotsToBeHighlighted\n     */\n    highlightElements(spotsToBeHighlighted) {\n\n        if (spotsToBeHighlighted.length === 0) return;\n\n        const elementsMap = new Map();\n\n        // Gropuing elements\n        spotsToBeHighlighted.forEach(spot => {\n            const element = retrieveNodeFromPath(spot.nodePath);\n            if (!element) return;\n\n            if (!elementsMap.has(element)) {\n                elementsMap.set(element, []);\n            }\n            elementsMap.get(element).push(spot);\n        });\n\n        elementsMap.forEach((spots, element) => {\n            const spotfixHighlightOpen = '<span class=\"doboard_task_widget-text_selection\">';\n            const spotfixHighlightClose = '</span>';\n\n            const imgType = spots[0].isTagOfImageType;\n\n            if (imgType !== false) {\n                if (\n                    imgType === 'IMG'\n                ) {\n                    const wrappedElement = this.wrapElementWithSpotfixHighlight(element);\n                    element.replaceWith(wrappedElement);\n                }\n            }\n\n            let text = element.textContent;\n            const markers = [];\n\n            // Mark positions for inserting\n            spots.forEach(spot => {\n                if (spot.isWholeTagSelected) {\n                    markers.push({ position: 0, type: 'start' });\n                    markers.push({ position: text.length, type: 'end' });\n                } else {\n                    markers.push({ position: spot.startSelectPosition, type: 'start' });\n                    markers.push({ position: spot.endSelectPosition, type: 'end' });\n                }\n            });\n\n            // Sort markers backward\n            markers.sort((a, b) => b.position - a.position);\n\n            let result = text;\n            markers.forEach(marker => {\n                const insertText = marker.type === 'start'\n                    ? spotfixHighlightOpen\n                    : spotfixHighlightClose;\n\n                result = result.slice(0, marker.position) + insertText + result.slice(marker.position);\n            });\n\n            element.innerHTML = result;\n        });\n    }\n\n    bindWidgetInputsInteractive() {\n        // Customising placeholders\n        const inputs = document.querySelectorAll('.doboard_task_widget-field');\n        inputs.forEach(input => {\n            if (input.value) {\n                input.classList.add('has-value');\n            }\n\n            input.addEventListener('input', () => {\n                if (input.value) {\n                    input.classList.add('has-value');\n                } else {\n                    input.classList.remove('has-value');\n                }\n            });\n\n            input.addEventListener('blur', () => {\n                if (!input.value) {\n                    input.classList.remove('has-value');\n                }\n            });\n        });\n\n        // Customising accordion dropdown\n        const accordionController = document.querySelector('.doboard_task_widget-login span');\n        if ( accordionController ) {\n            accordionController.addEventListener('click', function() {\n                this.closest('.doboard_task_widget-login').classList.toggle('active');\n            });\n        }\n\n        window.addEventListener('scroll', this.handleScroll.bind(this));\n        window.addEventListener('resize', this.handleResize.bind(this));\n    }\n\n    registrationShowMessage(messageText, type = 'error') {\n        const titleSpan = document.getElementById('doboard_task_widget-error_message-header');\n        const messageDiv = document.getElementById('doboard_task_widget-error_message');\n        const messageWrap = document.querySelector('.doboard_task_widget-message-wrapper');\n\n        if (typeof messageText === 'string' && messageDiv !== null && messageWrap !== null) {\n            messageDiv.innerText = messageText;\n            messageWrap.classList.remove('hidden');\n            messageDiv.classList.remove('doboard_task_widget-notice_message', 'doboard_task_widget-error_message');\n            if (type === 'notice') {\n                titleSpan.innerText = '';\n                messageWrap.classList.add('doboard_task_widget-notice_message');\n                messageDiv.style.color = '#2a5db0';\n            } else {\n                titleSpan.innerText = 'Registration error';\n                messageWrap.classList.add('doboard_task_widget-error_message');\n                messageDiv.style.color = 'red';\n            }\n        }\n    }\n\n    positionWidgetContainer() {\n        const selection = document.querySelector('.doboard_task_widget-text_selection');\n        const widget = document.querySelector('.doboard_task_widget')\n        const widgetCreateIssue = document.querySelector('.doboard_task_widget-content.doboard_task_widget-create_issue')\n        const widgetConcreteIssue = document.querySelector('.doboard_task_widget-concrete_issues-container')\n        if ( ! ( ( widgetCreateIssue || widgetConcreteIssue ) && selection ) ) {\n            // Skip if the widget is closed or highlight not exist\n            return;\n        }\n\n        const scrollY = window.scrollY;\n        const viewportHeight = window.innerHeight;\n\n        const selectionAbsoluteTop = selection.offsetTop;\n\n        const widgetHeight = widget.offsetHeight;\n\n        let top;\n\n        // Check selection position\n        if (selectionAbsoluteTop - scrollY < 0) {\n            // 1) The selection is above the viewport - stuck the widget on the top\n            top = 10;\n        } else if (selectionAbsoluteTop - scrollY > viewportHeight) {\n            // 2) The selection is below the viewport - stuck the widget on the bottom\n            top = viewportHeight - widgetHeight - 10;\n        } else {\n            // 3) The selection is on viewport - the widget aligned against the selection\n            top = selectionAbsoluteTop - scrollY\n            if ( selectionAbsoluteTop - scrollY > viewportHeight - widgetHeight ) {\n                // 3.1) The selection is on viewport but is below than widget height - stuck the widget on the bottom\n                top = viewportHeight - widgetHeight - 10;\n            }\n        }\n\n        widget.style.top = `${top}px`;\n        widget.style.bottom = 'auto';\n    }\n\n    handleScroll() {\n        clearTimeout(this.scrollTimeout);\n        this.scrollTimeout = setTimeout(() => {\n            this.positionWidgetContainer();\n        }, 10);\n    }\n\n    handleResize() {\n        clearTimeout(this.resizeTimeout);\n        this.resizeTimeout = setTimeout(() => {\n            this.positionWidgetContainer();\n        }, 100);\n    }\n}\n\nvar widgetTimeout = null;\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    new CleanTalkWidgetDoboard({}, 'wrap');\n});\n\ndocument.addEventListener('selectionchange', function(e) {\n    if (widgetTimeout) {\n        clearTimeout(widgetTimeout);\n    }\n\n    widgetTimeout = setTimeout(() => {\n        const selection = window.getSelection();\n        if (\n            selection.type === 'Range'\n        ) {\n            const selectedData = getSelectedData(selection);\n            let widgetExist = document.querySelector('.doboard_task_widget-container');\n            openWidget(selectedData, widgetExist, 'create_issue');\n        }\n    }, 1000);\n});\n\n\n/**\n * Open the widget to create a task.\n * @param {*} selectedData\n * @param {*} widgetExist\n * @param {*} type\n */\nfunction openWidget(selectedData, widgetExist, type) {\n\n    if (selectedData && !widgetExist) {\n        new CleanTalkWidgetDoboard(selectedData, type);\n    }\n}\n\n/**\n * Analyze the task selected data\n * @param {Object} taskSelectedData\n * @return {Element|null}\n */\nfunction taskAnalysis(taskSelectedData) {\n    const nodePath = taskSelectedData ? taskSelectedData.nodePath : '';\n    return retrieveNodeFromPath(nodePath);\n}\n\n/**\n * Scroll to an element by tag, class, and text content\n * @param {string} path - The path to the element\n * @return {boolean} - True if the element was found and scrolled to, false otherwise\n */\nfunction scrollToNodePath(path) {\n    const node = retrieveNodeFromPath(path);\n    if (node && node.scrollIntoView) {\n        node.scrollIntoView({ behavior: 'smooth', block: 'center' });\n        return true;\n    }\n    return false;\n}\n\nfunction hideContainersSpinner() {\n    const spinners = document.getElementsByClassName('doboard_task_widget-spinner_wrapper_for_containers');\n    if (spinners.length > 0) {\n        for (let i = 0; i < spinners.length ; i++) {\n            spinners[i].style.display = 'none';\n        }\n    }\n    const containerClassesToShow = ['doboard_task_widget-all_issues-container', 'doboard_task_widget-concrete_issues-container'];\n    for (let i = 0; i < containerClassesToShow.length ; i++) {\n        const containers = document.getElementsByClassName(containerClassesToShow[i]);\n        if (containers.length > 0) {\n            for (let i = 0; i < containers.length ; i++) {\n                containers[i].style.display = 'block';\n            }\n        }\n    }\n}\n\nfunction getTaskFullDetails(tasksDetails, taskId) {\n    const comments = tasksDetails.comments.filter(comment => {\n        return comment.taskId.toString() === taskId.toString()\n    });\n    const users = tasksDetails.users;\n    // Last comment\n    let lastComment = comments.length > 0 ? comments[0] : null;\n    // Author of the last comment\n    let author = null;\n    if (lastComment && users && users.length > 0) {\n        author = users.find(u => String(u.user_id) === String(lastComment.userId));\n    }\n    // Format date\n    let date = '', time = '';\n    if (lastComment) {\n        const dt = formatDate(lastComment.commentDate);\n        date = dt.date;\n        time = dt.time;\n    }\n    // Get the avatar and the name through separate functions\n    let avatarSrc = getAvatarSrc(author);\n    let authorName = getAuthorName(author);\n\n    return {\n        taskId: taskId,\n        taskAuthorAvatarImgSrc: avatarSrc,\n        taskAuthorName: authorName,\n        lastMessageText: lastComment ? lastComment.commentBody : 'No messages yet',\n        lastMessageTime: time,\n        issueTitle: comments.length > 0 ? comments[0].issueTitle : 'No Title',\n        issueComments: comments\n            .sort((a, b) => {\n                return new Date(a.commentDate) - new Date(b.commentDate);\n            })\n            .map(comment => {\n                const {date, time} = formatDate(comment.commentDate);\n                let author = null;\n                if (users && users.length > 0) {\n                    author = users.find(u => String(u.user_id) === String(comment.userId));\n                }\n                return {\n                    commentAuthorAvatarSrc: getAvatarSrc(author),\n                    commentAuthorName: getAuthorName(author),\n                    commentBody: comment.commentBody,\n                    commentDate: date,\n                    commentTime: time,\n                    commentUserId: comment.userId || 'Unknown User',\n                };\n            })\n    };\n}\n\nfunction getAvatarData(authorDetails) {\n    let avatarStyle;\n    let avatarCSSClass;\n    let taskAuthorInitials = authorDetails.taskAuthorName && authorDetails.taskAuthorName != 'Anonymous' ? authorDetails.taskAuthorName.trim().charAt(0).toUpperCase() : null;\n    let hideAvatar = authorDetails.hasOwnProperty('userIsIssuer') && authorDetails.userIsIssuer === true;\n    let initialsClass = 'doboard_task_widget-avatar-initials';\n    if (authorDetails.taskAuthorAvatarImgSrc === null && taskAuthorInitials !== null) {\n        avatarStyle = 'display: flex;background-color: #f8de7e;justify-content: center;align-items: center;';\n        avatarCSSClass = 'doboard_task_widget-avatar_container';\n    }\n    if (authorDetails.taskAuthorAvatarImgSrc === null && taskAuthorInitials === null) {\n        avatarStyle = `background-image:url(\\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAE9GlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4wLWMwMDAgNzkuMTcxYzI3ZmFiLCAyMDIyLzA4LzE2LTIyOjM1OjQxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjQuMCAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjQtMDQtMTBUMTk6MDg6MDkrMDU6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDI0LTA0LTEwVDE5OjIxOjA4KzA1OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDI0LTA0LTEwVDE5OjIxOjA4KzA1OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoxNWRjOWI0Yy04ZWVmLTRkNTEtYmE0MS1kOTkzZTZmNjNmMTIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MTVkYzliNGMt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');`;\n        avatarCSSClass = 'doboard_task_widget-avatar_container';\n        initialsClass += ' doboard_task_widget-hidden_element';\n    }\n    if (authorDetails.taskAuthorAvatarImgSrc !== null) {\n        avatarStyle = `background-image:url(\\'${authorDetails.taskAuthorAvatarImgSrc}\\');`;\n        avatarCSSClass = 'doboard_task_widget-avatar_container';\n        initialsClass = 'doboard_task_widget-hidden_element';\n    }\n    return {\n        avatarStyle: avatarStyle,\n        avatarCSSClass: avatarCSSClass,\n        taskAuthorInitials: taskAuthorInitials,\n        initialsClass: initialsClass\n    }\n}\n\n/**\n * Return first found updated task ID or false if no tasks were updated\n * @param allTasksData\n * @returns {string[]|false}\n */\nfunction isAnyTaskUpdated(allTasksData) {\n    let result = false;\n\n    const updatedtasksIDS = [];\n\n    for (let i = 0; i < allTasksData.length; i++) {\n        let currentStateOfTask = allTasksData[i];\n        const issuerId = localStorage.getItem('spotfix_user_id');\n        if (\n            currentStateOfTask.taskId &&\n            currentStateOfTask.taskLastUpdate &&\n            currentStateOfTask.taskCreatorTaskUser === issuerId\n        ) {\n            result = storageCheckTaskUpdate(currentStateOfTask.taskId, currentStateOfTask.taskLastUpdate);\n            if (result) {\n                updatedtasksIDS.push(currentStateOfTask.taskId.toString());\n            }\n        }\n    }\n\n    return updatedtasksIDS.length === 0 ? false : updatedtasksIDS;\n}\n\n/**\n * Check if any of the tasks has updates from site owner (not from the current user and not anonymous)\n * @returns {Promise<boolean>}\n */\nasync function checkIfTasksHasSiteOwnerUpdates(allTasksData, params) {\n    const updatedTaskIDs = isAnyTaskUpdated(allTasksData);\n    let result = false;\n    if (!updatedTaskIDs) {\n        return false;\n    }\n    for (let i = 0; i < updatedTaskIDs.length; i++) {\n        const updatedTaskId = updatedTaskIDs[i];\n        if (typeof updatedTaskId === 'string') {\n            const updatedTaskData =  await getTaskFullDetails(params, updatedTaskId);\n            if (updatedTaskData.issueComments) {\n                const lastIndex = updatedTaskData.issueComments.length - 1;\n                const lastMessage = updatedTaskData.issueComments[lastIndex];\n                if (\n                    lastMessage.commentUserId !== localStorage.getItem('spotfix_user_id') &&\n                    lastMessage.commentAuthorName !== 'Anonymous'\n                ) {\n                    storageAddUnreadUpdateForTaskID(updatedTaskId);\n                    result = true;\n                }\n            }\n        }\n    }\n    return result;\n}\n\n/**\n * Try to find selected image in selection.\n * @param selection\n * @returns {Node|*|null}\n */\nfunction getSelectedImage(selection) {\n\n    if (!selection || selection.rangeCount === 0 || selection.isCollapsed) {\n        return null;\n    }\n\n    const range = selection.getRangeAt(0);\n\n    // Is current end container IMG\n    if (range.startContainer === range.endContainer &&\n        range.startContainer.nodeType === Node.ELEMENT_NODE &&\n        range.startContainer.tagName === 'IMG') {\n        return range.startContainer;\n    }\n\n    // Get img in the range\n    const walker = document.createTreeWalker(\n        range.commonAncestorContainer,\n        NodeFilter.SHOW_ELEMENT,\n        {\n            acceptNode: function(node) {\n                return node.tagName === 'IMG' &&\n                isElementInRange(node, range) ?\n                    NodeFilter.FILTER_ACCEPT :\n                    NodeFilter.FILTER_REJECT;\n            }\n        }\n    );\n\n    let imgNode = walker.nextNode();\n    if (imgNode) {\n        return imgNode;\n    }\n\n    // start/end containers\n    const startElement = getElementFromNode(range.startContainer);\n    const endElement = getElementFromNode(range.endContainer);\n\n    // If selection starts on image\n    if (startElement && startElement.tagName === 'IMG' &&\n        isElementPartiallySelected(startElement, range)) {\n        return startElement;\n    }\n\n    if (endElement && endElement.tagName === 'IMG' &&\n        isElementPartiallySelected(endElement, range)) {\n        return endElement;\n    }\n\n    // 4. Get closest IMG\n    const nearbyElements = findNearbyElements(range);\n    for (const element of nearbyElements) {\n        if (element.tagName === 'IMG') {\n            return element;\n        }\n    }\n\n    return null;\n}\n\n\nfunction isElementInRange(element, range) {\n    const elementRange = document.createRange();\n    elementRange.selectNode(element);\n    return range.compareBoundaryPoints(Range.START_TO_START, elementRange) <= 0 &&\n        range.compareBoundaryPoints(Range.END_TO_END, elementRange) >= 0;\n}\n\nfunction isElementPartiallySelected(element, range) {\n    const elementRect = element.getBoundingClientRect();\n    const rangeRect = range.getBoundingClientRect();\n\n    //  bounding rectangles is crossed\n    return !(elementRect.right < rangeRect.left ||\n        elementRect.left > rangeRect.right ||\n        elementRect.bottom < rangeRect.top ||\n        elementRect.top > rangeRect.bottom);\n}\n\nfunction getElementFromNode(node) {\n    return node.nodeType === Node.ELEMENT_NODE ? node : node.parentElement;\n}\n\n/**\n * Find nearby elements in the range.\n * @param range\n * @returns {*[]}\n */\nfunction findNearbyElements(range) {\n    const elements = [];\n    const container = range.commonAncestorContainer;\n\n    // search elements\n    const previousElement = container.previousElementSibling;\n    const nextElement = container.nextElementSibling;\n\n    if (previousElement) {\n        elements.push(previousElement);\n    }\n    if (nextElement) {\n        elements.push(nextElement);\n    }\n\n    // Also check child container\n    if (container.nodeType === Node.ELEMENT_NODE) {\n        const children = container.children;\n        for (let i = 0; i < children.length; i++) {\n            if (isElementPartiallySelected(children[i], range)) {\n                elements.push(children[i]);\n            }\n        }\n    }\n\n    return elements;\n}\n\n\n/**\n * Extracts selection data from DOM Selection object\n * @param {Selection} selection - The DOM Selection object\n * @returns {Object} Selection data with text, positions, URL and node path\n */\nfunction getSelectedData(selection) {\n    const {\n        anchorOffset,\n        focusOffset,\n    } = selection;\n\n    let selectedText = selection.toString();\n    let isTagOfImageType = false;\n    const selectedImage = getSelectedImage(selection);\n    const pageURL = window.location.href;\n\n    if ( ! selectedText ) {\n        if (selectedImage === null) {\n            return createEmptySelectionData(pageURL);\n        } else {\n            selectedText = `${selectedImage.tagName.toUpperCase()} ${selection.anchorNode.offsetHeight.toString()} * ${selection.anchorNode.offsetWidth.toString()}`\n        }\n    }\n\n    if ( selectedImage ) {\n        isTagOfImageType = selectedImage.tagName;\n    }\n\n    const isWholeTagSelected = anchorOffset === 0 &&\n        focusOffset === 0 &&\n        selectedText.length > 0;\n\n    const targetNode = determineTargetNode(\n        selection,\n        isWholeTagSelected,\n        isTagOfImageType,\n        selectedImage\n    );\n\n    return {\n        startSelectPosition: Math.min(anchorOffset, focusOffset),\n        endSelectPosition: Math.max(anchorOffset, focusOffset),\n        selectedText: selectedText,\n        pageURL: pageURL,\n        nodePath: calculateNodePath(targetNode),\n        isTagOfImageType: isTagOfImageType,\n        isWholeTagSelected: isWholeTagSelected\n    };\n}\n\n/**\n * Determines the target node for path calculation\n * @param {Selection} selection - DOM Selection object\n * @param {boolean} isWholeTagSelected - is entire tag selected\n * @param {boolean} isTagOfImageType - is tag of image type\n * @param {Node|null} selectedImage - if predefined image node exists\n * @returns {Node} Target DOM node\n */\nfunction determineTargetNode(selection, isWholeTagSelected = false,  isTagOfImageType = false, selectedImage = null) {\n    const { focusNode, anchorNode } = selection;\n\n    if (isWholeTagSelected) {\n        return anchorNode.parentElement;\n    }\n\n    if (isTagOfImageType && selectedImage) {\n        return selectedImage;\n    }\n\n    return focusNode.nodeName !== '#text' ? focusNode : focusNode.parentNode;\n}\n\n/**\n * Calculate the path of a DOM node\n *\n * @param {Node} node\n * @return {int[]}\n */\nfunction calculateNodePath(node) {\n    let path = [];\n    while (node) {\n        let index = 0;\n        let sibling = node.previousSibling;\n        while (sibling) {\n            if (sibling.nodeType === 1) {\n                index++;\n            }\n            sibling = sibling.previousSibling;\n        }\n        path.unshift(index);\n        node = node.parentNode;\n    }\n\n    // Hard fix - need to remove first element to work correctly\n    path.shift();\n\n    return path;\n}\n\n/**\n * Retrieve a DOM node from a path\n *\n * @param {int[]} path\n * @return {*|null}\n */\nfunction retrieveNodeFromPath(path) {\n    // @ToDo check if the path is correct\n    if ( ! path ) {\n        return null;\n    }\n\n    let node = document;\n    for (let i = 0; i < path.length; i++) {\n        node = node.children[path[i]];\n        if ( ! node ) {\n            return null;\n        }\n    }\n    return node;\n}\n\n/**\n * Creates empty selection data object\n * @param {string} pageURL - Current page URL\n * @returns {Object} Empty selection data\n */\nfunction createEmptySelectionData(pageURL) {\n    return {\n        startSelectPosition: 0,\n        endSelectPosition: 0,\n        selectedText: '',\n        pageURL: pageURL,\n        nodePath: '',\n        isWholeTagSelected: false,\n        isTagOfImageType: false,\n    };\n}\n\n/**\n * Return bool if widget is closed in local storage\n * @returns {boolean}\n */\nfunction storageGetWidgetIsClosed() {\n    return localStorage.getItem('spotfix_widget_is_closed') === '1';\n}\n\n/**\n * Return bool if widget closed state is defined in local storage\n * @returns {boolean}\n */\nfunction storageWidgetCloseIsSet() {\n    return localStorage.getItem('spotfix_widget_is_closed') !== null;\n}\n\n/**\n * Save widget closed state\n * @param visible\n */\nfunction storageSetWidgetIsClosed(visible) {\n    localStorage.setItem('spotfix_widget_is_closed', visible ? '1' : '0');\n}\n\n/**\n * Return bool if user is defined in local storage\n * @returns {boolean}\n */\nfunction storageGetUserIsDefined() {\n    return localStorage.getItem('spotfix_user_id') !== null;\n}\n\n/**\n * Save data for updates check\n * @param tasks\n */\nfunction storageSaveTasksUpdateData(tasks) {\n    if (!tasks || !Array.isArray(tasks)) {\n        return;\n    }\n\n    const storedTasks = JSON.parse(localStorage.getItem('spotfix_task_updates') || '{}');\n\n    tasks.forEach(task => {\n        if (task.taskId && task.taskLastUpdate) {\n            storedTasks[task.taskId] = {\n                taskId: task.taskId,\n                taskLastUpdate: task.taskLastUpdate\n            };\n        }\n    });\n\n    localStorage.setItem('spotfix_task_updates', JSON.stringify(storedTasks));\n}\n\n/**\n * Check if a specific task has been updated since last check\n * @param taskId\n * @param currentLastUpdate\n * @returns {boolean|null}\n */\nfunction storageCheckTaskUpdate(taskId, currentLastUpdate) {\n    if (!taskId || !currentLastUpdate) {\n        return null;\n    }\n\n    const storedTasks = JSON.parse(localStorage.getItem('spotfix_task_updates') || '{}');\n    const storedTask = storedTasks[taskId];\n\n    if (!storedTask) {\n        return false;\n    }\n\n    const storedUpdate = new Date(storedTask.taskLastUpdate);\n    const currentUpdate = new Date(currentLastUpdate);\n    return currentUpdate > storedUpdate;\n}\n\n/**\n * Add unread update for a specific task\n * @param taskId\n */\nfunction storageAddUnreadUpdateForTaskID(taskId) {\n    if (!taskId) {\n        return;\n    }\n\n    const storedUnread = JSON.parse(localStorage.getItem('spotfix_unread_updates') || '[]');\n\n    if (!storedUnread.includes(taskId)) {\n        storedUnread.push(taskId);\n    }\n\n    localStorage.setItem('spotfix_unread_updates', JSON.stringify(storedUnread));\n}\n\n/**\n * Remove unread update for a specific task\n * @param taskId\n */\nfunction storageRemoveUnreadUpdateForTaskID(taskId) {\n    if (!taskId) {\n        return;\n    }\n\n    let storedUnread = JSON.parse(localStorage.getItem('spotfix_unread_updates') || '[]');\n\n    storedUnread = storedUnread.filter(id => id !== taskId);\n\n    localStorage.setItem('spotfix_unread_updates', JSON.stringify(storedUnread));\n}\n\n/**\n * Check if there are any unread updates\n * @returns {boolean}\n */\nfunction storageTasksHasUnreadUpdates() {\n    const storedUnread = JSON.parse(localStorage.getItem('spotfix_unread_updates') || '[]');\n\n    return storedUnread.length > 0;\n}\n\n/**\n *  Check if a specific task has unread updates\n * @param taskId\n * @returns {boolean}\n */\nfunction storageProvidedTaskHasUnreadUpdates(taskId) {\n    if (!taskId) {\n        return false;\n    }\n\n    const storedUnread = JSON.parse(localStorage.getItem('spotfix_unread_updates') || '[]');\n\n    return storedUnread.includes(taskId.toString());\n}\n"],"names":["DOBOARD_API_URL","userConfirmEmailDoboard","async","emailConfirmationToken","response","await","fetch","encodeURIComponent","method","ok","Error","responseBody","json","data","operation_status","sessionId","session_id","userId","user_id","email","accounts","operationStatus","createTaskDoboard","taskDetails","accountId","formData","FormData","append","projectToken","projectId","localStorage","getItem","taskTitle","taskDescription","taskMeta","body","operation_message","taskId","task_id","isPublic","createTaskCommentDoboard","comment","status","commentId","comment_id","registerUserDoboard","nickname","pageURL","accountExists","user_email_confirmed","operationMessage","userEmailConfirmed","loginUserDoboard","password","getTasksDoboard","tasks","map","task","name","taskLastUpdate","updated","taskCreated","created","taskCreatorTaskUser","creator_user_id","meta","getTasksCommentsDoboard","url","comments","commentBody","comment_text","commentDate","issueTitle","task_name","getUserDoboard","Array","isArray","users","userUpdateDoboard","timezone","success","confirmUserEmail","params","result","pendingTaskRaw","setItem","pendingTask","JSON","parse","selectedText","description","selectedData","stringify","createdTask","handleCreateTask","removeItem","getTasksFullDetails","length","addTaskComment","err","commentText","getUserTasks","getAllTasks","filter","formatDate","dateStr","date","time","let","dateObj","includes","Date","replace","isNaN","getTime","offsetMinutes","getTimezoneOffset","localDateObj","getMonth","getDate","getHours","toString","padStart","getMinutes","getTaskAuthorDetails","taskAuthorAvatarImgSrc","taskAuthorName","find","element","undefined","getIssuesCounterString","onPageSpotsCount","totalSpotsCount","getAvatarSrc","author","avatar","m","getAuthorName","trim","registerUser","userEmail","userName","window","location","href","then","document","querySelector","innerText","classList","remove","getElementById","focus","userUpdate","showMessageCallback","catch","error","loginUser","userPassword","Intl","DateTimeFormat","resolvedOptions","timeZone","CleanTalkWidgetDoboard","widgetElement","currentActiveTaskId","savedIssuesQuantityOnPage","savedIssuesQuantityAll","allTasksData","constructor","type","this","init","getParams","urlParams","URLSearchParams","search","emailToken","get","newUrl","storageSetWidgetIsClosed","delete","pathname","history","replaceState","title","registrationShowMessage","message","taskHasSiteOwnerUpdate","storageTasksHasUnreadUpdates","checkIfTasksHasSiteOwnerUpdates","storageSaveTasksUpdateData","storageWidgetCloseIsSet","createWidgetElement","bindWidgetInputsInteractive","script","src","URL","Object","fromEntries","searchParams","entries","bindCreateTaskEvents","submitButton","addEventListener","taskTitleElement","value","taskDescriptionElement","loginSectionElement","contains","userEmailElement","userNameElement","userPasswordElement","style","borderColor","disabled","submitTaskResult","submitTask","cursor","needToLogin","hideContainersSpinner","showOnlyCurrentPage","widgetContainer","createElement","className","innerHTML","removeAttribute","templateName","variables","tasksFullDetails","currentDomain","hostname","storageGetUserIsDefined","storageGetWidgetIsClosed","e","issuesCounter","paperclipImgSrc","sendButtonImgSrc","msgFieldBackgroundImgSrc","loadTemplate","appendChild","removeHighlights","selection","getSelection","getSelectedData","highlightElements","scrollToNodePath","nodePath","getTaskCount","widgetElementClasses","currentTarget","issuesQuantityOnPage","spotsToBeHighlighted","i","elTask","taskMetaString","taskData","currentPageURL","taskNodePath","taskPublicStatusImgSrc","taskPublicStatusHint","taskFullDetails","getTaskFullDetails","avatarData","getAvatarData","taskLastMessage","lastMessageText","lastMessageTime","avatarCSSClass","avatarStyle","taskAuthorInitials","initialsClass","classUnread","storageProvidedTaskHasUnreadUpdates","push","bindIssuesClick","issueTitleElement","issueComments","currentTaskData","String","issuesCommentsContainer","dayMessagesData","initIssuerID","storageRemoveUnreadUpdateForTaskID","userIsIssuer","Number","commentUserId","commentAuthorAvatarSrc","commentAuthorName","commentData","commentTime","commentContainerBackgroundSrc","daysWrapperHTML","day","messageId","currentDayMessages","dayMessagesWrapperHTML","sort","a","b","localeCompare","currentMessageData","dayContentMonthDay","dayContentMessages","setTimeout","contentContainer","scrollTo","top","scrollHeight","behavior","sendForm","preventDefault","input","alert","backToAllIssuesController","widgetClass","self","paperclipController","hide","add","querySelectorAll","forEach","item","getAttribute","taskHighlightData","getTaskHighlightData","positionWidgetContainer","template","text","key","placeholder","replacement","replaceAll","filteredTasks","taskCountElement","spans","affectedParents","Set","span","parent","parentNode","firstChild","insertBefore","removeChild","normalize","wrapElementWithSpotfixHighlight","newElement","cloneNode","wrapper","insertAdjacentElement","taskIdToSearch","currentTaskSpotData","elementsMap","Map","spot","retrieveNodeFromPath","has","set","spots","imgType","isTagOfImageType","wrappedElement","replaceWith","textContent","markers","isWholeTagSelected","position","startSelectPosition","endSelectPosition","marker","insertText","slice","accordionController","closest","toggle","handleScroll","bind","handleResize","messageText","titleSpan","messageDiv","messageWrap","color","widget","widgetCreateIssue","widgetConcreteIssue","scrollY","viewportHeight","innerHeight","selectionAbsoluteTop","offsetTop","widgetHeight","offsetHeight","bottom","clearTimeout","scrollTimeout","resizeTimeout","widgetTimeout","openWidget","widgetExist","taskAnalysis","taskSelectedData","path","node","scrollIntoView","block","spinners","getElementsByClassName","display","containerClassesToShow","containers","tasksDetails","lastComment","u","dt","avatarSrc","authorName","authorDetails","charAt","toUpperCase","hasOwnProperty","isAnyTaskUpdated","updatedtasksIDS","currentStateOfTask","issuerId","storageCheckTaskUpdate","updatedTaskIDs","lastIndex","lastMessage","updatedTaskId","updatedTaskData","storageAddUnreadUpdateForTaskID","getSelectedImage","rangeCount","isCollapsed","range","getRangeAt","startContainer","endContainer","nodeType","Node","ELEMENT_NODE","tagName","imgNode","createTreeWalker","commonAncestorContainer","NodeFilter","SHOW_ELEMENT","acceptNode","isElementInRange","FILTER_ACCEPT","FILTER_REJECT","nextNode","startElement","getElementFromNode","endElement","isElementPartiallySelected","findNearbyElements","elementRange","createRange","selectNode","compareBoundaryPoints","Range","START_TO_START","END_TO_END","elementRect","getBoundingClientRect","rangeRect","right","left","parentElement","elements","container","previousElement","previousElementSibling","nextElement","nextElementSibling","children","anchorOffset","focusOffset","selectedImage","createEmptySelectionData","anchorNode","offsetWidth","targetNode","determineTargetNode","Math","min","max","calculateNodePath","focusNode","nodeName","index","sibling","previousSibling","unshift","shift","visible","storedTasks","currentLastUpdate","storedTask","storedUnread","id"],"mappings":"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"}