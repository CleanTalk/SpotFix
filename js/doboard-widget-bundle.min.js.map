{"version":3,"file":"doboard-widget-bundle.min.js","sources":["doboard-widget-bundle.js"],"sourcesContent":["const DOBOARD_API_URL = 'https://api-next.doboard.com';\n\nconst createTaskDoboard = async (sessionId, taskDetails) => {\n    const accountId = taskDetails.accountId;\n    const formData = new FormData();\n    formData.append('session_id', sessionId);\n    formData.append('project_token', taskDetails.projectToken);\n    formData.append('project_id', taskDetails.projectId);\n    formData.append('user_id', localStorage.getItem('spotfix_user_id'));\n    formData.append('name', taskDetails.taskTitle);\n    formData.append('comment', taskDetails.taskDescription);\n    formData.append('meta', taskDetails.taskMeta);\n    const response = await fetch(DOBOARD_API_URL + '/' + accountId + '/task_add', {\n        method: 'POST',\n        body: formData,\n    });\n\n    if (!response.ok) {\n        throw new Error('Failed to create task');\n    }\n\n    const responseBody = await response.json();\n\n    if ( ! responseBody || ! responseBody.data ) {\n        throw new Error('Invalid response from server');\n    }\n    if ( responseBody.data.operation_status === 'FAILED') {\n        throw new Error(responseBody.data.operation_message);\n    }\n    if ( responseBody.data.operation_status === 'SUCCESS' ) {\n        return {\n            taskId: responseBody.data.task_id,\n            isPublic: 1, //todo MOCK!\n        }\n    }\n    throw new Error('Unknown error occurred during creating task');\n};\n\nconst createTaskCommentDoboard = async (accountId, sessionId, taskId, comment, projectToken, status = 'ACTIVE') => {\n    const response = await fetch(\n        DOBOARD_API_URL + '/' + accountId + '/comment_add' +\n        '?session_id=' + sessionId +\n        '&task_id=' + taskId +\n        '&comment=' + comment +\n        '&project_token=' + projectToken +\n        '&status=' + status,\n    {\n        method: 'GET',\n    });\n\n\n    if (!response.ok) {\n        throw new Error('Failed to create task comment');\n    }\n\n    const responseBody = await response.json();\n\n    if (!responseBody || !responseBody.data) {\n        throw new Error('Invalid response from server');\n    }\n    if (responseBody.data.operation_status === 'FAILED') {\n        throw new Error(responseBody.data.operation_message);\n    }\n    if (responseBody.data.operation_status === 'SUCCESS') {\n        return {\n            commentId: responseBody.data.comment_id,\n        };\n    }\n    throw new Error('Unknown error occurred during creating task comment');\n};\n\nconst registerUserDoboard = async (projectToken, accountId, email, nickname) => {\n    const formData = new FormData();\n    formData.append('project_token', projectToken);\n    formData.append('account_id', accountId);\n    if (email && nickname) {\n        formData.append('email', email);\n        formData.append('nickname', nickname);\n    }\n    const response = await fetch(DOBOARD_API_URL + '/user_registration', {\n        method: 'POST',\n        body: formData,\n    });\n\n    if ( ! response.ok ) {\n        throw new Error('Registration failed');\n    }\n\n    const responseBody = await response.json();\n\n    if ( ! responseBody || ! responseBody.data ) {\n        throw new Error('Invalid response from server');\n    }\n    if ( responseBody.data.operation_status === 'FAILED') {\n        throw new Error(responseBody.data.operation_message);\n    }\n    if ( responseBody.data.operation_status === 'SUCCESS' ) {\n        if (responseBody.data.user_email_confirmed === 1) {\n            return {\n                accountExists: true\n            }\n        }\n        return {\n            sessionId: responseBody.data.session_id,\n            userId: responseBody.data.user_id,\n            email: responseBody.data.email\n        }\n    }\n    throw new Error('Unknown error occurred during registration');\n};\n\nconst loginUser = async (email, password) => {\n    const formData = new FormData();\n    formData.append('email', email);\n    formData.append('password', password);\n\n    const response = await fetch(DOBOARD_API_URL + '/user_authorize', {\n        method: 'POST',\n        body: formData,\n    });\n\n    if ( ! response.ok ) {\n        throw new Error('Authorization failed');\n    }\n\n    const responseBody = await response.json();\n\n    if ( ! responseBody || ! responseBody.data ) {\n        throw new Error('Invalid response from server');\n    }\n    if ( responseBody.data.operation_status === 'FAILED') {\n        throw new Error(responseBody.data.operation_message);\n    }\n    if ( responseBody.data.operation_status === 'SUCCESS' ) {\n        return {\n            sessionId: responseBody.data.session_id,\n            userId: responseBody.data.user_id,\n            email: email\n        }\n    }\n    throw new Error('Unknown error occurred during registration');\n}\n\nconst getTasksDoboard = async (projectToken, sessionId, accountId, projectId, userId) => {\n    const formData = new FormData();\n    formData.append('project_token', projectToken);\n    formData.append('session_id', sessionId);\n    formData.append('project_id', projectId);\n    formData.append('status', 'ACTIVE');\n    if ( userId ) {\n        formData.append('user_id', userId);\n    }\n    const response = await fetch(DOBOARD_API_URL + '/' + accountId + '/task_get', {\n        method: 'POST',\n        body: formData,\n    });\n\n    if ( ! response.ok ) {\n        throw new Error('Getting tasks failed');\n    }\n\n    const responseBody = await response.json();\n\n    if ( ! responseBody || ! responseBody.data ) {\n        throw new Error('Invalid response from server');\n    }\n    if ( responseBody.data.operation_status === 'FAILED') {\n        throw new Error(responseBody.data.operation_message);\n    }\n    if ( responseBody.data.operation_status === 'SUCCESS' ) {\n        return responseBody.data.tasks.map(task => ({\n            taskId: task.task_id,\n            taskTitle: task.name,\n            taskLastUpdate: task.updated,\n            taskCreated: task.created,\n            taskCreatorTaskUser: task.creator_user_id,\n            taskMeta: task.meta,\n        }))\n    }\n    throw new Error('Unknown error occurred during getting tasks');\n}\n\n\nconst getTaskCommentsDoboard = async (taskId, sessionId, accountId, projectToken, status = 'ACTIVE') => {\n    const response = await fetch(\n        DOBOARD_API_URL + '/' + accountId + '/comment_get' +\n        '?session_id=' + sessionId +\n        '&status=' + status +\n        '&task_id=' + taskId +\n        '&project_token=' + projectToken,\n    {\n        method: 'GET',\n    });\n\n    if ( ! response.ok ) {\n        throw new Error('Getting logs failed');\n    }\n\n    const responseBody = await response.json();\n\n    if ( ! responseBody || ! responseBody.data ) {\n        throw new Error('Invalid response from server');\n    }\n    if ( responseBody.data.operation_status === 'FAILED') {\n        throw new Error(responseBody.data.operation_message);\n    }\n    if ( responseBody.data.operation_status === 'SUCCESS' ) {\n        return responseBody.data.comments.map(comment => ({\n            commentId: comment.comment_id,\n            userId: comment.user_id,\n            comment: comment.comment,\n            commentBody: comment.comment_text,\n            commentDate: comment.updated,\n            status: comment.status,\n            issueTitle: comment.task_name,\n        }));\n    }\n    throw new Error('Unknown error occurred during getting comments');\n};\n\nconst getUserDoboard = async (sessionId, projectToken, accountId) => {\n    const response = await fetch(DOBOARD_API_URL + '/' + accountId + '/user_get' +\n        '?session_id=' + sessionId +\n        '&project_token=' + projectToken, {\n        method: 'GET',\n    });\n\n    if (!response.ok) {\n        throw new Error('Getting user failed');\n    }\n\n    const responseBody = await response.json();\n\n    if (!responseBody) {\n        throw new Error('Invalid response from server');\n    }\n    // Format 1: users inside data\n    if (responseBody.data && responseBody.data.operation_status) {\n        if (responseBody.data.operation_status === 'FAILED') {\n            throw new Error(responseBody.data.operation_message);\n        }\n        if (responseBody.data.operation_status === 'SUCCESS') {\n            if (Array.isArray(responseBody.data.users)) {\n                return responseBody.data.users;\n            }\n            return [];\n        }\n    }\n    // Format 2: users at the top level\n    if (responseBody.operation_status) {\n        if (responseBody.operation_status === 'FAILED') {\n            throw new Error(responseBody.operation_message);\n        }\n        if (responseBody.operation_status === 'SUCCESS') {\n            if (Array.isArray(responseBody.users)) {\n                return responseBody.users;\n            }\n            return [];\n        }\n    }\n    throw new Error('Unknown error occurred during getting user');\n};\n\nconst userUpdateDoboard = async (projectToken, accountId, sessionId, userId, timezone) => {\n    const response = await fetch(DOBOARD_API_URL + '/' + accountId + '/user_update' +\n        '?session_id=' + sessionId +\n        '&project_token=' + projectToken +\n        '&user_id=' + userId +\n        '&timezone=' + timezone, {\n        method: 'GET',\n    });\n\n    if (!response.ok) {\n        throw new Error('User update failed');\n    }\n\n    const responseBody = await response.json();\n\n    if (!responseBody || !responseBody.data) {\n        throw new Error('Invalid response from server');\n    }\n    if (responseBody.data.operation_status === 'FAILED') {\n        throw new Error(responseBody.data.operation_message);\n    }\n    if (responseBody.data.operation_status === 'SUCCESS') {\n        return {\n            success: true\n        };\n    }\n    throw new Error('Unknown error occurred during user update');\n}\nasync function getTaskFullDetails(params, taskId) {\n\tconst sessionId = localStorage.getItem('spotfix_session_id');\n\tconst comments = await getTaskCommentsDoboard(taskId, sessionId, params.accountId, params.projectToken);\n\tconst users = await getUserDoboard(sessionId, params.projectToken, params.accountId);\n\t\n\t// Last comment\n\tlet lastComment = comments.length > 0 ? comments[0] : null;\n\t// Author of the last comment\n\tlet author = null;\n\tif (lastComment && users && users.length > 0) {\n\t\tauthor = users.find(u => String(u.user_id) === String(lastComment.userId));\n\t}\n\t// Format date\n\tlet date = '', time = '';\n\tif (lastComment) {\n\t\tconst dt = formatDate(lastComment.commentDate);\n\t\tdate = dt.date;\n\t\ttime = dt.time;\n\t}\n \t// Get the avatar and the name through separate functions\n \tlet avatarSrc = getAvatarSrc(author);\n \tlet authorName = getAuthorName(author);\n\n\treturn {\n\t\ttaskId: taskId,\n\t\ttaskAuthorAvatarImgSrc: avatarSrc,\n\t\ttaskAuthorName: authorName,\n\t\tlastMessageText: lastComment ? lastComment.commentBody : 'No messages yet',\n\t\tlastMessageTime: time,\n\t\tissueTitle: comments.length > 0 ? comments[0].issueTitle : 'No Title',\n \t\tissueComments: comments\n            .sort((a, b) => {\n                return new Date(a.commentDate) - new Date(b.commentDate);\n            })\n            .map(comment => {\n \t\t\tconst { date, time } = formatDate(comment.commentDate);\n \t\t\tlet author = null;\n \t\t\tif (users && users.length > 0) {\n \t\t\t\tauthor = users.find(u => String(u.user_id) === String(comment.userId));\n \t\t\t}\n \t\t\treturn {\n \t\t\t\tcommentAuthorAvatarSrc: getAvatarSrc(author),\n \t\t\t\tcommentAuthorName: getAuthorName(author),\n \t\t\t\tcommentBody: comment.commentBody,\n \t\t\t\tcommentDate: date,\n \t\t\t\tcommentTime: time,\n \t\t\t\tcommentUserId: comment.userId || 'Unknown User',\n \t\t\t};\n \t\t})\n\t};\n}\n\nasync function handleCreateTask(sessionId, taskDetails) {\n\ttry {\n\t\tconst result = await createTaskDoboard(sessionId, taskDetails);\n\t\tif (result && result.taskId && taskDetails.taskDescription) {\n\t\t\tawait addTaskComment({\n\t\t\t\tprojectToken: taskDetails.projectToken,\n\t\t\t\taccountId: taskDetails.accountId\n\t\t\t}, result.taskId, taskDetails.taskDescription);\n\t\t}\n\t\treturn result;\n\t} catch (err) {\n\t\tthrow err;\n\t}\n}\n\nasync function addTaskComment(params, taskId, commentText) {\n\tconst sessionId = localStorage.getItem('spotfix_session_id');\n\tif (!sessionId) throw new Error('No session');\n\tif (!params.projectToken || !params.accountId) throw new Error('Missing params');\n\treturn await createTaskCommentDoboard(params.accountId, sessionId, taskId, commentText, params.projectToken);\n}\n\nfunction getUserTasks(params) {\n\tif (!localStorage.getItem('spotfix_session_id')) {\n\t\treturn {};\n\t}\n\tconst projectToken = params.projectToken;\n\tconst sessionId = localStorage.getItem('spotfix_session_id');\n\tconst userId = localStorage.getItem('spotfix_user_id');\n\treturn getTasksDoboard(projectToken, sessionId, params.accountId, params.projectId, userId);\n}\n\nasync function getAllTasks(params) {\n\tif (!localStorage.getItem('spotfix_session_id')) {\n\t\treturn {};\n\t}\n\tconst projectToken = params.projectToken;\n\tconst sessionId = localStorage.getItem('spotfix_session_id');\n\tconst tasksData = await getTasksDoboard(projectToken, sessionId, params.accountId, params.projectId);\n\n    // Get only tasks with metadata\n\tconst filteredTaskData =  tasksData.filter(task => {\n        return task.taskMeta;\n    });\n\n    return filteredTaskData;\n}\n\nfunction formatDate(dateStr) {\n\t const months = [\n\t \t\"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\n\t \t\"July\", \"August\", \"September\", \"October\", \"November\", \"December\"\n\t ];\n\t // dateStr expected format: 'YYYY-MM-DD HH:mm:ss' or 'YYYY-MM-DDTHH:mm:ssZ'\n\t if (!dateStr) return { date: '', time: '' };\n\t let dateObj;\n\t if (dateStr.includes('T')) {\n\t  dateObj = new Date(dateStr);\n\t } else if (dateStr.includes(' ')) {\n\t  dateObj = new Date(dateStr.replace(' ', 'T'));\n\t } else {\n\t  dateObj = new Date(dateStr);\n\t }\n\t if (isNaN(dateObj.getTime())) return { date: '', time: '' };\n\n\t // Adjust to local timezone\n\t const offsetMinutes = dateObj.getTimezoneOffset();\n\t let localDateObj = new Date(dateObj.getTime() - offsetMinutes * 60000);\n\n\t const month = months[localDateObj.getMonth()];\n\t const day = localDateObj.getDate();\n\t const date = `${month} ${day}`;\n\t const hours = localDateObj.getHours().toString().padStart(2, '0');\n\t const minutes = localDateObj.getMinutes().toString().padStart(2, '0');\n\t const time = `${hours}:${minutes}`;\n\t return { date, time };\n}\n\nfunction getTaskAuthorDetails(params, taskId) {\n\tconst sessionId = localStorage.getItem('spotfix_session_id');\n\tconst mockUsersData =\n\t\t[\n\t\t\t{\n\t\t\t\t'taskId': '1',\n\t\t\t\t'taskAuthorAvatarImgSrc': 'https://s3.eu-central-1.amazonaws.com/cleantalk-ctask-atts/accounts/1/avatars/081a1b65d20fe318/m.jpg',\n\t\t\t\t'taskAuthorName': 'Test All Issues Single Author Name'\n\t\t\t}\n\t\t]\n\n\tconst defaultData =\n\t\t{\n\t\t\t'taskId': null,\n\t\t\t'taskAuthorAvatarImgSrc': null,\n\t\t\t'taskAuthorName': 'Task Author'\n\t\t};\n\n\tconst data = mockUsersData.find((element) => element.taskId === taskId);\n\treturn data === undefined ? defaultData : data;\n}\n\nfunction getIssuesCounterString(onPageSpotsCount, totalSpotsCount) {\n\treturn `(${onPageSpotsCount}/${totalSpotsCount})`;\n}\n\n// Get the author's avatar\nfunction getAvatarSrc(author) {\n\tif (author && author.avatar) {\n\t\tif (typeof author.avatar === 'object' && author.avatar.m) {\n\t\t\treturn author.avatar.m;\n\t\t} else if (typeof author.avatar === 'string') {\n\t\t\treturn author.avatar;\n\t\t}\n\t}\n\treturn null;\n}\n\n// Get the author's name\nfunction getAuthorName(author) {\n\tif (author) {\n\t\tif (author.name && author.name.trim().length > 0) {\n\t\t\treturn author.name;\n\t\t} else if (author.email && author.email.trim().length > 0) {\n\t\t\treturn author.email;\n\t\t}\n\t}\n\treturn 'Unknown Author';\n}\n\nfunction registerUser(taskDetails) {\n\tconst userEmail = taskDetails.userEmail;\n\tconst userName = taskDetails.userName;\n\tconst projectToken = taskDetails.projectToken;\n\tconst accountId = taskDetails.accountId;\n\n\tconst resultRegisterUser = registerUserDoboard(projectToken, accountId, userEmail, userName)\n\t\t.then(response => {\n\t\t\tif (response.accountExists) {\n\t\t\t\tdocument.querySelector(\".doboard_task_widget-accordion>.doboard_task_widget-input-container\").innerText = 'Account already exists. Please, login usin your password.';\n\t\t\t\tdocument.querySelector(\".doboard_task_widget-accordion>.doboard_task_widget-input-container.hidden\").classList.remove('hidden');\n\t\t\t\tdocument.getElementById(\"doboard_task_widget-user_password\").focus();\n\t\t\t} else if (response.sessionId) {\n\t\t\t\tlocalStorage.setItem('spotfix_session_id', response.sessionId);\n\t\t\t\tlocalStorage.setItem('spotfix_user_id', response.userId);\n\t\t\t\tlocalStorage.setItem('spotfix_email', response.email);\n\t\t\t\tuserUpdate(projectToken, accountId);\n\t\t\t} else {\n\t\t\t\tthrow new Error('Session ID not found in response');\n\t\t\t}\n\t\t})\n\t\t.catch(error => {\n\t\t\tthrow error;\n\t\t});\n\n\t\treturn resultRegisterUser;\n}\n\nfunction userUpdate(projectToken, accountId) {\n\tconst sessionId = localStorage.getItem('spotfix_session_id');\n\tconst userId = localStorage.getItem('spotfix_user_id');\n\tconst timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n\n\treturn userUpdateDoboard(projectToken, accountId, sessionId, userId, timezone);\n}\n\n/**\n * Widget class to create a task widget\n */\nclass CleanTalkWidgetDoboard {\n    selectedText = '';\n    selectedData = {};\n    widgetElement = null;\n    params = {};\n    currentActiveTaskId = 0;\n    savedIssuesQuantityOnPage = 0;\n    savedIssuesQuantityAll = 0;\n\n    /**\n     * Constructor\n     */\n    constructor(selectedData, type) {\n        this.selectedData = selectedData;\n        this.selectedText = selectedData.selectedText;\n        this.init(type);\n    }\n\n    /**\n     * Initialize the widget\n     */\n    async init(type) {\n        this.params = this.getParams();\n        this.widgetElement = await this.createWidgetElement(type);\n        this.bindWidgetInputsInteractive();\n    }\n\n    getParams() {\n        const script = document.querySelector(`script[src*=\"doboard-widget-bundle.min.js\"]`);\n        if ( ! script || ! script.src ) {\n            throw new Error('Script not provided');\n        }\n\n        const url = new URL(script.src);\n        let params = Object.fromEntries(url.searchParams.entries());\n        if ( ! params ) {\n            throw new Error('Script params not provided');\n        }\n        if ( ! params.projectToken || ! params.accountId || ! params.projectId ) {\n            throw new Error('Necessary script params not provided');\n\n        }\n        return params;\n    }\n\n    /**\n     * Binding events to create a task\n     */\n    bindCreateTaskEvents() {\n        const submitButton = document.getElementById('doboard_task_widget-submit_button');\n\n        if (submitButton) {\n            submitButton.addEventListener('click', async () => {\n                // Check required fields: Report about and Description\n                const taskTitleElement = document.getElementById('doboard_task_widget-title');\n                const taskTitle = taskTitleElement.value;\n                if ( ! taskTitle ) {\n                    taskTitleElement.style.borderColor = 'red';\n                    taskTitleElement.focus();\n                    taskTitleElement.addEventListener('input', function() {\n                        this.style.borderColor = '';\n                    });\n                    return;\n                }\n                const taskDescriptionElement = document.getElementById('doboard_task_widget-description')\n                const taskDescription = taskDescriptionElement.value;\n                if ( ! taskDescription ) {\n                    taskDescriptionElement.style.borderColor = 'red';\n                    taskDescriptionElement.focus();\n                    taskDescriptionElement.addEventListener('input', function() {\n                        this.style.borderColor = '';\n                    });\n                    return;\n                }\n\n                // If login section is open, check required fields: Nickname, Email\n                let userName = '';\n                let userEmail = '';\n                let userPassword = '';\n                const loginSectionElement = document.querySelector('.doboard_task_widget-login');\n\n                if ( loginSectionElement && loginSectionElement.classList.contains('active') ) {\n                    const userEmailElement = document.getElementById('doboard_task_widget-user_email');\n                    const userNameElement = document.getElementById('doboard_task_widget-user_name');\n                    const userPasswordElement = document.getElementById('doboard_task_widget-user_password');\n\n                    userEmail = userEmailElement.value;\n                    if ( ! userEmail ) {\n                        userEmailElement.style.borderColor = 'red';\n                        userEmailElement.focus();\n                        userEmailElement.addEventListener('input', function() {\n                            this.style.borderColor = '';\n                        });\n                        return;\n                    }\n\n                    // This is the registration request\n                    if ( userEmailElement && userNameElement ) {\n                        userName = userNameElement.value;\n                        if ( ! userName ) {\n                            userNameElement.style.borderColor = 'red';\n                            userNameElement.focus();\n                            userNameElement.addEventListener('input', function() {\n                                this.style.borderColor = '';\n                            });\n                            return;\n                        }\n                    }\n\n                    // This is the login request\n                    if ( userEmailElement && userPasswordElement && ! userNameElement ) {\n                        userPassword = userPasswordElement.value;\n                        if ( ! userPassword ) {\n                            userPasswordElement.style.borderColor = 'red';\n                            userPasswordElement.focus();\n                            userPasswordElement.addEventListener('input', function() {\n                                this.style.borderColor = '';\n                            });\n                            return;\n                        }\n                    }\n\n                }\n\n                // If it is the login request\n                const userEmailElement = document.getElementById('doboard_task_widget-user_email');\n                userEmail = userEmailElement.value;\n\n                // Make the submit button disable with spinner\n                const submitButton = document.getElementById('doboard_task_widget-submit_button');\n                submitButton.disabled = true;\n                submitButton.innerText = 'Creating spot...';\n\n                let taskDetails = {\n                    taskTitle: taskTitle,\n                    taskDescription: taskDescription,\n                    //typeSend: typeSend,\n                    selectedData: this.selectedData,\n                    projectToken: this.params.projectToken,\n                    projectId: this.params.projectId,\n                    accountId: this.params.accountId,\n                    taskMeta: JSON.stringify(this.selectedData),\n                };\n                if ( userEmail ) {\n                    taskDetails.userEmail = userEmail\n                }\n                if ( userName ) {\n                    taskDetails.userName = userName\n                }\n                if ( userPassword ) {\n                    taskDetails.userPassword = userPassword\n                }\n                const submitTaskResult = await this.submitTask(taskDetails);\n\n                // Return the submit button normal state\n                submitButton.disabled = false;\n                submitButton.style.cursor = 'pointer';\n\n                if ( submitTaskResult.needToLogin ) {\n                    // @ToDo Do not know what to de here: throw an error or pass log message?\n                    return;\n                }\n\n                if ( submitTaskResult.isPublic !== undefined ) {\n                    this.selectedData.isPublic = submitTaskResult.isPublic\n                }\n\n                this.selectedData = {};\n                await this.createWidgetElement('all_issues');\n                hideContainersSpinner(false)\n            });\n        }\n    }\n\n    /**\n     * Create widget element\n     * @return {HTMLElement} widget element\n     */\n    async createWidgetElement(type, showOnlyCurrentPage = true) {\n        const widgetContainer = document.querySelector('.doboard_task_widget') ? document.querySelector('.doboard_task_widget') : document.createElement('div');\n        widgetContainer.className = 'doboard_task_widget';\n        widgetContainer.innerHTML = '';\n\n        let templateName = '';\n        let variables = {};\n\n        switch (type) {\n            case 'create_issue':\n                templateName = 'create_issue';\n                variables = {\n                    selectedText: this.selectedText,\n                    currentDomain: document.location.hostname || ''\n                };\n                break;\n            case 'wrap':\n                templateName = 'wrap';\n                break;\n            case 'all_issues':\n                templateName = 'all_issues';\n                break;\n            case 'concrete_issue':\n                templateName = 'concrete_issue';\n                // todo: this is call duplicate!\n                getTaskFullDetails(this.params, this.currentActiveTaskId).then(taskDetails=>{\n                    const issueTitle = taskDetails.issueTitle;\n                    const issueTitleElement = document.querySelector('.doboard_task_widget-issue-title');\n                    if ( issueTitleElement ) {\n                        issueTitleElement.innerHTML = issueTitle;\n                    }\n                });\n\n                variables = {\n                    issueTitle: '...',\n                    issuesCounter: getIssuesCounterString(this.savedIssuesQuantityOnPage, this.savedIssuesQuantityAll),\n                    paperclipImgSrc: '/spotfix/img/send-message--paperclip.svg',\n                    sendButtonImgSrc: '/spotfix/img/send-message--button.svg',\n                    msgFieldBackgroundImgSrc: '/spotfix/img/send-message--input-background.svg',\n                };\n                break;\n            default:\n                break;\n        }\n        widgetContainer.innerHTML = await this.loadTemplate(templateName, variables);\n        document.body.appendChild(widgetContainer);\n\n\n        switch (type) {\n            case 'create_issue':\n                this.bindCreateTaskEvents();\n                break;\n            case 'wrap':\n                await this.getTaskCount();\n                document.querySelector('.doboard_task_widget-wrap').addEventListener('click', () => {\n                    this.createWidgetElement('all_issues');\n                });\n                hideContainersSpinner(false);\n                break;\n            case 'all_issues':\n                this.removeTextSelection();\n                let issuesQuantityOnPage = 0;\n                let tasks = await getAllTasks(this.params);\n                let spotsToBeHighlighted = [];\n                if (tasks.length > 0) {\n                    document.querySelector(\".doboard_task_widget-all_issues-container\").innerHTML = '';\n                    for (let i = 0; i < tasks.length; i++) {\n                        const elTask = tasks[i];\n\n                        // Data from api\n                        const taskId = elTask.taskId;\n                        const taskTitle = elTask.taskTitle;\n                        const taskDataString = elTask.taskMeta;\n                        const { time: lastMessageTime } = formatDate(elTask.taskLastUpdate);\n                        const taskData = taskDataString ? JSON.parse(taskDataString) : null;\n                        const currentPageURL = taskData ? taskData.pageURL : '';\n                        const taskNodePath = taskData ? taskData.nodePath : '';\n\n                        // Define publicity details\n                        let taskPublicStatusImgSrc = '';\n                        let taskPublicStatusHint = 'Task publicity is unknown'\n                        if (taskData && taskData.isPublic !== undefined) {\n                            if (taskData.isPublic) {\n                                taskPublicStatusImgSrc = '/spotfix/img/public.svg';\n                                taskPublicStatusHint = 'The task is public';\n                            } else {\n                                taskPublicStatusImgSrc = '/spotfix/img/private.svg';\n                                taskPublicStatusHint = 'The task is private and visible only for registered DoBoard users';\n                            }\n                        }\n\n                        if (!showOnlyCurrentPage || currentPageURL === window.location.href) {\n                            issuesQuantityOnPage++;\n                            //define last message and update time\n                            /* let lastMessageDetails = await getTaskLastMessageDetails(this.params, taskId);\n                            const authorDetails = getTaskAuthorDetails(this.params, '1'); // todo MOCK! */\n                            const taskFullDetails = await getTaskFullDetails(this.params, taskId);\n                            const avatarData = getAvatarData(taskFullDetails);\n                            const variables = {\n                                taskTitle: taskTitle || '',\n                                taskAuthorAvatarImgSrc: taskFullDetails.taskAuthorAvatarImgSrc,\n                                taskAuthorName: taskFullDetails.taskAuthorName,\n                                taskPublicStatusImgSrc: taskPublicStatusImgSrc,\n                                taskPublicStatusHint: taskPublicStatusHint,\n                                taskLastMessage: taskFullDetails.lastMessageText,\n                                taskLastUpdate: lastMessageTime,\n                                nodePath: taskNodePath,\n                                taskId: taskId,\n                                avatarCSSClass: avatarData.avatarCSSClass,\n                                avatarStyle: avatarData.avatarStyle,\n                                taskAuthorInitials: avatarData.taskAuthorInitials,\n                                initialsClass: avatarData.initialsClass\n                            };\n                            document.querySelector(\".doboard_task_widget-all_issues-container\").innerHTML += await this.loadTemplate('list_issues', variables);\n\n                            spotsToBeHighlighted.push(taskData);\n                        }\n                    }\n                    this.savedIssuesQuantityOnPage = issuesQuantityOnPage;\n                    this.savedIssuesQuantityAll = tasks.length;\n                    this.highlightElements(spotsToBeHighlighted);\n                    document.querySelector('.doboard_task_widget-header span').innerText += ' ' + getIssuesCounterString(this.savedIssuesQuantityOnPage, this.savedIssuesQuantityAll);\n                }\n                if (tasks.length === 0 || issuesQuantityOnPage === 0) {\n                    document.querySelector(\".doboard_task_widget-all_issues-container\").innerHTML = '<div class=\"doboard_task_widget-issues_list_empty\">The issues list is empty</div>';\n                }\n\n                // Bind the click event to the task elements for scrolling to the selected text and Go to concrete issue interface by click issue-item row\n                this.bindIssuesClick();\n                hideContainersSpinner(false);\n                break;\n\n            case 'concrete_issue':\n                const taskDetails = await getTaskFullDetails(this.params, this.currentActiveTaskId);\n                variables = {\n                    issueTitle: taskDetails.issueTitle,\n                    issueComments: taskDetails.issueComments,\n                    issuesCounter: getIssuesCounterString(),\n                    chevronBackTitle: 'Back to all spots',\n                };\n                const issuesCommentsContainer = document.querySelector('.doboard_task_widget-concrete_issues-container');\n                let dayMessagesData = [];\n                const initIssuerID = localStorage.getItem('spotfix_user_id');\n                let userIsIssuer = false;\n                if ( taskDetails.issueComments.length > 0 ) {\n                    issuesCommentsContainer.innerHTML = '';\n                    for (const comment of taskDetails.issueComments) {\n                        userIsIssuer = Number(initIssuerID) === Number(comment.commentUserId);\n                        const avatarData = getAvatarData({\n                            taskAuthorAvatarImgSrc: comment.commentAuthorAvatarSrc,\n                            taskAuthorName: comment.commentAuthorName,\n                            userIsIssuer: userIsIssuer\n                        });\n                        const commentData = {\n                            commentAuthorName: comment.commentAuthorName,\n                            commentBody: comment.commentBody,\n                            commentDate: comment.commentDate,\n                            commentTime: comment.commentTime,\n                            issueTitle: variables.issueTitle,\n                            issuesCounter: variables.issuesCounter,\n                            commentContainerBackgroundSrc: userIsIssuer\n                                ? '/spotfix/img/comment-self-background.png'\n                                : '/spotfix/img/comment-other-background.png',\n                            avatarCSSClass: avatarData.avatarCSSClass,\n                            avatarStyle: avatarData.avatarStyle,\n                            taskAuthorInitials: avatarData.taskAuthorInitials,\n                            initialsClass: avatarData.initialsClass\n                        };\n                        if (dayMessagesData[comment.commentDate] === undefined) {\n                            dayMessagesData[comment.commentDate] = [];\n                            dayMessagesData[comment.commentDate].push(commentData);\n                        } else {\n                            dayMessagesData[comment.commentDate].push(commentData);\n                        }\n                    }\n                    let daysWrapperHTML = '';\n                    for (const day in dayMessagesData) {\n                        let currentDayMessages = dayMessagesData[day];\n                        let dayMessagesWrapperHTML = '';\n                        currentDayMessages.sort((a, b) => a.commentTime.localeCompare(b.commentTime));\n                        for (const messageId in currentDayMessages) {\n                            let currentMessageData = currentDayMessages[messageId];\n                            dayMessagesWrapperHTML += await this.loadTemplate('concrete_issue_messages', currentMessageData);\n                        }\n                        daysWrapperHTML += await this.loadTemplate('concrete_issue_day_content', {dayContentMonthDay: day, dayContentMessages: dayMessagesWrapperHTML});\n                    }\n                    issuesCommentsContainer.innerHTML = daysWrapperHTML;\n                } else {\n                    issuesCommentsContainer.innerHTML = 'No comments';\n                }\n\n                // Scroll to the bottom comments\n                setTimeout(() => {\n                    const contentContainer = document.querySelector('.doboard_task_widget-content');\n                    contentContainer.scrollTo({\n                        top: contentContainer.scrollHeight,\n                        behavior: 'smooth'\n                    });\n                }, 0);\n\n                const sendForm = document.querySelector('.doboard_task_widget-send_message form');\n                if (sendForm) {\n                    sendForm.addEventListener('submit', async (e) => {\n                        e.preventDefault();\n                        const input = sendForm.querySelector('.doboard_task_widget-send_message_input');\n                        const commentText = input.value.trim();\n                        if (!commentText) return;\n                        input.disabled = true;\n                        try {\n                            await addTaskComment(this.params, this.currentActiveTaskId, commentText);\n                            input.value = '';\n                            await this.createWidgetElement('concrete_issue');\n                            hideContainersSpinner(false);\n                        } catch (err) {\n                            alert('Error when adding a comment: ' + err.message);\n                        }\n                        input.disabled = false;\n                    });\n                }\n                break;\n\n            default:\n                break;\n        }\n\n        const backToAllIssuesController = document.querySelector('.doboard_task_widget_return_to_all');\n        if ( backToAllIssuesController ) {\n            const widgetClass = this;\n            backToAllIssuesController.addEventListener('click', function(e, self = widgetClass) {\n                self.createWidgetElement('all_issues');\n            });\n        }\n\n        const paperclipController = document.querySelector('.doboard_task_widget-send_message_paperclip');\n        if ( paperclipController ) {\n            paperclipController.addEventListener('click', function(e) {\n                e.preventDefault();\n                alert('This action is not implemented yet..');\n            });\n        }\n\n        document.querySelector('.doboard_task_widget-close_btn')?.addEventListener('click', () => {\n            this.hide();\n        }) || '';\n        return widgetContainer;\n    }\n\n    bindIssuesClick() {\n        document.querySelectorAll('.issue-item').forEach(item => {\n            item.addEventListener('click', async () => {\n                const nodePath = JSON.parse(item.getAttribute('data-node-path'));\n                scrollToNodePath(nodePath);\n                this.currentActiveTaskId = item.getAttribute('data-task-id');\n                await this.createWidgetElement('concrete_issue');\n                hideContainersSpinner(false);\n            });\n        });\n    }\n\n    /**\n     * Load the template\n     *\n     * @param templateName\n     * @param variables\n     * @return {Promise<string>}\n     * @ToDo have to refactor templates loaded method: need to be templates included into the bundle\n     *\n     */\n    async loadTemplate(templateName, variables = {}) {\n        const response = await fetch(`/spotfix/templates/${templateName}.html`);\n        let template = await response.text();\n\n        for (const [key, value] of Object.entries(variables)) {\n            const placeholder = `{{${key}}}`;\n            template = template.replaceAll(placeholder, value);\n        }\n\n        return template;\n    }\n\n    async getTaskCount() {\n        if (!localStorage.getItem('spotfix_session_id')) {\n            return {};\n        }\n\n        const projectToken = this.params.projectToken;\n        const sessionId = localStorage.getItem('spotfix_session_id');\n\n        const tasks = await getTasksDoboard(projectToken, sessionId, this.params.accountId, this.params.projectId);\n        const filteredTasks = tasks.filter(task => {\n            return task.taskMeta;\n        });\n        const taskCountElement = document.getElementById('doboard_task_widget-task_count');\n        if ( taskCountElement ) {\n            taskCountElement.innerText = filteredTasks.length;\n            taskCountElement.classList.remove('hidden');\n        }\n    }\n\n    /**\n     * Bind events to the widget\n     */\n    /*bindEvents() {\n        this.submitButton.addEventListener('click', () => this.submitTask());\n    }*/\n\n    /**\n     * Submit the task\n     */\n    async submitTask(taskDetails) {\n        if (!localStorage.getItem('spotfix_session_id')) {\n\n            await registerUser(taskDetails);\n\n            if ( taskDetails.userPassword ) {\n                await this.loginUser(taskDetails);\n            }\n        }\n\n        const sessionId = localStorage.getItem('spotfix_session_id');\n\n        if ( ! sessionId ) {\n            // @ToDo move this return in register block code\n            return {needToLogin: true};\n        }\n        return await handleCreateTask(sessionId, taskDetails);\n    }\n\n    loginUser(taskDetails) {\n        const userEmail = taskDetails.userEmail;\n        const userPassword = taskDetails.userPassword;\n\n        return loginUser(userEmail, userPassword)\n            .then(response => {\n                if (response.sessionId) {\n                    localStorage.setItem('spotfix_session_id', response.sessionId);\n                    localStorage.setItem('spotfix_user_id', response.userId);\n                    localStorage.setItem('spotfix_email', response.email);\n                } else {\n                    throw new Error('Session ID not found in response');\n                }\n            })\n            .catch(error => {\n                throw error;\n            });\n    }\n\n    /**\n     * Hide the widget\n     */\n    hide() {\n        this.removeTextSelection();\n        this.createWidgetElement('wrap');\n    }\n\n    removeTextSelection() {\n        const textSelectionclassName = 'doboard_task_widget-text_selection';\n        const spans = document.querySelectorAll('.' + textSelectionclassName);\n        spans.forEach(span => {\n            const parent = span.parentNode;\n            while (span.firstChild) {\n                parent.insertBefore(span.firstChild, span);\n            }\n            parent.removeChild(span);\n        });\n    }\n\n    highlightElements(spotsToBeHighlighted) {\n        if ( spotsToBeHighlighted.length === 0 ) {\n            return;\n        }\n        let sortedSpots = new Map();\n        // Aggregate selections by HtmlElement: [Element1 => [selection1, selection2], Element2 => [selection3]]\n        spotsToBeHighlighted.forEach(spot => {\n            const element = retrieveNodeFromPath(spot.nodePath);\n            if ( ! sortedSpots.has(element) ) {\n                sortedSpots.set(element, []);\n            }\n            const currentData = sortedSpots.get(element);\n            currentData.push({\n                selectStartPosition: spot.startSelectPosition,\n                selectEndPosition: spot.endSelectPosition,\n            });\n        })\n        // Render selections for the HtmlElement\n        const highlightWrapperOpen = '<span class=\"doboard_task_widget-text_selection\">';\n        const highlightWrapperClose = '</span>';\n        sortedSpots.forEach((spotSelectionsPositions, element) => {\n            // If the element no provided\n            if ( ! element ) {\n                return;\n            }\n            //Is the element is the not simple text one\n            if ( element.children.length > 0 ) {\n                // @ToDo make selection for the difficult elements\n                //console.log('Try to highlight difficult element: ' + element.innerHTML); // The debug statement\n                return;\n            }\n            const positions = [];\n            spotSelectionsPositions.forEach(spotSelectionPositions => {\n                positions.push(\n                    { pos: spotSelectionPositions.selectStartPosition, type: 'start' },\n                    { pos: spotSelectionPositions.selectEndPosition, type: 'end' }\n                );\n            })\n\n            positions.sort((a, b) => b.pos - a.pos);\n\n            let text = element.innerHTML;\n            let prevSlicePosition = null;\n            let slicedStringWithSelections = [];\n            positions.forEach(position => {\n                let afterText = text.substring(position.pos, prevSlicePosition ? prevSlicePosition : position.pos);\n                prevSlicePosition = position.pos;\n                let span = position.type === 'start' ? highlightWrapperOpen : highlightWrapperClose;\n                slicedStringWithSelections.unshift(afterText);\n                slicedStringWithSelections.unshift(span);\n            })\n            element.innerHTML = text.substring(0, prevSlicePosition) + slicedStringWithSelections.join('');\n        })\n    }\n\n    bindWidgetInputsInteractive() {\n        // Customising placeholders\n        const inputs = document.querySelectorAll('.doboard_task_widget-field');\n        inputs.forEach(input => {\n            if (input.value) {\n                input.classList.add('has-value');\n            }\n\n            input.addEventListener('input', () => {\n                if (input.value) {\n                    input.classList.add('has-value');\n                } else {\n                    input.classList.remove('has-value');\n                }\n            });\n\n            input.addEventListener('blur', () => {\n                if (!input.value) {\n                    input.classList.remove('has-value');\n                }\n            });\n        });\n\n        // Customising accordion dropdown\n        const accordionController = document.querySelector('.doboard_task_widget-login span');\n        if ( accordionController ) {\n            accordionController.addEventListener('click', function() {\n                this.closest('.doboard_task_widget-login').classList.toggle('active');\n            });\n        }\n    }\n}\n\nvar selectedData = {};\nvar widgetTimeout = null;\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    new CleanTalkWidgetDoboard({}, 'wrap');\n});\n\ndocument.addEventListener('selectionchange', function(e) {\n    if (widgetTimeout) {\n        clearTimeout(widgetTimeout);\n    }\n\n    widgetTimeout = setTimeout(() => {\n        const selection = window.getSelection();\n        if (\n            selection.type === 'Range'\n        ) {\n            const selectedData = getSelectedData(selection);\n            let widgetExist = document.querySelector('.doboard_task_widget-container');\n            openWidget(selectedData, widgetExist, 'create_issue');\n        }\n    }, 1000);\n});\n\n/**\n * Open the widget to create a task.\n * @param {*} selectedData\n * @param {*} widgetExist\n * @param {*} type\n */\nfunction openWidget(selectedData, widgetExist, type) {\n\n    if (selectedData && !widgetExist) {\n        new CleanTalkWidgetDoboard(selectedData, type);\n    }\n}\n\n/**\n * Get the selected data from the DOM\n * @param {Selection} selectedData\n * @returns {Object}\n */\nfunction getSelectedData(selectedData) {\n    let pageURL = window.location.href;\n    let selectedText = selectedData.toString();\n    const anchorOffset = selectedData.anchorOffset;\n    const focusOffset = selectedData.focusOffset;\n    const nodeToCalculate = selectedData.focusNode.nodeName === '#text' ? selectedData.focusNode.parentNode : selectedData.focusNode;\n    return {\n        startSelectPosition: Math.min(anchorOffset, focusOffset),\n        endSelectPosition: Math.max(anchorOffset, focusOffset),\n        selectedText: selectedText,\n        pageURL: pageURL,\n        nodePath: calculateNodePath(nodeToCalculate),\n    };\n}\n\n/**\n * Calculate the path of a DOM node\n *\n * @param {Node} node\n * @return {int[]}\n */\nfunction calculateNodePath(node) {\n    let path = [];\n    while (node) {\n        let index = 0;\n        let sibling = node.previousSibling;\n        while (sibling) {\n            if (sibling.nodeType === 1) {\n                index++;\n            }\n            sibling = sibling.previousSibling;\n        }\n        path.unshift(index);\n        node = node.parentNode;\n    }\n\n    // Hard fix - need to remove first element to work correctly\n    path.shift();\n\n    return path;\n}\n\n/**\n * Retrieve a DOM node from a path\n *\n * @param {int[]} path\n * @return {*|null}\n */\nfunction retrieveNodeFromPath(path) {\n    // @ToDo check if the path is correct\n    if ( ! path ) {\n        return null;\n    }\n\n    let node = document;\n    for (let i = 0; i < path.length; i++) {\n        node = node.children[path[i]];\n        if ( ! node ) {\n            return null;\n        }\n    }\n    return node;\n}\n\n/**\n * Analyze the task selected data\n * @param {Object} taskSelectedData\n * @return {Element|null}\n */\nfunction taskAnalysis(taskSelectedData) {\n    const nodePath = taskSelectedData ? taskSelectedData.nodePath : '';\n    return retrieveNodeFromPath(nodePath);\n}\n\n/**\n * Scroll to an element by tag, class, and text content\n * @param {string} path - The path to the element\n * @return {boolean} - True if the element was found and scrolled to, false otherwise\n */\nfunction scrollToNodePath(path) {\n    const node = retrieveNodeFromPath(path);\n    if (node && node.scrollIntoView) {\n        node.scrollIntoView({ behavior: 'smooth', block: 'center' });\n        return true;\n    }\n    return false;\n}\n\nfunction hideContainersSpinner() {\n    const spinners = document.getElementsByClassName('doboard_task_widget-spinner_wrapper_for_containers');\n    if (spinners.length > 0) {\n        for (let i = 0; i < spinners.length ; i++) {\n            spinners[i].style.display = 'none';\n        }\n    }\n    const containerClassesToShow = ['doboard_task_widget-all_issues-container', 'doboard_task_widget-concrete_issues-container'];\n    for (let i = 0; i < containerClassesToShow.length ; i++) {\n        const containers = document.getElementsByClassName(containerClassesToShow[i]);\n        if (containers.length > 0) {\n            for (let i = 0; i < containers.length ; i++) {\n                containers[i].style.display = 'block';\n            }\n        }\n    }\n}\n\nfunction getAvatarData(authorDetails) {\n    let avatarStyle;\n    let avatarCSSClass;\n    let taskAuthorInitials;\n    let hideAvatar = authorDetails.hasOwnProperty('userIsIssuer') && authorDetails.userIsIssuer === true;\n    let initialsClass = 'doboard_task_widget-avatar-initials';\n    if (authorDetails.taskAuthorAvatarImgSrc === null) {\n        avatarStyle = `background-image:url(\\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAE9GlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4wLWMwMDAgNzkuMTcxYzI3ZmFiLCAyMDIyLzA4LzE2LTIyOjM1OjQxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjQuMCAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjQtMDQtMTBUMTk6MDg6MDkrMDU6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDI0LTA0LTEwVDE5OjIxOjA4KzA1OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDI0LTA0LTEwVDE5OjIxOjA4KzA1OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoxNWRjOWI0Yy04ZWVmLTRkNTEtYmE0MS1kOTkzZTZmNjNmMTIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MTVkYzliNGMt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');`;\n        avatarCSSClass = 'doboard_task_widget-avatar_container';\n        initialsClass += ' doboard_task_widget-hidden_element';\n    } else {\n        avatarStyle = `background-image:url(\\'${authorDetails.taskAuthorAvatarImgSrc}\\');`;\n        avatarCSSClass = 'doboard_task_widget-avatar_container';\n        initialsClass += ' doboard_task_widget-hidden_element';\n    }\n    return {\n        avatarStyle: avatarStyle,\n        avatarCSSClass: avatarCSSClass,\n        taskAuthorInitials: taskAuthorInitials,\n        initialsClass: initialsClass\n    }\n}\n"],"names":["DOBOARD_API_URL","createTaskDoboard","async","sessionId","taskDetails","accountId","formData","FormData","response","append","projectToken","projectId","localStorage","getItem","taskTitle","taskDescription","taskMeta","await","fetch","method","body","ok","Error","responseBody","json","data","operation_status","operation_message","taskId","task_id","isPublic","createTaskCommentDoboard","comment","status","commentId","comment_id","registerUserDoboard","email","nickname","user_email_confirmed","accountExists","session_id","userId","user_id","loginUser","password","getTasksDoboard","tasks","map","task","name","taskLastUpdate","updated","taskCreated","created","taskCreatorTaskUser","creator_user_id","meta","getTaskCommentsDoboard","comments","commentBody","comment_text","commentDate","issueTitle","task_name","getUserDoboard","Array","isArray","users","userUpdateDoboard","timezone","success","getTaskFullDetails","params","lastComment","length","author","time","find","u","String","dt","formatDate","date","taskAuthorAvatarImgSrc","getAvatarSrc","taskAuthorName","getAuthorName","lastMessageText","lastMessageTime","issueComments","sort","a","b","Date","let","commentAuthorAvatarSrc","commentAuthorName","commentTime","commentUserId","handleCreateTask","result","addTaskComment","err","commentText","getUserTasks","getAllTasks","filter","dateStr","dateObj","includes","replace","isNaN","getTime","offsetMinutes","getTimezoneOffset","localDateObj","getMonth","getDate","getHours","toString","padStart","getMinutes","getTaskAuthorDetails","element","undefined","getIssuesCounterString","onPageSpotsCount","totalSpotsCount","avatar","m","trim","registerUser","userEmail","userName","then","document","querySelector","innerText","classList","remove","getElementById","focus","setItem","userUpdate","catch","error","Intl","DateTimeFormat","resolvedOptions","timeZone","CleanTalkWidgetDoboard","selectedText","selectedData","widgetElement","currentActiveTaskId","savedIssuesQuantityOnPage","savedIssuesQuantityAll","constructor","type","this","init","getParams","createWidgetElement","bindWidgetInputsInteractive","script","src","url","URL","Object","fromEntries","searchParams","entries","bindCreateTaskEvents","submitButton","addEventListener","taskTitleElement","value","taskDescriptionElement","userPassword","loginSectionElement","contains","userEmailElement","userNameElement","userPasswordElement","style","borderColor","disabled","JSON","stringify","submitTaskResult","submitTask","cursor","needToLogin","hideContainersSpinner","showOnlyCurrentPage","widgetContainer","createElement","className","templateName","innerHTML","variables","currentDomain","location","hostname","issueTitleElement","issuesCounter","paperclipImgSrc","sendButtonImgSrc","msgFieldBackgroundImgSrc","loadTemplate","appendChild","getTaskCount","removeTextSelection","issuesQuantityOnPage","spotsToBeHighlighted","i","elTask","taskDataString","taskData","parse","currentPageURL","pageURL","taskNodePath","nodePath","taskPublicStatusImgSrc","taskPublicStatusHint","window","href","taskFullDetails","avatarData","getAvatarData","taskLastMessage","avatarCSSClass","avatarStyle","taskAuthorInitials","initialsClass","push","highlightElements","bindIssuesClick","issuesCommentsContainer","chevronBackTitle","dayMessagesData","initIssuerID","userIsIssuer","Number","commentData","commentContainerBackgroundSrc","daysWrapperHTML","day","messageId","currentDayMessages","dayMessagesWrapperHTML","localeCompare","currentMessageData","dayContentMonthDay","dayContentMessages","setTimeout","contentContainer","scrollTo","top","scrollHeight","behavior","sendForm","e","preventDefault","input","alert","message","backToAllIssuesController","widgetClass","self","paperclipController","hide","querySelectorAll","forEach","item","scrollToNodePath","getAttribute","key","template","text","placeholder","replaceAll","filteredTasks","taskCountElement","span","parent","parentNode","firstChild","insertBefore","removeChild","sortedSpots","Map","spot","retrieveNodeFromPath","has","set","get","selectStartPosition","startSelectPosition","selectEndPosition","endSelectPosition","spotSelectionsPositions","children","positions","spotSelectionPositions","pos","prevSlicePosition","slicedStringWithSelections","position","afterText","substring","unshift","join","add","accordionController","closest","toggle","widgetTimeout","openWidget","widgetExist","getSelectedData","anchorOffset","focusOffset","nodeToCalculate","focusNode","nodeName","Math","min","max","calculateNodePath","node","path","index","sibling","previousSibling","nodeType","shift","taskAnalysis","taskSelectedData","scrollIntoView","block","spinners","getElementsByClassName","display","containerClassesToShow","containers","authorDetails","hasOwnProperty","clearTimeout","selection","getSelection"],"mappings":"AAAA,IAAMA,gBAAkB,+BAElBC,kBAAoBC,MAAOC,EAAWC,KACxC,IAAMC,EAAYD,EAAYC,UACxBC,EAAW,IAAIC,SAQfC,GAPNF,EAASG,OAAO,aAAcN,CAAS,EACvCG,EAASG,OAAO,gBAAiBL,EAAYM,YAAY,EACzDJ,EAASG,OAAO,aAAcL,EAAYO,SAAS,EACnDL,EAASG,OAAO,UAAWG,aAAaC,QAAQ,iBAAiB,CAAC,EAClEP,EAASG,OAAO,OAAQL,EAAYU,SAAS,EAC7CR,EAASG,OAAO,UAAWL,EAAYW,eAAe,EACtDT,EAASG,OAAO,OAAQL,EAAYY,QAAQ,EAC3BC,MAAMC,MAAMlB,gBAAkB,IAAMK,EAAY,YAAa,CAC1Ec,OAAQ,OACRC,KAAMd,CACV,CAAC,GAED,GAAI,CAACE,EAASa,GACV,MAAM,IAAIC,MAAM,uBAAuB,EAGrCC,EAAeN,MAAMT,EAASgB,KAAK,EAEzC,GAAK,CAAED,GAAgB,CAAEA,EAAaE,KAClC,MAAM,IAAIH,MAAM,8BAA8B,EAElD,GAA4C,WAAvCC,EAAaE,KAAKC,iBACnB,MAAM,IAAIJ,MAAMC,EAAaE,KAAKE,iBAAiB,EAEvD,GAA4C,YAAvCJ,EAAaE,KAAKC,iBACnB,MAAO,CACHE,OAAQL,EAAaE,KAAKI,QAC1BC,SAAU,CACd,EAEJ,MAAM,IAAIR,MAAM,6CAA6C,CACjE,EAEMS,yBAA2B7B,MAAOG,EAAWF,EAAWyB,EAAQI,EAAStB,EAAcuB,EAAS,YAC5FzB,EAAWS,MAAMC,MACnBlB,gBAAkB,IAAMK,EACxB,2BAAiBF,EACjB,YAAcyB,EACd,YAAcI,EACd,kBAAoBtB,EACpB,WAAauB,EACjB,CACId,OAAQ,KACZ,CAAC,EAGD,GAAI,CAACX,EAASa,GACV,MAAM,IAAIC,MAAM,+BAA+B,EAG7CC,EAAeN,MAAMT,EAASgB,KAAK,EAEzC,GAAI,CAACD,GAAgB,CAACA,EAAaE,KAC/B,MAAM,IAAIH,MAAM,8BAA8B,EAElD,GAA2C,WAAvCC,EAAaE,KAAKC,iBAClB,MAAM,IAAIJ,MAAMC,EAAaE,KAAKE,iBAAiB,EAEvD,GAA2C,YAAvCJ,EAAaE,KAAKC,iBAClB,MAAO,CACHQ,UAAWX,EAAaE,KAAKU,UACjC,EAEJ,MAAM,IAAIb,MAAM,qDAAqD,CACzE,EAEMc,oBAAsBlC,MAAOQ,EAAcL,EAAWgC,EAAOC,KAC/D,IAAMhC,EAAW,IAAIC,SAOfC,GANNF,EAASG,OAAO,gBAAiBC,CAAY,EAC7CJ,EAASG,OAAO,aAAcJ,CAAS,EACnCgC,GAASC,IACThC,EAASG,OAAO,QAAS4B,CAAK,EAC9B/B,EAASG,OAAO,WAAY6B,CAAQ,GAEvBrB,MAAMC,MAAMlB,gBAAkB,qBAAsB,CACjEmB,OAAQ,OACRC,KAAMd,CACV,CAAC,GAED,GAAK,CAAEE,EAASa,GACZ,MAAM,IAAIC,MAAM,qBAAqB,EAGnCC,EAAeN,MAAMT,EAASgB,KAAK,EAEzC,GAAK,CAAED,GAAgB,CAAEA,EAAaE,KAClC,MAAM,IAAIH,MAAM,8BAA8B,EAElD,GAA4C,WAAvCC,EAAaE,KAAKC,iBACnB,MAAM,IAAIJ,MAAMC,EAAaE,KAAKE,iBAAiB,EAEvD,GAA4C,YAAvCJ,EAAaE,KAAKC,iBACnB,OAA+C,IAA3CH,EAAaE,KAAKc,qBACX,CACHC,cAAe,CAAA,CACnB,EAEG,CACHrC,UAAWoB,EAAaE,KAAKgB,WAC7BC,OAAQnB,EAAaE,KAAKkB,QAC1BN,MAAOd,EAAaE,KAAKY,KAC7B,EAEJ,MAAM,IAAIf,MAAM,4CAA4C,CAChE,EAEMsB,UAAY1C,MAAOmC,EAAOQ,KAC5B,IAAMvC,EAAW,IAAIC,SAIfC,GAHNF,EAASG,OAAO,QAAS4B,CAAK,EAC9B/B,EAASG,OAAO,WAAYoC,CAAQ,EAEnB5B,MAAMC,MAAMlB,gBAAkB,kBAAmB,CAC9DmB,OAAQ,OACRC,KAAMd,CACV,CAAC,GAED,GAAK,CAAEE,EAASa,GACZ,MAAM,IAAIC,MAAM,sBAAsB,EAGpCC,EAAeN,MAAMT,EAASgB,KAAK,EAEzC,GAAK,CAAED,GAAgB,CAAEA,EAAaE,KAClC,MAAM,IAAIH,MAAM,8BAA8B,EAElD,GAA4C,WAAvCC,EAAaE,KAAKC,iBACnB,MAAM,IAAIJ,MAAMC,EAAaE,KAAKE,iBAAiB,EAEvD,GAA4C,YAAvCJ,EAAaE,KAAKC,iBACnB,MAAO,CACHvB,UAAWoB,EAAaE,KAAKgB,WAC7BC,OAAQnB,EAAaE,KAAKkB,QAC1BN,MAAOA,CACX,EAEJ,MAAM,IAAIf,MAAM,4CAA4C,CAChE,EAEMwB,gBAAkB5C,MAAOQ,EAAcP,EAAWE,EAAWM,EAAW+B,KAC1E,IAAMpC,EAAW,IAAIC,SAQfC,GAPNF,EAASG,OAAO,gBAAiBC,CAAY,EAC7CJ,EAASG,OAAO,aAAcN,CAAS,EACvCG,EAASG,OAAO,aAAcE,CAAS,EACvCL,EAASG,OAAO,SAAU,QAAQ,EAC7BiC,GACDpC,EAASG,OAAO,UAAWiC,CAAM,EAEpBzB,MAAMC,MAAMlB,gBAAkB,IAAMK,EAAY,YAAa,CAC1Ec,OAAQ,OACRC,KAAMd,CACV,CAAC,GAED,GAAK,CAAEE,EAASa,GACZ,MAAM,IAAIC,MAAM,sBAAsB,EAGpCC,EAAeN,MAAMT,EAASgB,KAAK,EAEzC,GAAK,CAAED,GAAgB,CAAEA,EAAaE,KAClC,MAAM,IAAIH,MAAM,8BAA8B,EAElD,GAA4C,WAAvCC,EAAaE,KAAKC,iBACnB,MAAM,IAAIJ,MAAMC,EAAaE,KAAKE,iBAAiB,EAEvD,GAA4C,YAAvCJ,EAAaE,KAAKC,iBACnB,OAAOH,EAAaE,KAAKsB,MAAMC,IAAIC,IAAQ,CACvCrB,OAAQqB,EAAKpB,QACbf,UAAWmC,EAAKC,KAChBC,eAAgBF,EAAKG,QACrBC,YAAaJ,EAAKK,QAClBC,oBAAqBN,EAAKO,gBAC1BxC,SAAUiC,EAAKQ,IAClB,EAAC,EAEN,MAAM,IAAInC,MAAM,6CAA6C,CACjE,EAGMoC,uBAAyBxD,MAAO0B,EAAQzB,EAAWE,EAAWK,EAAcuB,EAAS,YACjFzB,EAAWS,MAAMC,MACnBlB,gBAAkB,IAAMK,EACxB,2BAAiBF,EACjB,WAAa8B,EACb,YAAcL,EACd,kBAAoBlB,EACxB,CACIS,OAAQ,KACZ,CAAC,EAED,GAAK,CAAEX,EAASa,GACZ,MAAM,IAAIC,MAAM,qBAAqB,EAGnCC,EAAeN,MAAMT,EAASgB,KAAK,EAEzC,GAAK,CAAED,GAAgB,CAAEA,EAAaE,KAClC,MAAM,IAAIH,MAAM,8BAA8B,EAElD,GAA4C,WAAvCC,EAAaE,KAAKC,iBACnB,MAAM,IAAIJ,MAAMC,EAAaE,KAAKE,iBAAiB,EAEvD,GAA4C,YAAvCJ,EAAaE,KAAKC,iBACnB,OAAOH,EAAaE,KAAKkC,SAASX,IAAIhB,IAAW,CAC7CE,UAAWF,EAAQG,WACnBO,OAAQV,EAAQW,QAChBX,QAASA,EAAQA,QACjB4B,YAAa5B,EAAQ6B,aACrBC,YAAa9B,EAAQoB,QACrBnB,OAAQD,EAAQC,OAChB8B,WAAY/B,EAAQgC,SACvB,EAAC,EAEN,MAAM,IAAI1C,MAAM,gDAAgD,CACpE,EAEM2C,eAAiB/D,MAAOC,EAAWO,EAAcL,KAC7CG,EAAWS,MAAMC,MAAMlB,gBAAkB,IAAMK,EACjD,wBAAiBF,EACjB,kBAAoBO,EAAc,CAClCS,OAAQ,KACZ,CAAC,EAED,GAAI,CAACX,EAASa,GACV,MAAM,IAAIC,MAAM,qBAAqB,EAGnCC,EAAeN,MAAMT,EAASgB,KAAK,EAEzC,GAAI,CAACD,EACD,MAAM,IAAID,MAAM,8BAA8B,EAGlD,GAAIC,EAAaE,MAAQF,EAAaE,KAAKC,iBAAkB,CACzD,GAA2C,WAAvCH,EAAaE,KAAKC,iBAClB,MAAM,IAAIJ,MAAMC,EAAaE,KAAKE,iBAAiB,EAEvD,GAA2C,YAAvCJ,EAAaE,KAAKC,iBAClB,OAAIwC,MAAMC,QAAQ5C,EAAaE,KAAK2C,KAAK,EAC9B7C,EAAaE,KAAK2C,MAEtB,EAEf,CAEA,GAAI7C,EAAaG,iBAAkB,CAC/B,GAAsC,WAAlCH,EAAaG,iBACb,MAAM,IAAIJ,MAAMC,EAAaI,iBAAiB,EAElD,GAAsC,YAAlCJ,EAAaG,iBACb,OAAIwC,MAAMC,QAAQ5C,EAAa6C,KAAK,EACzB7C,EAAa6C,MAEjB,EAEf,CACA,MAAM,IAAI9C,MAAM,4CAA4C,CAChE,EAEM+C,kBAAoBnE,MAAOQ,EAAcL,EAAWF,EAAWuC,EAAQ4B,KACnE9D,EAAWS,MAAMC,MAAMlB,gBAAkB,IAAMK,EACjD,2BAAiBF,EACjB,kBAAoBO,EACpB,YAAcgC,EACd,aAAe4B,EAAU,CACzBnD,OAAQ,KACZ,CAAC,EAED,GAAI,CAACX,EAASa,GACV,MAAM,IAAIC,MAAM,oBAAoB,EAGlCC,EAAeN,MAAMT,EAASgB,KAAK,EAEzC,GAAI,CAACD,GAAgB,CAACA,EAAaE,KAC/B,MAAM,IAAIH,MAAM,8BAA8B,EAElD,GAA2C,WAAvCC,EAAaE,KAAKC,iBAClB,MAAM,IAAIJ,MAAMC,EAAaE,KAAKE,iBAAiB,EAEvD,GAA2C,YAAvCJ,EAAaE,KAAKC,iBAClB,MAAO,CACH6C,QAAS,CAAA,CACb,EAEJ,MAAM,IAAIjD,MAAM,2CAA2C,CAC/D,EACApB,eAAesE,mBAAmBC,EAAQ7C,GACzC,IAAMzB,EAAYS,aAAaC,QAAQ,oBAAoB,EACrD8C,EAAW1C,MAAMyC,uBAAuB9B,EAAQzB,EAAWsE,EAAOpE,UAAWoE,EAAO/D,YAAY,EACtG,IAAM0D,EAAQnD,MAAMgD,eAAe9D,EAAWsE,EAAO/D,aAAc+D,EAAOpE,SAAS,EAG/EqE,EAAgC,EAAlBf,EAASgB,OAAahB,EAAS,GAAK,KAElDiB,EAAS,KAKEC,GAJXH,GAAeN,GAAwB,EAAfA,EAAMO,SACjCC,EAASR,EAAMU,KAAKC,GAAKC,OAAOD,EAAEpC,OAAO,IAAMqC,OAAON,EAAYhC,MAAM,CAAC,GAGpD,IAUtB,OATIgC,KACGO,EAAKC,WAAWR,EAAYZ,WAAW,GACnCqB,KACVN,EAAOI,EAAGJ,MAMJ,CACNjD,OAAQA,EACRwD,uBALgBC,aAAaT,CAAM,EAMnCU,eALiBC,cAAcX,CAAM,EAMrCY,gBAAiBd,EAAcA,EAAYd,YAAc,kBACzD6B,gBAAiBZ,EACjBd,WAA8B,EAAlBJ,EAASgB,OAAahB,EAAS,GAAGI,WAAa,WAC1D2B,cAAe/B,EACLgC,KAAK,CAACC,EAAGC,IACC,IAAIC,KAAKF,EAAE9B,WAAW,EAAI,IAAIgC,KAAKD,EAAE/B,WAAW,CAC1D,EACAd,IAAIhB,IACb,GAAM,CAAEmD,KAAAA,EAAMN,KAAAA,CAAK,EAAIK,WAAWlD,EAAQ8B,WAAW,EACrDiC,IAAInB,EAAS,KAIb,MAAO,CACNoB,uBAAwBX,aAHxBT,EADGR,GAAwB,EAAfA,EAAMO,OACTP,EAAMU,KAAKC,GAAKC,OAAOD,EAAEpC,OAAO,IAAMqC,OAAOhD,EAAQU,MAAM,CAAC,EAGhCkC,CAAM,EAC3CqB,kBAAmBV,cAAcX,CAAM,EACvChB,YAAa5B,EAAQ4B,YACrBE,YAAaqB,EACbe,YAAarB,EACbsB,cAAenE,EAAQU,QAAU,cAClC,CACD,CAAC,CACH,CACD,CAEAxC,eAAekG,iBAAiBjG,EAAWC,GAC1C,IACC,IAAMiG,EAASpF,MAAMhB,kBAAkBE,EAAWC,CAAW,EAO7D,OANIiG,GAAUA,EAAOzE,QAAUxB,EAAYW,iBAC1CE,MAAMqF,eAAe,CACpB5F,aAAcN,EAAYM,aAC1BL,UAAWD,EAAYC,SACxB,EAAGgG,EAAOzE,OAAQxB,EAAYW,eAAe,EAEvCsF,CAGR,CAFE,MAAOE,GACR,MAAMA,CACP,CACD,CAEArG,eAAeoG,eAAe7B,EAAQ7C,EAAQ4E,GAC7C,IAAMrG,EAAYS,aAAaC,QAAQ,oBAAoB,EAC3D,GAAI,CAACV,EAAW,MAAM,IAAImB,MAAM,YAAY,EAC5C,GAAKmD,EAAO/D,cAAiB+D,EAAOpE,UACpC,OAAa0B,yBAAyB0C,EAAOpE,UAAWF,EAAWyB,EAAQ4E,EAAa/B,EAAO/D,YAAY,EAD5D,MAAM,IAAIY,MAAM,gBAAgB,CAEhF,CAEA,SAASmF,aAAahC,GACrB,IAGM/D,EACAP,EACAuC,EALN,OAAK9B,aAAaC,QAAQ,oBAAoB,GAGxCH,EAAe+D,EAAO/D,aACtBP,EAAYS,aAAaC,QAAQ,oBAAoB,EACrD6B,EAAS9B,aAAaC,QAAQ,iBAAiB,EAC9CiC,gBAAgBpC,EAAcP,EAAWsE,EAAOpE,UAAWoE,EAAO9D,UAAW+B,CAAM,GALlF,EAMT,CAEAxC,eAAewG,YAAYjC,GAC1B,IAGM/D,EACAP,EAJN,OAAKS,aAAaC,QAAQ,oBAAoB,GAGxCH,EAAe+D,EAAO/D,aACtBP,EAAYS,aAAaC,QAAQ,oBAAoB,GACzCI,MAAM6B,gBAAgBpC,EAAcP,EAAWsE,EAAOpE,UAAWoE,EAAO9D,SAAS,GAG/DgG,OAAO1D,GAC7BA,EAAKjC,QACf,GATI,EAYT,CAEA,SAASkE,WAAW0B,GAMlB,GAAI,CAACA,EAAS,MAAO,CAAEzB,KAAM,GAAIN,KAAM,EAAG,EAC1CkB,IAAIc,EAQJ,OANCA,EADGD,CAAAA,EAAQE,SAAS,GAAG,GAEbF,EAAQE,SAAS,GAAG,EACpB,IAAIhB,KAAKc,EAAQG,QAAQ,IAAK,GAAG,CAAC,EAElC,IAAIjB,KAAKc,CAAO,EAEvBI,MAAMH,EAAQI,QAAQ,CAAC,EAAU,CAAE9B,KAAM,GAAIN,KAAM,EAAG,GAGpDqC,EAAgBL,EAAQM,kBAAkB,EASzC,CAAEhC,KA1BM,CACd,UAAW,WAAY,QAAS,QAAS,MAAO,OAChD,OAAQ,SAAU,YAAa,UAAW,WAAY,aAgBnDiC,EAAe,IAAItB,KAAKe,EAAQI,QAAQ,EAAoB,IAAhBC,CAAqB,GAEnCG,SAAS,GAE9B,IADDD,EAAaE,QAAQ,EAKlBzC,KAHDuC,EAAaG,SAAS,EAAEC,SAAS,EAAEC,SAAS,EAAG,GAAG,EAEnD,IADGL,EAAaM,WAAW,EAAEF,SAAS,EAAEC,SAAS,EAAG,GAAG,CAEhD,EACtB,CAEA,SAASE,qBAAqBlD,EAAQ7C,GACnBhB,aAAaC,QAAQ,oBAAoB,EAA3D,IAiBMY,EAfL,CACC,CACCG,OAAU,IACVwD,uBAA0B,uGAC1BE,eAAkB,oCACnB,GAUyBR,KAAK,GAAa8C,EAAQhG,SAAWA,CAAM,EACtE,OAAgBiG,KAAAA,IAATpG,EAPN,CACCG,OAAU,KACVwD,uBAA0B,KAC1BE,eAAkB,aACnB,EAGyC7D,CAC3C,CAEA,SAASqG,uBAAuBC,EAAkBC,GACjD,UAAWD,KAAoBC,IAChC,CAGA,SAAS3C,aAAaT,GACrB,GAAIA,GAAUA,EAAOqD,OAAQ,CAC5B,GAA6B,UAAzB,OAAOrD,EAAOqD,QAAuBrD,EAAOqD,OAAOC,EACtD,OAAOtD,EAAOqD,OAAOC,EACf,GAA6B,UAAzB,OAAOtD,EAAOqD,OACxB,OAAOrD,EAAOqD,MAEhB,CACA,OAAO,IACR,CAGA,SAAS1C,cAAcX,GACtB,GAAIA,EAAQ,CACX,GAAIA,EAAO1B,MAAoC,EAA5B0B,EAAO1B,KAAKiF,KAAK,EAAExD,OACrC,OAAOC,EAAO1B,KACR,GAAI0B,EAAOvC,OAAsC,EAA7BuC,EAAOvC,MAAM8F,KAAK,EAAExD,OAC9C,OAAOC,EAAOvC,KAEhB,CACA,MAAO,gBACR,CAEA,SAAS+F,aAAahI,GACrB,IAAMiI,EAAYjI,EAAYiI,UACxBC,EAAWlI,EAAYkI,SAC7B,IAAM5H,EAAeN,EAAYM,aAC3BL,EAAYD,EAAYC,UAqB7B,OAnB0B+B,oBAAoB1B,EAAcL,EAAWgI,EAAWC,CAAQ,EACzFC,KAAK/H,IACL,GAAIA,EAASgC,cACZgG,SAASC,cAAc,qEAAqE,EAAEC,UAAY,4DAC1GF,SAASC,cAAc,4EAA4E,EAAEE,UAAUC,OAAO,QAAQ,EAC9HJ,SAASK,eAAe,mCAAmC,EAAEC,MAAM,MAC7D,CAAA,GAAItI,CAAAA,EAASL,UAMnB,MAAM,IAAImB,MAAM,kCAAkC,EALlDV,aAAamI,QAAQ,qBAAsBvI,EAASL,SAAS,EAC7DS,aAAamI,QAAQ,kBAAmBvI,EAASkC,MAAM,EACvD9B,aAAamI,QAAQ,gBAAiBvI,EAAS6B,KAAK,EACpD2G,WAAWtI,EAAcL,CAAS,CAGnC,CACD,CAAC,EACA4I,MAAMC,IACN,MAAMA,CACP,CAAC,CAGH,CAEA,SAASF,WAAWtI,EAAcL,GACjC,IAAMF,EAAYS,aAAaC,QAAQ,oBAAoB,EACrD6B,EAAS9B,aAAaC,QAAQ,iBAAiB,EAC/CyD,EAAW6E,KAAKC,eAAe,EAAEC,gBAAgB,EAAEC,SAEzD,OAAOjF,kBAAkB3D,EAAcL,EAAWF,EAAWuC,EAAQ4B,CAAQ,CAC9E,OAKMiF,uBACFC,aAAe,GACfC,aAAe,GACfC,cAAgB,KAChBjF,OAAS,GACTkF,oBAAsB,EACtBC,0BAA4B,EAC5BC,uBAAyB,EAKzBC,YAAYL,EAAcM,GACtBC,KAAKP,aAAeA,EACpBO,KAAKR,aAAeC,EAAaD,aACjCQ,KAAKC,KAAKF,CAAI,CAClB,CAKAE,WAAWF,GACPC,KAAKvF,OAASuF,KAAKE,UAAU,EAC7BF,KAAKN,cAAgBzI,MAAM+I,KAAKG,oBAAoBJ,CAAI,EACxDC,KAAKI,4BAA4B,CACrC,CAEAF,YACI,IAAMG,EAAS7B,SAASC,cAAc,6CAA6C,EACnF,GAAK,CAAE4B,GAAU,CAAEA,EAAOC,IACtB,MAAM,IAAIhJ,MAAM,qBAAqB,EAGnCiJ,EAAM,IAAIC,IAAIH,EAAOC,GAAG,EAC1B7F,EAASgG,OAAOC,YAAYH,EAAII,aAAaC,QAAQ,CAAC,EAC1D,GAAK,CAAEnG,EACH,MAAM,IAAInD,MAAM,4BAA4B,EAEhD,GAAOmD,EAAO/D,cAAkB+D,EAAOpE,WAAeoE,EAAO9D,UAI7D,OAAO8D,EAHH,MAAM,IAAInD,MAAM,sCAAsC,CAI9D,CAKAuJ,uBACI,IAAMC,EAAetC,SAASK,eAAe,mCAAmC,EAE5EiC,GACAA,EAAaC,iBAAiB,QAAS7K,UAEnC,IAAM8K,EAAmBxC,SAASK,eAAe,2BAA2B,EACtE/H,EAAYkK,EAAiBC,MACnC,GAAOnK,EAAP,CAQA,IAAMoK,EAAyB1C,SAASK,eAAe,iCAAiC,EAClF9H,EAAkBmK,EAAuBD,MAC/C,GAAOlK,EAAP,CAUAgF,IAAIuC,EAAW,GACXD,EAAY,GACZ8C,EAAe,GACnB,IAAMC,EAAsB5C,SAASC,cAAc,4BAA4B,EAE/E,GAAK2C,GAAuBA,EAAoBzC,UAAU0C,SAAS,QAAQ,EAAI,CAC3E,IAAMC,EAAmB9C,SAASK,eAAe,gCAAgC,EACjF,IAAM0C,EAAkB/C,SAASK,eAAe,+BAA+B,EACzE2C,EAAsBhD,SAASK,eAAe,mCAAmC,EAGvF,GAAK,EADLR,EAAYiD,EAAiBL,OAOzB,OALAK,EAAiBG,MAAMC,YAAc,MACrCJ,EAAiBxC,MAAM,EADvBwC,KAEAA,EAAiBP,iBAAiB,QAAS,WACvCf,KAAKyB,MAAMC,YAAc,EAC7B,CAAC,EAKL,GAAKJ,GAAoBC,GAEhB,EADLjD,EAAWiD,EAAgBN,OAOvB,OALAM,EAAgBE,MAAMC,YAAc,MACpCH,EAAgBzC,MAAM,EADtByC,KAEAA,EAAgBR,iBAAiB,QAAS,WACtCf,KAAKyB,MAAMC,YAAc,EAC7B,CAAC,EAMT,GAAKJ,GAAoBE,GAAuB,CAAED,GAEzC,EADLJ,EAAeK,EAAoBP,OAO/B,OALAO,EAAoBC,MAAMC,YAAc,MACxCF,EAAoB1C,MAAM,EAD1B0C,KAEAA,EAAoBT,iBAAiB,QAAS,WAC1Cf,KAAKyB,MAAMC,YAAc,EAC7B,CAAC,CAKb,CAGA,IAAMJ,EAAmB9C,SAASK,eAAe,gCAAgC,EACjFR,EAAYiD,EAAiBL,MAGvBH,EAAetC,SAASK,eAAe,mCAAmC,EAI5EzI,GAHJ0K,EAAaa,SAAW,CAAA,EACxBb,EAAapC,UAAY,mBAEP,CACd5H,UAAWA,EACXC,gBAAiBA,EAEjB0I,aAAcO,KAAKP,aACnB/I,aAAcsJ,KAAKvF,OAAO/D,aAC1BC,UAAWqJ,KAAKvF,OAAO9D,UACvBN,UAAW2J,KAAKvF,OAAOpE,UACvBW,SAAU4K,KAAKC,UAAU7B,KAAKP,YAAY,CAC9C,GAUMqC,GATDzD,IACDjI,EAAYiI,UAAYA,GAEvBC,IACDlI,EAAYkI,SAAWA,GAEtB6C,IACD/K,EAAY+K,aAAeA,GAENlK,MAAM+I,KAAK+B,WAAW3L,CAAW,GAG1D0K,EAAaa,SAAW,CAAA,EACxBb,EAAaW,MAAMO,OAAS,UAEvBF,EAAiBG,cAKapE,KAAAA,IAA9BiE,EAAiBhK,WAClBkI,KAAKP,aAAa3H,SAAWgK,EAAiBhK,UAGlDkI,KAAKP,aAAe,GACpBxI,MAAM+I,KAAKG,oBAAoB,YAAY,EAC3C+B,sBAAsB,CAAA,CAAK,EAhG3B,MANIhB,EAAuBO,MAAMC,YAAc,MAC3CR,EAAuBpC,MAAM,EAC7BoC,EAAuBH,iBAAiB,QAAS,WAC7Cf,KAAKyB,MAAMC,YAAc,EAC7B,CAAC,CARL,MANIV,EAAiBS,MAAMC,YAAc,MACrCV,EAAiBlC,MAAM,EACvBkC,EAAiBD,iBAAiB,QAAS,WACvCf,KAAKyB,MAAMC,YAAc,EAC7B,CAAC,CA6GT,CAAC,CAET,CAMAvB,0BAA0BJ,EAAMoC,EAAsB,CAAA,GAClD,IAAMC,EAAkB5D,SAASC,cAAc,sBAAsB,EAAID,SAASC,cAAc,sBAAsB,EAAID,SAAS6D,cAAc,KAAK,EACtJD,EAAgBE,UAAY,sBAG5BvG,IAAIwG,EAFJH,EAAgBI,UAAY,GAGxBC,EAAY,GAEhB,OAAQ1C,GACJ,IAAK,eACDwC,EAAe,eACfE,EAAY,CACRjD,aAAcQ,KAAKR,aACnBkD,cAAelE,SAASmE,SAASC,UAAY,EACjD,EACA,MACJ,IAAK,OACDL,EAAe,OACf,MACJ,IAAK,aACDA,EAAe,aACf,MACJ,IAAK,iBACDA,EAAe,iBAEf/H,mBAAmBwF,KAAKvF,OAAQuF,KAAKL,mBAAmB,EAAEpB,KAAKnI,IAC3D,IAAM2D,EAAa3D,EAAY2D,WACzB8I,EAAoBrE,SAASC,cAAc,kCAAkC,EAC9EoE,IACDA,EAAkBL,UAAYzI,EAEtC,CAAC,EAED0I,EAAY,CACR1I,WAAY,MACZ+I,cAAehF,uBAAuBkC,KAAKJ,0BAA2BI,KAAKH,sBAAsB,EACjGkD,gBAAiB,2CACjBC,iBAAkB,wCAClBC,yBAA0B,iDAC9B,CAIR,CAKA,OAJAb,EAAgBI,UAAYvL,MAAM+I,KAAKkD,aAAaX,EAAcE,CAAS,EAC3EjE,SAASpH,KAAK+L,YAAYf,CAAe,EAGjCrC,GACJ,IAAK,eACDC,KAAKa,qBAAqB,EAC1B,MACJ,IAAK,OACD5J,MAAM+I,KAAKoD,aAAa,EACxB5E,SAASC,cAAc,2BAA2B,EAAEsC,iBAAiB,QAAS,KAC1Ef,KAAKG,oBAAoB,YAAY,CACzC,CAAC,EACD+B,sBAAsB,CAAA,CAAK,EAC3B,MACJ,IAAK,aACDlC,KAAKqD,oBAAoB,EACzBtH,IAAIuH,EAAuB,EAC3BvH,IAAIhD,EAAQ9B,MAAMyF,YAAYsD,KAAKvF,MAAM,EACrC8I,EAAuB,GAC3B,GAAmB,EAAfxK,EAAM4B,OAAY,CAClB6D,SAASC,cAAc,2CAA2C,EAAE+D,UAAY,GAChF,IAAKzG,IAAIyH,EAAI,EAAGA,EAAIzK,EAAM4B,OAAQ6I,CAAC,GAAI,CACnC,IAAMC,EAAS1K,EAAMyK,GAGf5L,EAAS6L,EAAO7L,OAChBd,EAAY2M,EAAO3M,UACnB4M,EAAiBD,EAAOzM,SAChByE,EAAoBP,WAAWuI,EAAOtK,cAAc,EAApC,KACxBwK,EAAWD,EAAiB9B,KAAKgC,MAAMF,CAAc,EAAI,KACzDG,EAAiBF,EAAWA,EAASG,QAAU,GAC/CC,EAAeJ,EAAWA,EAASK,SAAW,GAGpDjI,IAAIkI,EAAyB,GACzBC,EAAuB,4BAW3B,GAVIP,GAAkC9F,KAAAA,IAAtB8F,EAAS7L,WAGjBoM,EAFAP,EAAS7L,UACTmM,EAAyB,0BACF,uBAEvBA,EAAyB,2BACF,sEAI3B,CAAC9B,GAAuB0B,IAAmBM,OAAOxB,SAASyB,KAAM,CACjEd,CAAoB,GAIpB,IAAMe,EAAkBpN,MAAMuD,mBAAmBwF,KAAKvF,OAAQ7C,CAAM,EAC9D0M,EAAaC,cAAcF,CAAe,EAChD,IAAM5B,EAAY,CACd3L,UAAWA,GAAa,GACxBsE,uBAAwBiJ,EAAgBjJ,uBACxCE,eAAgB+I,EAAgB/I,eAChC2I,uBAAwBA,EACxBC,qBAAsBA,EACtBM,gBAAiBH,EAAgB7I,gBACjCrC,eAAgBsC,EAChBuI,SAAUD,EACVnM,OAAQA,EACR6M,eAAgBH,EAAWG,eAC3BC,YAAaJ,EAAWI,YACxBC,mBAAoBL,EAAWK,mBAC/BC,cAAeN,EAAWM,aAC9B,EACApG,SAASC,cAAc,2CAA2C,EAAE+D,WAAavL,MAAM+I,KAAKkD,aAAa,cAAeT,CAAS,EAEjIc,EAAqBsB,KAAKlB,CAAQ,CACtC,CACJ,CACA3D,KAAKJ,0BAA4B0D,EACjCtD,KAAKH,uBAAyB9G,EAAM4B,OACpCqF,KAAK8E,kBAAkBvB,CAAoB,EAC3C/E,SAASC,cAAc,kCAAkC,EAAEC,WAAa,IAAMZ,uBAAuBkC,KAAKJ,0BAA2BI,KAAKH,sBAAsB,CACpK,CACqB,IAAjB9G,EAAM4B,QAAyC,IAAzB2I,IACtB9E,SAASC,cAAc,2CAA2C,EAAE+D,UAAY,qFAIpFxC,KAAK+E,gBAAgB,EACrB7C,sBAAsB,CAAA,CAAK,EAC3B,MAEJ,IAAK,iBACD,IAAM9L,EAAca,MAAMuD,mBAAmBwF,KAAKvF,OAAQuF,KAAKL,mBAAmB,EAO5EqF,GANNvC,EAAY,CACR1I,WAAY3D,EAAY2D,WACxB2B,cAAetF,EAAYsF,cAC3BoH,cAAehF,uBAAuB,EACtCmH,iBAAkB,mBACtB,EACgCzG,SAASC,cAAc,gDAAgD,GACnGyG,EAAkB,GAChBC,EAAevO,aAAaC,QAAQ,iBAAiB,EAE3D,GAAwC,EAAnCT,EAAYsF,cAAcf,OAAa,CACxCqK,EAAwBxC,UAAY,GACpC,IAAK,IAAMxK,KAAW5B,EAAYsF,cAAe,CAE7C,IADA0J,EAAeC,OAAOF,CAAY,IAAME,OAAOrN,EAAQmE,aAAa,EAC9DmI,EAAaC,cAAc,CAC7BnJ,uBAAwBpD,EAAQgE,uBAChCV,eAAgBtD,EAAQiE,kBACxBmJ,aAAcA,CAClB,CAAC,EACKE,EAAc,CAChBrJ,kBAAmBjE,EAAQiE,kBAC3BrC,YAAa5B,EAAQ4B,YACrBE,YAAa9B,EAAQ8B,YACrBoC,YAAalE,EAAQkE,YACrBnC,WAAY0I,EAAU1I,WACtB+I,cAAeL,EAAUK,cACzByC,8BAA+BH,EACzB,2CACA,4CACNX,eAAgBH,EAAWG,eAC3BC,YAAaJ,EAAWI,YACxBC,mBAAoBL,EAAWK,mBAC/BC,cAAeN,EAAWM,aAC9B,EAC6C/G,KAAAA,IAAzCqH,EAAgBlN,EAAQ8B,eACxBoL,EAAgBlN,EAAQ8B,aAAe,IAGvCoL,EAAgBlN,EAAQ8B,aAAa+K,KAAKS,CAAW,CAE7D,CACAvJ,IAAIyJ,EAAkB,GACtB,IAAK,IAAMC,KAAOP,EAAiB,CAC/BnJ,IAGW2J,EAHPC,EAAqBT,EAAgBO,GACzC1J,IAAI6J,EAAyB,GAE7B,IAAWF,KADXC,EAAmBhK,KAAK,CAACC,EAAGC,IAAMD,EAAEM,YAAY2J,cAAchK,EAAEK,WAAW,CAAC,EACpDyJ,EAAoB,CACxC5J,IAAI+J,EAAqBH,EAAmBD,GAC5CE,GAA0B3O,MAAM+I,KAAKkD,aAAa,0BAA2B4C,CAAkB,CACnG,CACAN,GAAmBvO,MAAM+I,KAAKkD,aAAa,6BAA8B,CAAC6C,mBAAoBN,EAAKO,mBAAoBJ,CAAsB,CAAC,CAClJ,CACAZ,EAAwBxC,UAAYgD,CACxC,MACIR,EAAwBxC,UAAY,cAIxCyD,WAAW,KACP,IAAMC,EAAmB1H,SAASC,cAAc,8BAA8B,EAC9EyH,EAAiBC,SAAS,CACtBC,IAAKF,EAAiBG,aACtBC,SAAU,QACd,CAAC,CACL,EAAG,CAAC,EAEJ,IAAMC,EAAW/H,SAASC,cAAc,wCAAwC,EAC5E8H,GACAA,EAASxF,iBAAiB,SAAU7K,MAAOsQ,IACvCA,EAAEC,eAAe,EACjB,IAAMC,EAAQH,EAAS9H,cAAc,yCAAyC,EACxEjC,EAAckK,EAAMzF,MAAM9C,KAAK,EACrC,GAAK3B,EAAL,CACAkK,EAAM/E,SAAW,CAAA,EACjB,IACI1K,MAAMqF,eAAe0D,KAAKvF,OAAQuF,KAAKL,oBAAqBnD,CAAW,EACvEkK,EAAMzF,MAAQ,GACdhK,MAAM+I,KAAKG,oBAAoB,gBAAgB,EAC/C+B,sBAAsB,CAAA,CAAK,CAG/B,CAFE,MAAO3F,GACLoK,MAAM,gCAAkCpK,EAAIqK,OAAO,CACvD,CACAF,EAAM/E,SAAW,CAAA,CAVO,CAW5B,CAAC,CAMb,CAEMkF,EAA4BrI,SAASC,cAAc,oCAAoC,EAC7F,GAAKoI,EAA4B,CAC7B,IAAMC,EAAc9G,KACpB6G,EAA0B9F,iBAAiB,QAAS,SAASyF,EAAGO,EAAOD,GACnEC,EAAK5G,oBAAoB,YAAY,CACzC,CAAC,CACL,CAEM6G,EAAsBxI,SAASC,cAAc,6CAA6C,EAWhG,OAVKuI,GACDA,EAAoBjG,iBAAiB,QAAS,SAASyF,GACnDA,EAAEC,eAAe,EACjBE,MAAM,sCAAsC,CAChD,CAAC,EAGLnI,SAASC,cAAc,gCAAgC,GAAGsC,iBAAiB,QAAS,KAChFf,KAAKiH,KAAK,CACd,CAAC,EACM7E,CACX,CAEA2C,kBACIvG,SAAS0I,iBAAiB,aAAa,EAAEC,QAAQC,IAC7CA,EAAKrG,iBAAiB,QAAS7K,UAE3BmR,iBADiBzF,KAAKgC,MAAMwD,EAAKE,aAAa,gBAAgB,CAAC,CACtC,EACzBtH,KAAKL,oBAAsByH,EAAKE,aAAa,cAAc,EAC3DrQ,MAAM+I,KAAKG,oBAAoB,gBAAgB,EAC/C+B,sBAAsB,CAAA,CAAK,CAC/B,CAAC,CACL,CAAC,CACL,CAWAgB,mBAAmBX,EAAcE,EAAY,IACzC,IAGY8E,EAAKtG,EAFjBlF,IAAIyL,EAAWvQ,MADEA,MAAMC,4BAA4BqL,QAAmB,GACxCkF,KAAK,EAEnC,IAAW,CAACF,EAAKtG,KAAUR,OAAOG,QAAQ6B,CAAS,EAAG,CAClD,IAAMiF,OAAmBH,MACzBC,EAAWA,EAASG,WAAWD,EAAazG,CAAK,CACrD,CAEA,OAAOuG,CACX,CAEApE,qBACI,GAAI,CAACxM,aAAaC,QAAQ,oBAAoB,EAC1C,MAAO,GAGX,IAAMH,EAAesJ,KAAKvF,OAAO/D,aAC3BP,EAAYS,aAAaC,QAAQ,oBAAoB,EAGrD+Q,GADQ3Q,MAAM6B,gBAAgBpC,EAAcP,EAAW6J,KAAKvF,OAAOpE,UAAW2J,KAAKvF,OAAO9D,SAAS,GAC7EgG,OAAO1D,GACxBA,EAAKjC,QACf,EACK6Q,EAAmBrJ,SAASK,eAAe,gCAAgC,EAC5EgJ,IACDA,EAAiBnJ,UAAYkJ,EAAcjN,OAC3CkN,EAAiBlJ,UAAUC,OAAO,QAAQ,EAElD,CAYAmD,iBAAiB3L,GACRQ,aAAaC,QAAQ,oBAAoB,IAE1CI,MAAMmH,aAAahI,CAAW,EAEzBA,EAAY+K,cACblK,MAAM+I,KAAKpH,UAAUxC,CAAW,GAIxC,IAAMD,EAAYS,aAAaC,QAAQ,oBAAoB,EAE3D,OAAOV,EAIMiG,iBAAiBjG,EAAWC,CAAW,EAFzC,CAAC6L,YAAa,CAAA,CAAI,CAGjC,CAEArJ,UAAUxC,GACN,IAAMiI,EAAYjI,EAAYiI,UACxB8C,EAAe/K,EAAY+K,aAEjC,OAAOvI,UAAUyF,EAAW8C,CAAY,EACnC5C,KAAK/H,IACF,GAAIA,CAAAA,EAASL,UAKT,MAAM,IAAImB,MAAM,kCAAkC,EAJlDV,aAAamI,QAAQ,qBAAsBvI,EAASL,SAAS,EAC7DS,aAAamI,QAAQ,kBAAmBvI,EAASkC,MAAM,EACvD9B,aAAamI,QAAQ,gBAAiBvI,EAAS6B,KAAK,CAI5D,CAAC,EACA4G,MAAMC,IACH,MAAMA,CACV,CAAC,CACT,CAKA+H,OACIjH,KAAKqD,oBAAoB,EACzBrD,KAAKG,oBAAoB,MAAM,CACnC,CAEAkD,sBAEkB7E,SAAS0I,iBAAiB,qCAA4B,EAC9DC,QAAQW,IAEV,IADA,IAAMC,EAASD,EAAKE,WACbF,EAAKG,YACRF,EAAOG,aAAaJ,EAAKG,WAAYH,CAAI,EAE7CC,EAAOI,YAAYL,CAAI,CAC3B,CAAC,CACL,CAEAhD,kBAAkBvB,GACd,GAAqC,IAAhCA,EAAqB5I,OAA1B,CAGAoB,IAAIqM,EAAc,IAAIC,IAEtB9E,EAAqB4D,QAAQmB,IACzB,IAAM1K,EAAU2K,qBAAqBD,EAAKtE,QAAQ,EAC3CoE,EAAYI,IAAI5K,CAAO,GAC1BwK,EAAYK,IAAI7K,EAAS,EAAE,EAEXwK,EAAYM,IAAI9K,CAAO,EAC/BiH,KAAK,CACb8D,oBAAqBL,EAAKM,oBAC1BC,kBAAmBP,EAAKQ,iBAC5B,CAAC,CACL,CAAC,EAIDV,EAAYjB,QAAQ,CAAC4B,EAAyBnL,KAE1C,GAAOA,GAIFA,EAA0B,EAA1BA,EAAQoL,SAASrO,QAAtB,CAKA,IAAMsO,EAAY,GAUdxB,GATJsB,EAAwB5B,QAAQ+B,IAC5BD,EAAUpE,KACN,CAAEsE,IAAKD,EAAuBP,oBAAqB5I,KAAM,OAAQ,EACjE,CAAEoJ,IAAKD,EAAuBL,kBAAmB9I,KAAM,KAAM,CACjE,CACJ,CAAC,EAEDkJ,EAAUtN,KAAK,CAACC,EAAGC,IAAMA,EAAEsN,IAAMvN,EAAEuN,GAAG,EAE3BvL,EAAQ4E,WACf4G,EAAoB,KACpBC,EAA6B,GACjCJ,EAAU9B,QAAQmC,IACdvN,IAAIwN,EAAY9B,EAAK+B,UAAUF,EAASH,IAAKC,GAAwCE,EAASH,GAAG,EAE7FrB,GADJsB,EAAoBE,EAASH,IACA,UAAlBG,EAASvJ,KA7BC,oDACC,WA6BtBsJ,EAA2BI,QAAQF,CAAS,EAC5CF,EAA2BI,QAAQ3B,CAAI,CAC3C,CAAC,EACDlK,EAAQ4E,UAAYiF,EAAK+B,UAAU,EAAGJ,CAAiB,EAAIC,EAA2BK,KAAK,EAAE,CArB7F,CAsBJ,CAAC,CAjDD,CAkDJ,CAEAtJ,8BAEmB5B,SAAS0I,iBAAiB,4BAA4B,EAC9DC,QAAQT,IACPA,EAAMzF,OACNyF,EAAM/H,UAAUgL,IAAI,WAAW,EAGnCjD,EAAM3F,iBAAiB,QAAS,KACxB2F,EAAMzF,MACNyF,EAAM/H,UAAUgL,IAAI,WAAW,EAE/BjD,EAAM/H,UAAUC,OAAO,WAAW,CAE1C,CAAC,EAED8H,EAAM3F,iBAAiB,OAAQ,KACtB2F,EAAMzF,OACPyF,EAAM/H,UAAUC,OAAO,WAAW,CAE1C,CAAC,CACL,CAAC,EAnBD,IAsBMgL,EAAsBpL,SAASC,cAAc,iCAAiC,EAC/EmL,GACDA,EAAoB7I,iBAAiB,QAAS,WAC1Cf,KAAK6J,QAAQ,4BAA4B,EAAElL,UAAUmL,OAAO,QAAQ,CACxE,CAAC,CAET,CACJ,CAEA,IAAIrK,aAAe,GACfsK,cAAgB,KA6BpB,SAASC,WAAWvK,EAAcwK,EAAalK,GAEvCN,GAAgB,CAACwK,GACjB,IAAI1K,uBAAuBE,EAAcM,CAAI,CAErD,CAOA,SAASmK,gBAAgBzK,GACrB1D,IAAI+H,EAAUK,OAAOxB,SAASyB,KAC1B5E,EAAeC,EAAajC,SAAS,EACnC2M,EAAe1K,EAAa0K,aAC5BC,EAAc3K,EAAa2K,YAC3BC,EAAsD,UAApC5K,EAAa6K,UAAUC,SAAuB9K,EAAa6K,UAAUtC,WAAavI,EAAa6K,UACvH,MAAO,CACH1B,oBAAqB4B,KAAKC,IAAIN,EAAcC,CAAW,EACvDtB,kBAAmB0B,KAAKE,IAAIP,EAAcC,CAAW,EACrD5K,aAAcA,EACdsE,QAASA,EACTE,SAAU2G,kBAAkBN,CAAe,CAC/C,CACJ,CAQA,SAASM,kBAAkBC,GAEvB,IADA7O,IAAI8O,EAAO,GACJD,GAAM,CACT7O,IAAI+O,EAAQ,EACRC,EAAUH,EAAKI,gBACnB,KAAOD,GACsB,IAArBA,EAAQE,UACRH,CAAK,GAETC,EAAUA,EAAQC,gBAEtBH,EAAKpB,QAAQqB,CAAK,EAClBF,EAAOA,EAAK5C,UAChB,CAKA,OAFA6C,EAAKK,MAAM,EAEJL,CACX,CAQA,SAAStC,qBAAqBsC,GAE1B,GAAK,CAAEA,EACH,OAAO,KAGX9O,IAAI6O,EAAOpM,SACX,IAAKzC,IAAIyH,EAAI,EAAGA,EAAIqH,EAAKlQ,OAAQ6I,CAAC,GAE9B,GAAK,EADLoH,EAAOA,EAAK5B,SAAS6B,EAAKrH,KAEtB,OAAO,KAGf,OAAOoH,CACX,CAOA,SAASO,aAAaC,GAElB,OAAO7C,qBADU6C,EAAmBA,EAAiBpH,SAAW,EAC5B,CACxC,CAOA,SAASqD,iBAAiBwD,GAChBD,EAAOrC,qBAAqBsC,CAAI,EACtC,MAAA,EAAID,CAAAA,GAAQA,CAAAA,EAAKS,iBACbT,EAAKS,eAAe,CAAE/E,SAAU,SAAUgF,MAAO,QAAS,CAAC,EACpD,GAGf,CAEA,SAASpJ,wBACL,IAAMqJ,EAAW/M,SAASgN,uBAAuB,oDAAoD,EACrG,GAAsB,EAAlBD,EAAS5Q,OACT,IAAKoB,IAAIyH,EAAI,EAAGA,EAAI+H,EAAS5Q,OAAS6I,CAAC,GACnC+H,EAAS/H,GAAG/B,MAAMgK,QAAU,OAGpC,IAAMC,EAAyB,CAAC,2CAA4C,iDAC5E,IAAK3P,IAAIyH,EAAI,EAAGA,EAAIkI,EAAuB/Q,OAAS6I,CAAC,GAAI,CACrD,IAAMmI,EAAanN,SAASgN,uBAAuBE,EAAuBlI,EAAE,EAC5E,GAAwB,EAApBmI,EAAWhR,OACX,IAAKoB,IAAIyH,EAAI,EAAGA,EAAImI,EAAWhR,OAAS6I,CAAC,GACrCmI,EAAWnI,GAAG/B,MAAMgK,QAAU,OAG1C,CACJ,CAEA,SAASlH,cAAcqH,GACnB7P,IAAI2I,EACAD,EAEamH,EAAcC,eAAe,cAAc,GAAKD,EAAcxG,aAC/ErJ,IAAI6I,EAAgB,sCAUpB,OAPIH,GADAC,EADyC,OAAzCkH,EAAcxQ,uBACA,mlPAI0BwQ,EAAcxQ,4BACrC,wCACjBwJ,GAAiB,sCAEd,CACHF,YAAaA,EACbD,eAAgBA,EAChBE,mBAfAA,KAAAA,EAgBAC,cAAeA,CACnB,CACJ,CAtKApG,SAASuC,iBAAiB,mBAAoB,KAC1C,IAAIxB,uBAAuB,GAAI,MAAM,CACzC,CAAC,EAEDf,SAASuC,iBAAiB,kBAAmB,SAASyF,GAC9CuD,eACA+B,aAAa/B,aAAa,EAG9BA,cAAgB9D,WAAW,KACvB,IAAM8F,EAAY5H,OAAO6H,aAAa,EAEf,UAAnBD,EAAUhM,MAIViK,WAFqBE,gBAAgB6B,CAAS,EAC5BvN,SAASC,cAAc,gCAAgC,EACnC,cAAc,CAE5D,EAAG,GAAI,CACX,CAAC"}