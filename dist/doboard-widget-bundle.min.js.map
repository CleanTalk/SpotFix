{"version":3,"file":"doboard-widget-bundle.min.js","sources":["doboard-widget-bundle.js"],"sourcesContent":["const DOBOARD_API_URL = 'https://api.doboard.com';\r\n\r\n/**\r\n * Makes an API call to the DoBoard endpoint with form data\r\n *\r\n * @param {Object} data - The data to send in the request\r\n * @param {string} method - The API method to call\r\n * @param {string|number} accountId - Optional account ID for the endpoint\r\n *\r\n * @returns {Promise<Object>} The response data when operation_status is 'SUCCESS'\r\n */\r\nconst spotfixApiCall = async(data, method, accountId = undefined) => {\r\n    if (!data || typeof data !== 'object') {\r\n        throw new Error('Data must be a valid object');\r\n    }\r\n\r\n    if (!method || typeof method !== 'string') {\r\n        throw new Error('Method must be a valid string');\r\n    }\r\n\r\n    if (accountId !== undefined && (typeof accountId !== 'string' && typeof accountId !== 'number')) {\r\n        throw new Error('AccountId must be a string or number');\r\n    }\r\n\r\n    const formData = new FormData();\r\n    for (const key in data) {\r\n        if (data.hasOwnProperty(key)) {\r\n            if (data[key] !== undefined && data[key] !== null) {\r\n                formData.append(key, data[key]);\r\n            }\r\n        }\r\n    }\r\n\r\n    let endpointUrl;\r\n    if (accountId !== undefined) {\r\n        endpointUrl = `${DOBOARD_API_URL}/${accountId}/${method}`;\r\n    } else {\r\n        endpointUrl = `${DOBOARD_API_URL}/${method}`;\r\n    }\r\n\r\n    try {\r\n        new URL(endpointUrl);\r\n    } catch (error) {\r\n        throw new Error(`Invalid endpoint URL: ${endpointUrl}`);\r\n    }\r\n\r\n    let response;\r\n    try {\r\n        response = await fetch(endpointUrl, {\r\n            method: 'POST',\r\n            body: formData,\r\n        });\r\n    } catch (networkError) {\r\n        throw new Error(`Network error: ${networkError.message}`);\r\n    }\r\n\r\n    let responseBody;\r\n    try {\r\n        responseBody = await response.json();\r\n    } catch (parseError) {\r\n        throw new Error('Failed to parse JSON response from server');\r\n    }\r\n\r\n    if (!responseBody || typeof responseBody !== 'object') {\r\n        throw new Error('Invalid response format from server');\r\n    }\r\n\r\n    if (!responseBody.data) {\r\n        throw new Error('Missing data field in server response');\r\n    }\r\n\r\n    if (!responseBody.data.operation_status) {\r\n        throw new Error('Missing operation_status in response data');\r\n    }\r\n\r\n    if (responseBody.data.operation_status === 'FAILED') {\r\n        const errorMessage = responseBody.data.operation_message || 'Operation failed without specific message';\r\n        throw new Error(errorMessage);\r\n    }\r\n\r\n    if (responseBody.data.operation_status === 'SUCCESS') {\r\n        return responseBody.data;\r\n    }\r\n\r\n    throw new Error(`Unknown operation status: ${responseBody.data.operation_status}`);\r\n}\r\n\r\nconst userConfirmEmailDoboard = async (emailConfirmationToken) => {\r\n    const data = {\r\n        email_confirmation_token: encodeURIComponent(emailConfirmationToken)\r\n    }\r\n    const result = await spotfixApiCall(data, 'user_confirm_email');\r\n    return {\r\n        sessionId: result.session_id,\r\n        userId: result.user_id,\r\n        email: result.email,\r\n        accounts: result.accounts,\r\n        operationStatus: result.operation_status\r\n    };\r\n};\r\n\r\nconst createTaskDoboard = async (sessionId, taskDetails) => {\r\n    const accountId = taskDetails.accountId;\r\n    const data = {\r\n        session_id: sessionId,\r\n        project_token: taskDetails.projectToken,\r\n        project_id: taskDetails.projectId,\r\n        user_id: localStorage.getItem('spotfix_user_id'),\r\n        name: taskDetails.taskTitle,\r\n        comment: taskDetails.taskDescription,\r\n        meta: taskDetails.taskMeta,\r\n        task_type: 'PUBLIC'\r\n    }\r\n    const result = await spotfixApiCall(data, 'task_add', accountId);\r\n    return {\r\n        taskId: result.task_id,\r\n    }\r\n};\r\n\r\nconst createTaskCommentDoboard = async (accountId, sessionId, taskId, comment, projectToken, status = 'ACTIVE') => {\r\n    const data = {\r\n        session_id: sessionId,\r\n        project_token: projectToken,\r\n        task_id: taskId,\r\n        comment: comment,\r\n        status: status\r\n    }\r\n    const result = await spotfixApiCall(data, 'comment_add', accountId);\r\n    return {\r\n        commentId: result.comment_id,\r\n    };\r\n};\r\n\r\nconst attachmentAddDoboard = async (fileData) => {\r\n    const accountId = fileData.params.accountId;\r\n    const data = {\r\n        session_id: fileData.sessionId,\r\n        project_token: fileData.params.projectToken,\r\n        account_id: fileData.params.accountId,\r\n        comment_id: fileData.commentId,\r\n        filename: fileData.fileName,\r\n        file: fileData.fileBinary,\r\n        attachment_order: fileData.attachmentOrder\r\n    }\r\n    const result = await spotfixApiCall(data, 'attachment_add', accountId);\r\n    // @ToDo need to handle result?\r\n};\r\n\r\nconst registerUserDoboard = async (projectToken, accountId, email, nickname, pageURL) => {\r\n    let data = {\r\n        project_token: projectToken,\r\n        account_id: accountId,\r\n        confirmation_url: email,\r\n    }\r\n    if (email && nickname) {\r\n        data.email = email;\r\n        data.name = nickname;\r\n    }\r\n\r\n    if (localStorage.getItem('bot_detector_event_token')) {\r\n        try {\r\n            const botDetectorData = JSON.parse(localStorage.getItem('bot_detector_event_token'));\r\n            if (botDetectorData?.value) {\r\n                data.bot_detector_event_token = botDetectorData?.value;\r\n            }\r\n        } catch (error) {\r\n            data.bot_detector_event_token = '';\r\n        }\r\n    }\r\n    const result = await spotfixApiCall(data, 'user_registration');\r\n    return {\r\n        sessionId: result.session_id,\r\n        userId: result.user_id,\r\n        email: result.email,\r\n        accountExists: result.user_email_confirmed === 1,\r\n        operationMessage: result.operation_message,\r\n        operationStatus: result.operation_status,\r\n        userEmailConfirmed: result.user_email_confirmed,\r\n    };\r\n};\r\n\r\nconst loginUserDoboard = async (email, password) => {\r\n    const data = {\r\n        email: email,\r\n        password: password,\r\n    }\r\n    const result = await spotfixApiCall(data, 'user_authorize');\r\n    return {\r\n        sessionId: result.session_id,\r\n        userId: result.user_id,\r\n        email: result.email,\r\n        accountExists: result.user_email_confirmed === 1,\r\n        operationMessage: result.operation_message,\r\n        operationStatus: result.operation_status,\r\n        userEmailConfirmed: result.user_email_confirmed,\r\n    }\r\n}\r\n\r\nconst logoutUserDoboard = async (projectToken, accountId) => {\r\n    const sessionId = localStorage.getItem('spotfix_session_id');\r\n    if(sessionId && accountId) {\r\n        const data = {\r\n            session_id: sessionId,\r\n        };\r\n\r\n        const email = localStorage.getItem('spotfix_email') || '';\r\n\r\n        if (email && email.includes('spotfix_')) {\r\n            data.project_token = projectToken;\r\n        }\r\n\r\n        const result = await spotfixApiCall(data, 'user_unauthorize', accountId);\r\n        if (result.operation_status === 'SUCCESS') {\r\n            clearLocalstorageOnLogout();\r\n        }\r\n    }\r\n}\r\n\r\nconst getTasksDoboard = async (projectToken, sessionId, accountId, projectId, userId) => {\r\n    const data = {\r\n        session_id: sessionId,\r\n        project_token: projectToken,\r\n        project_id: projectId,\r\n        task_type: 'PUBLIC'\r\n    }\r\n    if ( userId ) {\r\n        data.user_id = userId;\r\n    }\r\n    const result = await spotfixApiCall(data, 'task_get', accountId);\r\n    const tasks = result.tasks.map(task => ({\r\n        taskId: task.task_id,\r\n        taskTitle: task.name,\r\n        taskLastUpdate: task.updated,\r\n        taskCreated: task.created,\r\n        taskCreatorTaskUser: task.creator_user_id,\r\n        taskMeta: task.meta,\r\n        taskStatus: task.status,\r\n    }));\r\n\r\n    storageSaveTasksCount(tasks);\r\n\r\n    return tasks;\r\n}\r\n\r\n\r\nconst getTasksCommentsDoboard = async (sessionId, accountId, projectToken, status = 'ACTIVE') => {\r\n    const data = {\r\n        session_id: sessionId,\r\n        project_token: projectToken,\r\n        status: status\r\n    }\r\n    const result = await spotfixApiCall(data, 'comment_get', accountId);\r\n    return result.comments.map(comment => ({\r\n        taskId: comment.task_id,\r\n        commentId: comment.comment_id,\r\n        userId: comment.user_id,\r\n        commentBody: comment.comment,\r\n        commentDate: comment.updated,\r\n        status: comment.status,\r\n        issueTitle: comment.task_name,\r\n    }));\r\n};\r\n\r\nconst getUserDoboard = async (sessionId, projectToken, accountId, userId) => {\r\n    const data = {\r\n        session_id: sessionId,\r\n        project_token: projectToken,\r\n    }\r\n    if (userId) data.user_id = userId;\r\n\r\n    const result = await spotfixApiCall(data, 'user_get', accountId);\r\n    return result.users;\r\n\r\n    // @ToDo Need to handle these two different answers?\r\n    /*// Format 1: users inside data\r\n    if (responseBody.data && responseBody.data.operation_status) {\r\n        if (responseBody.data.operation_status === 'FAILED') {\r\n            throw new Error(responseBody.data.operation_message);\r\n        }\r\n        if (responseBody.data.operation_status === 'SUCCESS') {\r\n            if (Array.isArray(responseBody.data.users)) {\r\n                return responseBody.data.users;\r\n            }\r\n            return [];\r\n        }\r\n    }\r\n    // Format 2: users at the top level\r\n    if (responseBody.operation_status) {\r\n        if (responseBody.operation_status === 'FAILED') {\r\n            throw new Error(responseBody.operation_message);\r\n        }\r\n        if (responseBody.operation_status === 'SUCCESS') {\r\n            if (Array.isArray(responseBody.users)) {\r\n                return responseBody.users;\r\n            }\r\n            return [];\r\n        }\r\n    }*/\r\n};\r\n\r\nconst userUpdateDoboard = async (projectToken, accountId, sessionId, userId, timezone) => {\r\n    const data = {\r\n        session_id: sessionId,\r\n        project_token: projectToken,\r\n        user_id: userId,\r\n        timestamp: timezone\r\n    }\r\n    await spotfixApiCall(data, 'user_update', accountId);\r\n    return {\r\n        success: true\r\n    };\r\n}\r\n\r\nconst getReleaseVersion = async () => {\r\n    try {\r\n        const res = await fetch('https://api.github.com/repos/CleanTalk/SpotFix/releases');\r\n        const data = await res.json();\r\n\r\n        if (data.length > 0 && data[0].tag_name) {\r\n            storageSaveSpotfixVersion(data[0].tag_name);\r\n            return data[0].tag_name;\r\n        }\r\n\r\n        return null;\r\n    } catch (err) {\r\n        return null;\r\n    }\r\n};\r\n\r\n\nasync function confirmUserEmail(emailConfirmationToken, params) {\r\n\tconst result = await userConfirmEmailDoboard(emailConfirmationToken);\r\n\t// Save session data to LS\r\n\tlocalStorage.setItem('spotfix_email', result.email);\r\n\tlocalStorage.setItem('spotfix_session_id', result.sessionId);\r\n\tlocalStorage.setItem('spotfix_user_id', result.userId);\r\n\r\n\t// Get pending task from LS\r\n\tconst pendingTaskRaw = localStorage.getItem('spotfix_pending_task');\r\n\tif (!pendingTaskRaw) throw new Error('No pending task data');\r\n\r\n\tlet pendingTask;\r\n\ttry {\r\n\t\tpendingTask = JSON.parse(pendingTaskRaw);\r\n\t} catch (error) {\r\n\t\tthrow new Error('Invalid pending task data');\r\n\t}\r\n\r\n\t// Form taskDetails for task creation\r\n\tconst taskDetails = {\r\n\t\ttaskTitle: pendingTask.selectedText || 'New Task',\r\n\t\ttaskDescription: pendingTask.description || '',\r\n\t\tselectedData: pendingTask,\r\n\t\tprojectToken: params.projectToken,\r\n\t\tprojectId: params.projectId,\r\n\t\taccountId: params.accountId,\r\n\t\ttaskMeta: JSON.stringify(pendingTask)\r\n\t};\r\n\r\n\t// Create task\r\n\tconst createdTask = await handleCreateTask(result.sessionId, taskDetails);\r\n\t// Clear pending task\r\n\tlocalStorage.removeItem('spotfix_pending_task');\r\n\r\n\t// Return created task\r\n\treturn createdTask;\r\n}\r\n\r\nasync function getTasksFullDetails(params, tasks, currentActiveTaskId) {\r\n    if (tasks.length > 0) {\r\n        const sessionId = localStorage.getItem('spotfix_session_id');\r\n        const comments = await getTasksCommentsDoboard(sessionId, params.accountId, params.projectToken);\r\n        const users = await getUserDoboard(sessionId, params.projectToken, params.accountId);\r\n\t\tconst foundTask = tasks.find(item => +item.taskId === +currentActiveTaskId);\r\n\r\n        return {\r\n            comments: comments,\r\n            users: users,\r\n\t\t\ttaskStatus: foundTask?.taskStatus,\r\n        };\r\n    }\r\n}\r\n\r\nasync function getUserDetails(params) {\r\n\t\tconst sessionId = localStorage.getItem('spotfix_session_id');\r\n\t\tconst currentUserId = localStorage.getItem('spotfix_user_id');\r\n\t\tif(currentUserId) {\r\n\t\t\tconst users = await getUserDoboard(sessionId, params.projectToken, params.accountId, currentUserId);\r\n\t\t\treturn users[0] || {};\r\n\t\t}\r\n}\r\n\r\nasync function handleCreateTask(sessionId, taskDetails) {\r\n\ttry {\r\n\t\tconst result = await createTaskDoboard(sessionId, taskDetails);\r\n\t\tif (result && result.taskId && taskDetails.taskDescription) {\r\n            const sign = `<br><br><br><em>The spot has been posted at the following URL <a href=\"${window.location.href}\"><span class=\"task-link task-link--done\">${window.location.href}</span></a></em>`;\r\n\t\t\tawait addTaskComment({\r\n\t\t\t\tprojectToken: taskDetails.projectToken,\r\n\t\t\t\taccountId: taskDetails.accountId\r\n\t\t\t}, result.taskId, taskDetails.taskDescription+sign);\r\n\t\t}\r\n\t\treturn result;\r\n\t} catch (err) {\r\n\t\tthrow err;\r\n\t}\r\n}\r\n\r\nasync function addTaskComment(params, taskId, commentText) {\r\n\tconst sessionId = localStorage.getItem('spotfix_session_id');\r\n\tif (!sessionId) throw new Error('No session');\r\n\tif (!params.projectToken || !params.accountId) throw new Error('Missing params');\r\n\treturn await createTaskCommentDoboard(params.accountId, sessionId, taskId, commentText, params.projectToken);\r\n}\r\n\r\nfunction getUserTasks(params) {\r\n\tif (!localStorage.getItem('spotfix_session_id')) {\r\n\t\treturn {};\r\n\t}\r\n\tconst projectToken = params.projectToken;\r\n\tconst sessionId = localStorage.getItem('spotfix_session_id');\r\n\tconst userId = localStorage.getItem('spotfix_user_id');\r\n\treturn getTasksDoboard(projectToken, sessionId, params.accountId, params.projectId, userId);\r\n}\r\n\r\nasync function getAllTasks(params) {\r\n\tif (!localStorage.getItem('spotfix_session_id')) {\r\n\t\treturn {};\r\n\t}\r\n\tconst projectToken = params.projectToken;\r\n\tconst sessionId = localStorage.getItem('spotfix_session_id');\r\n\tconst tasksData = await getTasksDoboard(projectToken, sessionId, params.accountId, params.projectId);\r\n\r\n    // Get only tasks with metadata\r\n\tconst filteredTaskData =  tasksData.filter(task => {\r\n        return task.taskMeta;\r\n    });\r\n\r\n    return filteredTaskData;\r\n}\r\n\r\nfunction formatDate(dateStr) {\r\n\t const months = [\r\n\t \t\"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\r\n\t \t\"July\", \"August\", \"September\", \"October\", \"November\", \"December\"\r\n\t ];\r\n\t // dateStr expected format: 'YYYY-MM-DD HH:mm:ss' or 'YYYY-MM-DDTHH:mm:ssZ'\r\n\t if (!dateStr) return { date: '', time: '' };\r\n\t let dateObj;\r\n\t if (dateStr.includes('T')) {\r\n\t  dateObj = new Date(dateStr);\r\n\t } else if (dateStr.includes(' ')) {\r\n\t  dateObj = new Date(dateStr.replace(' ', 'T'));\r\n\t } else {\r\n\t  dateObj = new Date(dateStr);\r\n\t }\r\n\t if (isNaN(dateObj.getTime())) return { date: '', time: '' };\r\n\r\n\t // Adjust to local timezone\r\n\t const offsetMinutes = dateObj.getTimezoneOffset();\r\n\t let localDateObj = new Date(dateObj.getTime() - offsetMinutes * 60000);\r\n\r\n\t const month = months[localDateObj.getMonth()];\r\n\t const day = localDateObj.getDate();\r\n\t const date = `${month} ${day}`;\r\n\t const hours = localDateObj.getHours().toString().padStart(2, '0');\r\n\t const minutes = localDateObj.getMinutes().toString().padStart(2, '0');\r\n\t const time = `${hours}:${minutes}`;\r\n\t return { date, time };\r\n}\r\n\r\nfunction getTaskAuthorDetails(params, taskId) {\r\n\tconst sessionId = localStorage.getItem('spotfix_session_id');\r\n\tconst mockUsersData =\r\n\t\t[\r\n\t\t\t{\r\n\t\t\t\t'taskId': '1',\r\n\t\t\t\t'taskAuthorAvatarImgSrc': 'https://s3.eu-central-1.amazonaws.com/cleantalk-ctask-atts/accounts/1/avatars/081a1b65d20fe318/m.jpg',\r\n\t\t\t\t'taskAuthorName': 'Test All Issues Single Author Name'\r\n\t\t\t}\r\n\t\t]\r\n\r\n\tconst defaultData =\r\n\t\t{\r\n\t\t\t'taskId': null,\r\n\t\t\t'taskAuthorAvatarImgSrc': null,\r\n\t\t\t'taskAuthorName': 'Task Author'\r\n\t\t};\r\n\r\n\tconst data = mockUsersData.find((element) => element.taskId === taskId);\r\n\treturn data === undefined ? defaultData : data;\r\n}\r\n\r\nfunction getIssuesCounterString(onPageSpotsCount, totalSpotsCount) {\r\n\treturn ` (${onPageSpotsCount}/${totalSpotsCount})`;\r\n}\r\n\r\n// Get the author's avatar\r\nfunction getAvatarSrc(author) {\r\n\tif (author && author.avatar) {\r\n\t\tif (typeof author.avatar === 'object' && author.avatar.m) {\r\n\t\t\treturn author.avatar.m;\r\n\t\t} else if (typeof author.avatar === 'string') {\r\n\t\t\treturn author.avatar;\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\n// Get the author's name\r\nfunction getAuthorName(author) {\r\n\tif (author) {\r\n\t\tif (author.name && author.name.trim().length > 0) {\r\n\t\t\treturn author.name;\r\n\t\t} else if (author.email && author.email.trim().length > 0) {\r\n\t\t\treturn author.email;\r\n\t\t}\r\n\t}\r\n\treturn 'Unknown Author';\r\n}\r\n\r\nfunction registerUser(taskDetails) {\r\n\tconst userEmail = taskDetails.userEmail;\r\n\tconst userName = taskDetails.userName;\r\n\tconst projectToken = taskDetails.projectToken;\r\n\tconst accountId = taskDetails.accountId;\r\n\tconst pageURL = taskDetails.selectedData.pageURL ? taskDetails.selectedData.pageURL : window.location.href;\r\n\r\n\tconst resultRegisterUser = (showMessageCallback) => registerUserDoboard(projectToken, accountId, userEmail, userName, pageURL)\r\n\t\t.then(response => {\r\n\t\t\tif (response.accountExists) {\r\n\t\t\t\tdocument.querySelector(\".doboard_task_widget-accordion>.doboard_task_widget-input-container\").innerText = ksesFilter('Account already exists. Please, login usin your password.');\r\n\t\t\t\tdocument.querySelector(\".doboard_task_widget-accordion>.doboard_task_widget-input-container.hidden\").classList.remove('hidden');\r\n\t\t\t\tdocument.getElementById(\"doboard_task_widget-user_password\").focus();\r\n\t\t\t} else if (response.sessionId) {\r\n\t\t\t\tlocalStorage.setItem('spotfix_session_id', response.sessionId);\r\n\t\t\t\tlocalStorage.setItem('spotfix_user_id', response.userId);\r\n\t\t\t\tlocalStorage.setItem('spotfix_email', response.email);\r\n\t\t\t\tuserUpdate(projectToken, accountId);\r\n\t\t\t} else if (response.operationStatus === 'SUCCESS' && response.operationMessage && response.operationMessage.length > 0) {\r\n\t\t\t\tif (response.operationMessage == 'Waiting for email confirmation') {\r\n\t\t\t\t\tresponse.operationMessage = 'Waiting for an email confirmation. Please check your Inbox.';\r\n\t\t\t\t}\r\n\t\t\t\tif (typeof showMessageCallback === 'function') {\r\n\t\t\t\t\tshowMessageCallback(response.operationMessage, 'notice');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error('Session ID not found in response');\r\n\t\t\t}\r\n\t\t})\r\n\t\t.catch(error => {\r\n\t\t\tthrow error;\r\n\t\t});\r\n\r\n\t\treturn resultRegisterUser;\r\n}\r\n\r\nfunction loginUser(taskDetails) {\r\n\tconst userEmail = taskDetails.userEmail;\r\n\tconst userPassword = taskDetails.userPassword;\r\n\r\n\treturn (showMessageCallback) => loginUserDoboard(userEmail, userPassword)\r\n\t\t.then(response => {\r\n\t\t\tif (response.sessionId) {\r\n\t\t\t\tlocalStorage.setItem('spotfix_session_id', response.sessionId);\r\n\t\t\t\tlocalStorage.setItem('spotfix_user_id', response.userId);\r\n\t\t\t\tlocalStorage.setItem('spotfix_email', userEmail);\r\n\t\t\t}  else if (response.operationStatus === 'SUCCESS' && response.operationMessage && response.operationMessage.length > 0) {\r\n\t\t\t\tif (typeof showMessageCallback === 'function') {\r\n\t\t\t\t\tshowMessageCallback(response.operationMessage, 'notice');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error('Session ID not found in response');\r\n\t\t\t}\r\n\t\t})\r\n\t\t.catch(error => {\r\n\t\t\tthrow error;\r\n\t\t});\r\n}\r\n\r\nfunction userUpdate(projectToken, accountId) {\r\n\tconst sessionId = localStorage.getItem('spotfix_session_id');\r\n\tconst userId = localStorage.getItem('spotfix_user_id');\r\n\tconst timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\r\n\r\n\treturn userUpdateDoboard(projectToken, accountId, sessionId, userId, timezone);\r\n}\r\n\r\nfunction spotFixSplitUrl(url) {\r\n\ttry {\r\n\t\tif (!url || url.trim() === '') {\r\n\t\t\treturn '';\r\n\t\t}\r\n\t\tconst u = new URL(url);\r\n\t\tconst domain = u.host;\r\n\r\n\t\tconst segments = u.pathname.split('/').filter(Boolean);\r\n\r\n\t\tif (segments.length === 0) {\r\n\t\t\treturn domain;\r\n\t\t}\r\n\r\n\t\tconst reversed = segments.reverse();\r\n\t\treversed.push(domain);\r\n\t\treturn reversed.join(' / ');\r\n\t} catch (error) {\r\n\t\treturn '';\r\n\t}\r\n\r\n}\r\n\r\nfunction setToggleStatus(rootElement){\r\n\tconst clickHandler = () => {\r\n\t\tconst timer = setTimeout(() => {\r\n\t\t\tlocalStorage.setItem('spotfix_widget_is_closed', '1');\r\n\t\t\trootElement.hide();\r\n\t\t\tclearTimeout(timer);\r\n\t\t}, 300);\r\n\t};\r\n\tconst toggle = document.getElementById('widget_visibility');\r\n\tif(toggle) {\r\n\t\ttoggle.checked = true;\r\n\t\ttoggle.addEventListener('click', clickHandler);\r\n\t}\r\n}\r\n\r\nfunction checkLogInOutButtonsVisible (){\r\n\tif(!localStorage.getItem('spotfix_session_id')) {\r\n\t\tconst el = document\r\n\t\t\t.getElementById('doboard_task_widget-user_menu-logout_button')\r\n\t\t\t?.closest('.doboard_task_widget-user_menu-item');\r\n\t\t\tif(el) el.style.display = 'none';\r\n\t} else {\r\n\t\tconst el = document.getElementById('doboard_task_widget-user_menu-signlog_button');\r\n\t\tif(el) el.style.display = 'none';\r\n\t}\r\n}\r\n\r\nfunction changeSize(container){\r\n\tif(container && +localStorage.getItem('maximize')){\r\n\t\tcontainer.classList.add('doboard_task_widget-container-maximize');\r\n\t} else if(container) {\r\n\t\tcontainer.classList.remove('doboard_task_widget-container-maximize');\r\n\t}\r\n}\r\n\n/**\r\n * Widget class to create a task widget\r\n */\r\nclass CleanTalkWidgetDoboard {\r\n    selectedText = '';\r\n    selectedData = {};\r\n    widgetElement = null;\r\n    params = {};\r\n    currentActiveTaskId = 0;\r\n    savedIssuesQuantityOnPage = 0;\r\n    savedIssuesQuantityAll = 0;\r\n    allTasksData = {};\r\n    srcVariables = {};\r\n\r\n    /**\r\n     * Constructor\r\n     */\r\n    constructor(selectedData, type) {\r\n        this.selectedData = selectedData || '';\r\n        this.selectedText = selectedData?.selectedText || '';\r\n        this.init(type);\r\n        this.srcVariables = {\r\n            buttonCloseScreen: SpotFixSVGLoader.getAsDataURI('buttonCloseScreen'),\r\n            iconEllipsesMore: SpotFixSVGLoader.getAsDataURI('iconEllipsesMore'),\r\n            iconPlus: SpotFixSVGLoader.getAsDataURI('iconPlus'),\r\n            iconMaximize: SpotFixSVGLoader.getAsDataURI('iconMaximize'),\r\n            chevronBack: SpotFixSVGLoader.getAsDataURI('chevronBack'),\r\n            buttonPaperClip: SpotFixSVGLoader.getAsDataURI('buttonPaperClip'),\r\n            buttonSendMessage: SpotFixSVGLoader.getAsDataURI('buttonSendMessage'),\r\n            logoDoBoardGreen: SpotFixSVGLoader.getAsDataURI('logoDoBoardGreen'),\r\n            logoDoBoardWrap: SpotFixSVGLoader.getAsDataURI('logoDoBoardWrap'),\r\n            iconSpotWidgetWrapPencil: SpotFixSVGLoader.getAsDataURI('iconSpotWidgetWrapPencil'),\r\n            iconMarker: SpotFixSVGLoader.getAsDataURI('iconMarker'),\r\n            iconSpotPublic: SpotFixSVGLoader.getAsDataURI('iconSpotPublic'),\r\n            iconSpotPrivate: SpotFixSVGLoader.getAsDataURI('iconSpotPrivate'),\r\n            iconLinkChain: SpotFixSVGLoader.getAsDataURI('iconLinkChain'),\r\n        };\r\n        this.fileUploader = new FileUploader(this.escapeHtml);\r\n    }\r\n\r\n    /**\r\n     * Initialize the widget\r\n     */\r\n    async init(type) {\r\n        this.params = this.getParams();\r\n\r\n        // Check if email_confirmation_token is in URL\r\n        const urlParams = new URLSearchParams(window.location.search);\r\n        const emailToken = urlParams.get('email_confirmation_token');\r\n        if (emailToken) {\r\n            try {\r\n                // Confirm email and create task\r\n                const createdTask = await confirmUserEmail(emailToken, this.params);\r\n                this.allTasksData = await getAllTasks(this.params);\r\n                // Open task interface\r\n                this.currentActiveTaskId = createdTask.taskId;\r\n                type = 'concrete_issue';\r\n                storageSetWidgetIsClosed(false);\r\n                // Clear email_confirmation_token from URL\r\n                urlParams.delete('email_confirmation_token');\r\n                const newUrl = window.location.pathname + (urlParams.toString() ? '?' + urlParams.toString() : '');\r\n                window.history.replaceState({}, document.title, newUrl);\r\n            } catch (err) {\r\n                this.registrationShowMessage('Error confirming email: ' + err.message, 'error');\r\n            }\r\n        } else {\r\n            // Load all tasks\r\n            const isWidgetClosed = localStorage.getItem('spotfix_widget_is_closed');\r\n            if((isWidgetClosed && !this.selectedText) || !isWidgetClosed){\r\n                this.allTasksData = await getAllTasks(this.params);\r\n            }\r\n        }\r\n\r\n        // Check if any task has updates\r\n        let taskHasSiteOwnerUpdate;\r\n\r\n        if (storageTasksHasUnreadUpdates()) {\r\n            taskHasSiteOwnerUpdate = true;\r\n        } else {\r\n            if (type === 'wrap_review') {\r\n                taskHasSiteOwnerUpdate = await checkIfTasksHasSiteOwnerUpdates(\r\n                    this.allTasksData,\r\n                    this.params\r\n                );\r\n            }\r\n        }\r\n        storageSaveTasksUpdateData(this.allTasksData);\r\n        //check to hide on first run\r\n        if (!storageWidgetCloseIsSet()) {\r\n            storageSetWidgetIsClosed(true);\r\n        }\r\n        //check to show if any task has site owner updates\r\n        if (taskHasSiteOwnerUpdate) {\r\n\r\n            storageSetWidgetIsClosed(false);\r\n        }\r\n        this.widgetElement = await this.createWidgetElement(type);\r\n        this.bindWidgetInputsInteractive();\r\n    }\r\n\r\n    getParams() {\r\n        const script = document.querySelector(`script[src*=\"doboard-widget-bundle.\"]`);\r\n        if ( ! script || ! script.src ) {\r\n            throw new Error('Script not provided');\r\n        }\r\n\r\n        const url = new URL(script.src);\r\n        let params = Object.fromEntries(url.searchParams.entries());\r\n        if ( ! params ) {\r\n            throw new Error('Script params not provided');\r\n        }\r\n        if ( ! params.projectToken || ! params.accountId || ! params.projectId ) {\r\n            throw new Error('Necessary script params not provided');\r\n\r\n        }\r\n        return params;\r\n    }\r\n\r\n    /**\r\n     * Binding events to create a task\r\n     */\r\n    bindCreateTaskEvents() {\r\n        const submitButton = document.getElementById('doboard_task_widget-submit_button');\r\n\r\n        if (submitButton) {\r\n            submitButton.addEventListener('click', async () => {\r\n                // Check required fields: Report about and Description\r\n                const taskTitleElement = document.getElementById('doboard_task_widget-title');\r\n                const taskTitle = taskTitleElement.value;\r\n                if ( ! taskTitle ) {\r\n                    taskTitleElement.style.borderColor = 'red';\r\n                    taskTitleElement.focus();\r\n                    taskTitleElement.addEventListener('input', function() {\r\n                        this.style.borderColor = '';\r\n                    });\r\n                    return;\r\n                }\r\n                const taskDescriptionElement = document.getElementById('doboard_task_widget-description')\r\n                const taskDescription = taskDescriptionElement.value;\r\n                if ( ! taskDescription ) {\r\n                    taskDescriptionElement.style.borderColor = 'red';\r\n                    taskDescriptionElement.focus();\r\n                    taskDescriptionElement.addEventListener('input', function() {\r\n                        this.style.borderColor = '';\r\n                    });\r\n                    return;\r\n                }\r\n\r\n                // If login section is open, check required fields: Nickname, Email\r\n                let userName = '';\r\n                let userEmail = '';\r\n                let userPassword = '';\r\n                const loginSectionElement = document.querySelector('.doboard_task_widget-login');\r\n\r\n                if ( loginSectionElement && loginSectionElement.classList.contains('active') ) {\r\n                    const userEmailElement = document.getElementById('doboard_task_widget-user_email');\r\n                    const userNameElement = document.getElementById('doboard_task_widget-user_name');\r\n                    const userPasswordElement = document.getElementById('doboard_task_widget-user_password');\r\n\r\n                    userEmail = userEmailElement.value;\r\n                    if ( ! userEmail ) {\r\n                        userEmailElement.style.borderColor = 'red';\r\n                        userEmailElement.focus();\r\n                        userEmailElement.addEventListener('input', function() {\r\n                            this.style.borderColor = '';\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    // This is the registration request\r\n                    if ( userEmailElement && userNameElement ) {\r\n                        userName = userNameElement.value;\r\n                        if ( ! userName ) {\r\n                            userNameElement.style.borderColor = 'red';\r\n                            userNameElement.focus();\r\n                            userNameElement.addEventListener('input', function() {\r\n                                this.style.borderColor = '';\r\n                            });\r\n                            return;\r\n                        }\r\n                    }\r\n\r\n                    // This is the login request\r\n                    if ( userEmailElement && userPasswordElement && ! userNameElement ) {\r\n                        userPassword = userPasswordElement.value;\r\n                        if ( ! userPassword ) {\r\n                            userPasswordElement.style.borderColor = 'red';\r\n                            userPasswordElement.focus();\r\n                            userPasswordElement.addEventListener('input', function() {\r\n                                this.style.borderColor = '';\r\n                            });\r\n                            return;\r\n                        }\r\n                    }\r\n\r\n                }\r\n\r\n                // If it is the login request\r\n                const userEmailElement = document.getElementById('doboard_task_widget-user_email');\r\n                userEmail = userEmailElement.value;\r\n\r\n                // Make the submit button disable with spinner\r\n                const submitButton = document.getElementById('doboard_task_widget-submit_button');\r\n                submitButton.disabled = true;\r\n                submitButton.innerText = ksesFilter('Creating spot...');\r\n\r\n                let taskDetails = {\r\n                    taskTitle: taskTitle,\r\n                    taskDescription: taskDescription,\r\n                    //typeSend: typeSend,\r\n                    selectedData: this.selectedData,\r\n                    projectToken: this.params.projectToken,\r\n                    projectId: this.params.projectId,\r\n                    accountId: this.params.accountId,\r\n                    taskMeta: JSON.stringify(this.selectedData ? this.selectedData : { pageURL: window.location.href }),\r\n                };\r\n\r\n                if ( userEmail ) {\r\n                    taskDetails.userEmail = userEmail\r\n                }\r\n                if ( userName ) {\r\n                    taskDetails.userName = userName\r\n                }\r\n                if ( userPassword ) {\r\n                    taskDetails.userPassword = userPassword\r\n                }\r\n\r\n                // Save pending task in LS\r\n                localStorage.setItem('spotfix_pending_task', JSON.stringify({\r\n                    ...this.selectedData,\r\n                    description: taskDescription\r\n                }));\r\n\r\n                let submitTaskResult;\r\n                try {\r\n                    submitTaskResult = await this.submitTask(taskDetails);\r\n                } catch (error) {\r\n                    this.registrationShowMessage(error.message);\r\n                    return;\r\n                }\r\n\r\n                // Return the submit button normal state\r\n                submitButton.disabled = false;\r\n                submitButton.style.cursor = 'pointer';\r\n\r\n                if ( submitTaskResult.needToLogin ) {\r\n                    // @ToDo Do not know what to de here: throw an error or pass log message?\r\n                    return;\r\n                }\r\n\r\n                if ( submitTaskResult.isPublic !== undefined ) {\r\n                    this.selectedData.isPublic = submitTaskResult.isPublic\r\n                }\r\n\r\n                // refersh tasks list after creation\r\n                this.allTasksData = await getAllTasks(this.params);\r\n                // save updates\r\n                storageSaveTasksUpdateData(this.allTasksData);\r\n\r\n                this.selectedData = {};\r\n                await this.createWidgetElement('all_issues');\r\n                storageSetWidgetIsClosed(false);\r\n                hideContainersSpinner(false);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create widget element\r\n     * @return {HTMLElement} widget element\r\n     */\r\n    async createWidgetElement(type, showOnlyCurrentPage = false) {\r\n        const widgetContainer = document.querySelector('.doboard_task_widget') ? document.querySelector('.doboard_task_widget') : document.createElement('div');\r\n        widgetContainer.className = 'doboard_task_widget';\r\n        widgetContainer.innerHTML = ksesFilter('');\r\n        widgetContainer.removeAttribute('style');\r\n\r\n        let templateName = '';\r\n        let tasksFullDetails;\r\n\r\n        let templateVariables = {};\r\n\r\n        const config = window.SpotfixWidgetConfig;\r\n        const position = {\r\n            extraCompact: '0vh',\r\n            compact: '5vh',\r\n            extraShort: '15vh',\r\n            short: '20vh',\r\n            regular: '35vh',\r\n            extraRegular: '45vh',\r\n            tall: '60vh',\r\n            extraTall: '70vh',\r\n            extra: '85vh'\r\n        };\r\n\r\n        switch (type) {\r\n            case 'create_issue':\r\n                templateName = 'create_issue';\r\n                this.type_name = templateName;\r\n                templateVariables = {\r\n                    selectedText: this.selectedText,\r\n                    currentDomain: document.location.hostname || '',\r\n                    buttonCloseScreen: SpotFixSVGLoader.getAsDataURI('buttonCloseScreen'),\r\n                    iconMaximize: SpotFixSVGLoader.getAsDataURI('iconMaximize'),\r\n                    iconEllipsesMore: SpotFixSVGLoader.getAsDataURI('iconEllipsesMore'),\r\n                    ...this.srcVariables\r\n                };\r\n                storageGetUserIsDefined() && storageSetWidgetIsClosed(false);\r\n                break;\r\n            case 'wrap':\r\n                if (storageGetWidgetIsClosed()) {\r\n                    return;\r\n                }\r\n\r\n                templateName = 'wrap';\r\n                templateVariables = {position: position[config?.verticalPosition] || position.compact, ...this.srcVariables};\r\n                break;\r\n            case 'wrap_review':\r\n                templateName = 'wrap_review';\r\n                templateVariables = {position: position[config?.verticalPosition] || position.compact, ...this.srcVariables};\r\n                break;\r\n            case 'all_issues':\r\n                templateName = 'all_issues';\r\n                this.type_name = templateName;\r\n                templateVariables = {...this.srcVariables};\r\n                break;\r\n            case 'user_menu':\r\n                templateName = 'user_menu';\r\n                const versionFromLS = localStorage.getItem('spotfix_app_version');\r\n                templateVariables = {\r\n                    spotfixVersion: versionFromLS ? 'Spotfix version ' + versionFromLS + '.' : '',\r\n                    avatar: SpotFixSVGLoader.getAsDataURI('iconAvatar'),\r\n                    iconEye: SpotFixSVGLoader.getAsDataURI('iconEye'),\r\n                    iconDoor: SpotFixSVGLoader.getAsDataURI('iconDoor'),\r\n                    chevronBackDark: SpotFixSVGLoader.getAsDataURI('chevronBackDark'),\r\n                    buttonCloseScreen: SpotFixSVGLoader.getAsDataURI('buttonCloseScreen'),\r\n                    userName: 'Guest',\r\n                    email: localStorage.getItem('spotfix_email') || '',\r\n                    ...this.srcVariables};\r\n                break;\r\n            case 'concrete_issue':\r\n                templateName = 'concrete_issue';\r\n                this.type_name = templateName;\r\n                // Update the number of tasks\r\n                this.savedIssuesQuantityAll = Array.isArray(this.allTasksData) ? this.allTasksData.length : 0;\r\n                // Calculate the number of issues on the current page\r\n                this.savedIssuesQuantityOnPage = Array.isArray(this.allTasksData)\r\n                    ? this.allTasksData.filter(task => {\r\n                        try {\r\n                            const meta = task.taskMeta ? JSON.parse(task.taskMeta) : {};\r\n                            return meta.pageURL === window.location.href;\r\n                        } catch (e) { return false; }\r\n                    }).length\r\n                    : 0;\r\n\r\n                templateVariables = {\r\n                    issueTitle: '...',\r\n                    issueComments: [],\r\n                    issuesCounter: getIssuesCounterString(this.savedIssuesQuantityOnPage, this.savedIssuesQuantityAll),\r\n                    ...this.srcVariables,\r\n                };\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        widgetContainer.innerHTML = this.loadTemplate(templateName, templateVariables);\r\n        document.body.appendChild(widgetContainer);\r\n\r\n        // remove highlights before any screen called\r\n        spotFixRemoveHighlights();\r\n        const container = document.querySelector('.doboard_task_widget-container');\r\n        switch (type) {\r\n            case 'create_issue':\r\n\r\n                if(container && +localStorage.getItem('maximize')){\r\n                    container.classList.add('doboard_task_widget-container-maximize');\r\n                } else if(container) {\r\n                    container.classList.remove('doboard_task_widget-container-maximize');\r\n                }\r\n                // highlight selected item during task creation\r\n                const selection = window.getSelection();\r\n                const sessionIdExists = !!localStorage.getItem('spotfix_session_id');\r\n                const email = localStorage.getItem('spotfix_email');\r\n\r\n                if (sessionIdExists && email && !email.includes('spotfix_')) {\r\n                    document.querySelector('.doboard_task_widget-login').classList.add('hidden');\r\n                }\r\n                if (\r\n                    selection.type === 'Range'\r\n                ) {\r\n                    const selectedData = spotFixGetSelectedData(selection);\r\n                    spotFixScrollToNodePath(selectedData.nodePath);\r\n                    this.positionWidgetContainer();\r\n                }\r\n                // bind creation events\r\n                this.bindCreateTaskEvents();\r\n                break;\r\n            case 'wrap':\r\n                await this.getTaskCount();\r\n                document.querySelector('.doboard_task_widget-wrap').addEventListener('click', (e) => {\r\n                    const widgetElementClasses = e.currentTarget.classList;\r\n                    if (widgetElementClasses && !widgetElementClasses.contains('hidden')) {\r\n                        this.createWidgetElement('all_issues');\r\n                    }\r\n                });\r\n                hideContainersSpinner(false);\r\n                break;\r\n            case 'wrap_review':\r\n                document.querySelector('#doboard_task_widget_button').addEventListener('click', (e) => {\r\n                    spotFixOpenWidget(this.selectedData, 'create_issue');\r\n                });\r\n                break;\r\n            case 'all_issues':\r\n                    changeSize(container);\r\n\r\n                    spotFixRemoveHighlights();\r\n                let issuesQuantityOnPage = 0;\r\n                if (!this.allTasksData?.length) {\r\n                    this.allTasksData = await getAllTasks(this.params);\r\n                }\r\n                const tasks = this.allTasksData;\r\n                tasksFullDetails = await getTasksFullDetails(this.params, tasks, this.currentActiveTaskId);\r\n                let spotsToBeHighlighted = [];\r\n                if (tasks.length > 0) {\r\n                    const currentURL = window.location.href;\r\n                    const sortedTasks = tasks.sort((a, b) => {\r\n                        const aIsHere = JSON.parse(a.taskMeta).pageURL === currentURL ? 1 : 0;\r\n                        const bIsHere = JSON.parse(b.taskMeta).pageURL === currentURL ? 1 : 0;\r\n                        return bIsHere - aIsHere;\r\n                    });\r\n\r\n                    document.querySelector(\".doboard_task_widget-all_issues-container\").innerHTML = '';\r\n\r\n                    for (let i = 0; i < sortedTasks.length; i++) {\r\n                        const elTask = sortedTasks[i];\r\n\r\n                        // Data from api\r\n                        const taskId = elTask.taskId;\r\n                        const taskTitle = elTask.taskTitle;\r\n                        const taskMetaString = elTask.taskMeta;\r\n                        let taskData = null;\r\n                        if (taskMetaString) {\r\n                            try {\r\n                                taskData = JSON.parse(taskMetaString);\r\n                                taskData.isFixed = elTask.taskStatus === 'DONE';\r\n                                taskData.taskId = elTask.taskId;\r\n                            } catch (error) {\r\n                                taskData = null;\r\n                            }\r\n                        }\r\n                        const currentPageURL = taskData ? taskData.pageURL : '';\r\n                        const taskNodePath = taskData ? taskData.nodePath : '';\r\n\r\n                        // Define publicity details\r\n                        let taskPublicStatusImgSrc = '';\r\n                        let taskPublicStatusHint = 'Task publicity is unknown'\r\n                        if (taskData && taskData.isPublic !== undefined) {\r\n                            if (taskData.isPublic) {\r\n                                taskPublicStatusImgSrc = this.srcVariables.iconSpotPublic;\r\n                                taskPublicStatusHint = 'The task is public';\r\n                            } else {\r\n                                taskPublicStatusImgSrc = this.srcVariables.iconSpotPrivate;\r\n                                taskPublicStatusHint = 'The task is private and visible only for registered DoBoard users';\r\n                            }\r\n                        }\r\n\r\n                        if(currentPageURL === window.location.href){\r\n                            issuesQuantityOnPage++;\r\n                        }\r\n\r\n                        if (!showOnlyCurrentPage || currentPageURL === window.location.href) {\r\n\r\n                            const taskFullDetails = getTaskFullDetails(tasksFullDetails, taskId)\r\n\r\n                            const avatarData = getAvatarData(taskFullDetails);\r\n                            const listIssuesTemplateVariables = {\r\n                                taskTitle: taskTitle || '',\r\n                                taskAuthorAvatarImgSrc: taskFullDetails.taskAuthorAvatarImgSrc,\r\n                                taskAuthorName: taskFullDetails.taskAuthorName,\r\n                                taskPublicStatusImgSrc: taskPublicStatusImgSrc,\r\n                                taskPublicStatusHint: taskPublicStatusHint,\r\n                                taskLastMessage: ksesFilter(taskFullDetails.lastMessageText),\r\n                                taskPageUrl: currentPageURL,\r\n                                iconLinkChain: this.srcVariables.iconLinkChain,\r\n                                taskFormattedPageUrl: spotFixSplitUrl(currentPageURL),\r\n                                taskLastUpdate: taskFullDetails.lastMessageTime,\r\n                                nodePath: this.sanitizeNodePath(taskNodePath),\r\n                                taskId: taskId,\r\n                                avatarCSSClass: avatarData.avatarCSSClass,\r\n                                avatarStyle: avatarData.avatarStyle,\r\n                                taskAuthorInitials: avatarData.taskAuthorInitials,\r\n                                initialsClass: avatarData.initialsClass,\r\n                                classUnread: '',\r\n                                elementBgCSSClass: elTask.taskStatus !== 'DONE' ? '' : 'doboard_task_widget-task_row-green',\r\n                                statusFixedHtml: elTask.taskStatus !== 'DONE' ? '' : this.loadTemplate('fixedHtml'),\r\n                            };\r\n\r\n                            const taskOwnerReplyIsUnread = storageProvidedTaskHasUnreadUpdates(taskFullDetails.taskId);\r\n                            if (taskOwnerReplyIsUnread) {\r\n                                listIssuesTemplateVariables.classUnread = 'unread';\r\n                            }\r\n                            document.querySelector(\".doboard_task_widget-all_issues-container\").innerHTML += this.loadTemplate('list_issues', listIssuesTemplateVariables);\r\n\r\n                            if ( this.isSpotHaveToBeHighlighted(taskData) ) {\r\n                                spotsToBeHighlighted.push(taskData);\r\n                            }\r\n                        }\r\n                    }\r\n                    this.savedIssuesQuantityOnPage = issuesQuantityOnPage;\r\n                    this.savedIssuesQuantityAll = tasks.length;\r\n                    spotFixHighlightElements(spotsToBeHighlighted, this);\r\n                    document.querySelector('.doboard_task_widget-header span').innerHTML += ksesFilter(' ' + getIssuesCounterString(this.savedIssuesQuantityOnPage, this.savedIssuesQuantityAll));\r\n                }\r\n\r\n                if (tasks.length === 0) {\r\n                    document.querySelector(\".doboard_task_widget-all_issues-container\").innerHTML = ksesFilter('<div class=\"doboard_task_widget-issues_list_empty\">The issues list is empty</div>');\r\n                }\r\n\r\n                // Bind the click event to the task elements for scrolling to the selected text and Go to concrete issue interface by click issue-item row\r\n                this.bindIssuesClick();\r\n                hideContainersSpinner(false);\r\n                break;\r\n        case 'user_menu':\r\n\r\n                setToggleStatus(this);\r\n                checkLogInOutButtonsVisible();\r\n\r\n                const user = await getUserDetails(this.params);\r\n                const gitHubAppVersion = await getReleaseVersion();\r\n                let spotfixVersion = '';\r\n                const version = localStorage.getItem('spotfix_app_version') || gitHubAppVersion;\r\n                spotfixVersion = version ? `Spotfix version ${version}.` : '';\r\n\r\n                templateVariables.spotfixVersion = spotfixVersion || '';\r\n\r\n                if(user){\r\n                    templateVariables.userName = user.name || 'Guest';\r\n                    templateVariables.email = user.email || localStorage.getItem('spotfix_email') || '';\r\n                    if(user?.avatar?.s) templateVariables.avatar = user?.avatar?.s;\r\n                }\r\n\r\n                widgetContainer.innerHTML = this.loadTemplate('user_menu', templateVariables);\r\n                document.body.appendChild(widgetContainer);\r\n                setToggleStatus(this);\r\n                checkLogInOutButtonsVisible();\r\n\r\n                break;\r\n        case 'concrete_issue':\r\n                changeSize(container);\r\n                tasksFullDetails = await getTasksFullDetails(this.params, this.allTasksData, this.currentActiveTaskId);\r\n                const taskDetails = await getTaskFullDetails(tasksFullDetails, this.currentActiveTaskId);\r\n                // Update issue title in the interface\r\n                const issueTitleElement = document.querySelector('.doboard_task_widget-issue-title');\r\n                if (issueTitleElement) {\r\n                    issueTitleElement.innerText = ksesFilter(taskDetails.issueTitle);\r\n                }\r\n\r\n                templateVariables.issueTitle = taskDetails?.issueTitle;\r\n                templateVariables.issueComments = taskDetails?.issueComments;\r\n\r\n\r\n                // Highlight the task's selected text\r\n                let nodePath = null;\r\n                    const currentTaskData = this.allTasksData.find((element) => String(element.taskId) === String(taskDetails.taskId));\r\n                    let meta = null;\r\n\r\n                    if (currentTaskData && currentTaskData.taskMeta) {\r\n                        try {\r\n                            meta = JSON.parse(currentTaskData.taskMeta);\r\n                            nodePath = meta.nodePath || null;\r\n                        } catch (e) { nodePath = null; meta = null; }\r\n                    }\r\n\r\n            templateVariables.taskPageUrl = meta.pageURL;\r\n            const taskFormattedPageUrl = meta.pageURL.replace(window.location.origin, '');\r\n            templateVariables.taskFormattedPageUrl = taskFormattedPageUrl.length < 2\r\n                ? meta.pageURL.replace(window.location.protocol + '/', '') : taskFormattedPageUrl;\r\n            templateVariables.contenerClasess = +localStorage.getItem('maximize')\r\n                ? 'doboard_task_widget-container-maximize doboard_task_widget-container' : 'doboard_task_widget-container'\r\n            widgetContainer.innerHTML = this.loadTemplate('concrete_issue', templateVariables);\r\n            document.body.appendChild(widgetContainer);\r\n\r\n                    // remove old highlights before adding new ones\r\n                    spotFixRemoveHighlights();\r\n\r\n                    if (meta && nodePath) {\r\n                        // Pass the task meta object as an array\r\n                        spotFixHighlightElements([meta], this);\r\n                        if (typeof spotFixScrollToNodePath === 'function') {\r\n                            spotFixScrollToNodePath(nodePath);\r\n                        }\r\n                    }\r\n\r\n                const issuesCommentsContainer = document.querySelector('.doboard_task_widget-concrete_issues-container');\r\n                let dayMessagesData = [];\r\n                const initIssuerID = localStorage.getItem('spotfix_user_id');\r\n                let userIsIssuer = false;\r\n                if ( taskDetails.issueComments.length > 0 ) {\r\n                    storageRemoveUnreadUpdateForTaskID(taskDetails.taskId);\r\n                    issuesCommentsContainer.innerHTML = ksesFilter('');\r\n                    for (const comment of taskDetails.issueComments) {\r\n                        userIsIssuer = Number(initIssuerID) === Number(comment.commentUserId);\r\n                        const avatarData = getAvatarData({\r\n                            taskAuthorAvatarImgSrc: comment.commentAuthorAvatarSrc,\r\n                            taskAuthorName: comment.commentAuthorName,\r\n                        });\r\n                        const commentData = {\r\n                            commentAuthorName: comment.commentAuthorName,\r\n                            commentBody: comment.commentBody,\r\n                            commentDate: comment.commentDate,\r\n                            commentTime: comment.commentTime,\r\n                            issueTitle: templateVariables.issueTitle,\r\n                            avatarCSSClass: avatarData.avatarCSSClass,\r\n                            avatarStyle: avatarData.avatarStyle,\r\n                            taskAuthorInitials: avatarData.taskAuthorInitials,\r\n                            initialsClass: avatarData.initialsClass,\r\n                            issueMessageClassOwner: userIsIssuer ? 'owner' : 'guest',\r\n                        };\r\n                        if (dayMessagesData[comment.commentDate] === undefined) {\r\n                            dayMessagesData[comment.commentDate] = [];\r\n                            dayMessagesData[comment.commentDate].push(commentData);\r\n                        } else {\r\n                            dayMessagesData[comment.commentDate].push(commentData);\r\n                        }\r\n                    }\r\n                    let daysWrapperHTML = '';\r\n\r\n                    for (const day in dayMessagesData) {\r\n                        let currentDayMessages = dayMessagesData[day];\r\n                        let dayMessagesWrapperHTML = '';\r\n                        currentDayMessages.sort((a, b) => a.commentTime.localeCompare(b.commentTime));\r\n                        for (const messageId in currentDayMessages) {\r\n                            let currentMessageTemplateVariables = currentDayMessages[messageId];\r\n                            dayMessagesWrapperHTML += this.loadTemplate('concrete_issue_messages', currentMessageTemplateVariables);\r\n                        }\r\n                        daysWrapperHTML += this.loadTemplate('concrete_issue_day_content',\r\n                            {\r\n                                dayContentMonthDay: day,\r\n                                dayContentMessages: dayMessagesWrapperHTML,\r\n                                statusFixedHtml: tasksFullDetails?.taskStatus !== 'DONE' ? '' : this.loadTemplate('fixedTaskHtml')\r\n                            },\r\n                        );\r\n                    }\r\n                    issuesCommentsContainer.innerHTML = daysWrapperHTML;\r\n                } else {\r\n                    issuesCommentsContainer.innerHTML = ksesFilter('No comments');\r\n                }\r\n\r\n                // textarea (new comment) behaviour\r\n                const textarea = document.querySelector('.doboard_task_widget-send_message_input');\r\n                if (textarea) {\r\n                    function handleTextareaChange() {\r\n                        const triggerChars = 40;\r\n\r\n                        if (this.value.length > triggerChars) {\r\n                            this.classList.add('high');\r\n                        } else {\r\n                            this.classList.remove('high');\r\n                        }\r\n                    }\r\n                    textarea.addEventListener('input', handleTextareaChange)\r\n                    textarea.addEventListener('change', handleTextareaChange)\r\n                }\r\n\r\n                // Hide spinner preloader\r\n                hideContainersSpinner();\r\n\r\n                // Scroll to the bottom comments\r\n                setTimeout(() => {\r\n                    const contentContainer = document.querySelector('.doboard_task_widget-content');\r\n                    contentContainer.scrollTo({\r\n                        top: contentContainer.scrollHeight,\r\n                        behavior: 'smooth'\r\n                    });\r\n                }, 0);\r\n\r\n                const sendButton = document.querySelector('.doboard_task_widget-send_message_button');\r\n                if (sendButton) {\r\n                    this.fileUploader.init();\r\n                    let widgetClass = this;\r\n                    sendButton.addEventListener('click', async (e) => {\r\n                        e.preventDefault();\r\n\r\n                        const sendMessageContainer = sendButton.closest('.doboard_task_widget-send_message');\r\n                        const input = sendMessageContainer.querySelector('.doboard_task_widget-send_message_input');\r\n\r\n                        const commentText = input.value.trim();\r\n                        if (!commentText) return;\r\n\r\n                        // Add other fields handling here\r\n\r\n                        input.disabled = true;\r\n                        sendButton.disabled = true;\r\n\r\n                        let newCommentResponse = null;\r\n\r\n                        try {\r\n                            newCommentResponse = await addTaskComment(this.params, this.currentActiveTaskId, commentText);\r\n                            input.value = '';\r\n                            await this.createWidgetElement('concrete_issue');\r\n                            hideContainersSpinner(false);\r\n                        } catch (err) {\r\n                            alert('Error when adding a comment: ' + err.message);\r\n                        }\r\n\r\n                        if (widgetClass.fileUploader.hasFiles() && newCommentResponse !== null && newCommentResponse.hasOwnProperty('commentId')) {\r\n                            const sessionId = localStorage.getItem('spotfix_session_id');\r\n                            const attachmentsSendResult = await widgetClass.fileUploader.sendAttachmentsForComment(widgetClass.params, sessionId, newCommentResponse.commentId);\r\n                            if (!attachmentsSendResult.success) {\r\n                                widgetClass.fileUploader.showError('Some files where no sent, see details in the console.');\r\n                                const toConsole = JSON.stringify(attachmentsSendResult);\r\n                                console.log(toConsole);\r\n                            }\r\n                        }\r\n\r\n                        input.disabled = false;\r\n                        sendButton.disabled = false;\r\n                    });\r\n                }\r\n\r\n                break;\r\n\r\n            default:\r\n                break;\r\n        }\r\n\r\n        const backToAllIssuesController = document.querySelector('.doboard_task_widget_return_to_all');\r\n        const widgetClass = this;\r\n        if ( backToAllIssuesController ) {\r\n            backToAllIssuesController.addEventListener('click', function(e, self = widgetClass) {\r\n                self.createWidgetElement('all_issues');\r\n            });\r\n        }\r\n\r\n        const paperclipController = document.querySelector('.doboard_task_widget-send_message_paperclip');\r\n        if ( paperclipController ) {\r\n            this.fileUploader.bindPaperClipAction(paperclipController);\r\n        }\r\n\r\n        document.querySelector('.doboard_task_widget-close_btn')?.addEventListener('click', (e) => {\r\n            this.hide();\r\n        }) || '';\r\n\r\n        document.querySelector('#openUserMenuButton')?.addEventListener('click', () => {\r\n            this.createWidgetElement('user_menu')\r\n        }) || '';\r\n\r\n        document.querySelector('#doboard_task_widget-user_menu-logout_button')?.addEventListener('click', () => {\r\n            logoutUserDoboard(this.params.projectToken, this.params.accountId).then(() => {this.hide()});\r\n        }) || '';\r\n\r\n        document.getElementById('addNewTaskButton')?.addEventListener('click', () => {\r\n            spotFixShowWidget();\r\n        }) || '';\r\n\r\n        document.getElementById('maximizeWidgetContainer')?.addEventListener('click', () => {\r\n            const container = document.querySelector('.doboard_task_widget-container');\r\n\r\n            if(+localStorage.getItem('maximize') && container.classList.contains('doboard_task_widget-container-maximize')){\r\n                localStorage.setItem('maximize', '0');\r\n                container.classList.remove('doboard_task_widget-container-maximize');\r\n            } else {\r\n                localStorage.setItem('maximize', '1');\r\n                container.classList.add('doboard_task_widget-container-maximize');\r\n            }\r\n        }) || '';\r\n\r\n        document.querySelector('#doboard_task_widget-user_menu-signlog_button')?.addEventListener('click', () => {\r\n            spotFixShowWidget();\r\n        }) || '';\r\n\r\n        document.querySelector('#spotfix_back_button')?.addEventListener('click', () => {\r\n            this.createWidgetElement(this.type_name)\r\n        }) || '';\r\n\r\n        return widgetContainer;\r\n    }\r\n\r\n    bindIssuesClick() {\r\n        document.querySelectorAll('.issue-item').forEach(item => {\r\n            item.addEventListener('click', async () => {\r\n                let nodePath = null;\r\n                try {\r\n                    nodePath = JSON.parse(item.getAttribute('data-node-path'));\r\n                } catch (error) {\r\n                    nodePath = null;\r\n                }\r\n                if (nodePath) {\r\n                    spotFixScrollToNodePath(nodePath);\r\n                }\r\n                this.currentActiveTaskId = item.getAttribute('data-task-id');\r\n                await this.showOneTask();\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Show one task\r\n     *\r\n     * @return {Promise<void>}\r\n     *\r\n     */\r\n    async showOneTask() {\r\n        await this.createWidgetElement('concrete_issue');\r\n        const taskHighlightData = this.getTaskHighlightData(this.currentActiveTaskId)\r\n\r\n        if (taskHighlightData) {\r\n            spotFixRemoveHighlights();\r\n            spotFixHighlightElements([taskHighlightData], this)\r\n            this.positionWidgetContainer();\r\n        }\r\n\r\n        hideContainersSpinner(false);\r\n    }\r\n\r\n    /**\r\n     * Load the template\r\n     *\r\n     * @param templateName\r\n     * @param variables\r\n     * @return {string}\r\n     * @ToDo have to refactor templates loaded method: need to be templates included into the bundle\r\n     *\r\n     */\r\n    loadTemplate(templateName, variables = {}) {\r\n        let template = SpotFixTemplatesLoader.getTemplateCode(templateName);\r\n\r\n        for (const [key, value] of Object.entries(variables)) {\r\n            const placeholder = `{{${key}}}`;\r\n            let replacement;\r\n\r\n            // 1) For attributes we MUST use escapeHtml!\r\n            // 2) Only for HTML inserts we must clean data by ksesFilter\r\n            // Check if placeholder is used in an attribute context\r\n            if (this.isPlaceholderInAttribute(template, placeholder)) {\r\n                // For attributes, use escapeHtml to prevent XSS\r\n                replacement = this.escapeHtml(String(value));\r\n            } else {\r\n                // For HTML content, use ksesFilter to sanitize HTML\r\n                replacement = ksesFilter(String(value), {template: templateName, imgFilter: true});\r\n            }\r\n\r\n            template = template.replaceAll(placeholder, replacement);\r\n        }\r\n\r\n        return ksesFilter(template, {template: templateName});\r\n    }\r\n\r\n    /**\r\n     * Check if a placeholder is used inside an HTML attribute\r\n     * @param {string} template - The template string\r\n     * @param {string} placeholder - The placeholder to check (e.g., \"{{key}}\")\r\n     * @return {boolean} - True if placeholder is in an attribute context\r\n     */\r\n    isPlaceholderInAttribute(template, placeholder) {\r\n        // Escape special regex characters in placeholder\r\n        const escapedPlaceholder = placeholder.replace(/[{}]/g, '\\\\$&');\r\n\r\n        // Pattern to match attribute=\"...\" or attribute='...' containing the placeholder\r\n        // This regex looks for: word characters (attribute name) = \" or ' followed by content including the placeholder\r\n        // Matches patterns like: src=\"{{key}}\", class=\"{{key}}\", style=\"{{key}}\", etc.\r\n        const attributePattern = new RegExp(\r\n            `[\\\\w-]+\\\\s*=\\\\s*[\"'][^\"']*${escapedPlaceholder}[^\"']*[\"']`,\r\n            'g'\r\n        );\r\n\r\n        // Check if placeholder appears in any attribute context\r\n        // If it does, we'll use escapeHtml for all occurrences (safer approach)\r\n        return attributePattern.test(template);\r\n    }\r\n\r\n    escapeHtml = (unsafe) => {\r\n        return unsafe\r\n            .replace(/&/g, \"&amp;\")\r\n            .replace(/</g, \"&lt;\")\r\n            .replace(/>/g, \"&gt;\")\r\n            .replace(/\"/g, \"&quot;\")\r\n            .replace(/'/g, \"&#039;\");\r\n    };\r\n\r\n    async getTaskCount() {\r\n        if (!localStorage.getItem('spotfix_session_id')) {\r\n            return {};\r\n        }\r\n\r\n        const projectToken = this.params.projectToken;\r\n        const sessionId = localStorage.getItem('spotfix_session_id');\r\n\r\n        const tasksCountLS = localStorage.getItem('spotfix_tasks_count');\r\n\r\n        let tasksCount;\r\n\r\n        if(tasksCountLS !== 0 && !tasksCountLS){\r\n            const tasks = await getTasksDoboard(projectToken, sessionId, this.params.accountId, this.params.projectId);\r\n            const filteredTasks = tasks.filter(task => {\r\n                return task.taskMeta;\r\n            });\r\n            tasksCount = filteredTasks.length;\r\n        } else tasksCount = tasksCountLS;\r\n\r\n        const taskCountElement = document.getElementById('doboard_task_widget-task_count');\r\n        if ( taskCountElement ) {\r\n            taskCountElement.innerText = ksesFilter(tasksCount);\r\n            taskCountElement.classList.remove('hidden');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Bind events to the widget\r\n     */\r\n    /*bindEvents() {\r\n        this.submitButton.addEventListener('click', () => this.submitTask());\r\n    }*/\r\n\r\n    /**\r\n     * Submit the task\r\n     */\r\n    async submitTask(taskDetails) {\r\n        if (!localStorage.getItem('spotfix_session_id')) {\r\n            await registerUser(taskDetails)(this.registrationShowMessage);\r\n            if ( taskDetails.userPassword ) {\r\n                await loginUser(taskDetails)(this.registrationShowMessage);\r\n            }\r\n        }\r\n\r\n        const sessionId = localStorage.getItem('spotfix_session_id');\r\n\r\n        if ( ! sessionId ) {\r\n            // @ToDo move this return in register block code\r\n            return {needToLogin: true};\r\n        }\r\n        return await handleCreateTask(sessionId, taskDetails);\r\n    }\r\n\r\n    /**\r\n     * Hide the widget\r\n     */\r\n    hide() {\r\n        spotFixRemoveHighlights();\r\n        this.createWidgetElement('wrap');\r\n\r\n    }\r\n\r\n    wrapElementWithSpotfixHighlight(element) {\r\n        const newElement = element.cloneNode();\r\n        const wrapper = document.createElement('span');\r\n        wrapper.className = 'doboard_task_widget-text_selection image-highlight';\r\n\r\n        element.insertAdjacentElement('beforebegin', wrapper);\r\n        wrapper.appendChild(newElement);\r\n\r\n        return wrapper;\r\n    }\r\n\r\n    /**\r\n     * Get task spot data for highlighting.\r\n     * @param {string|int} taskIdToSearch\r\n     * @returns {object|null}\r\n     */\r\n    getTaskHighlightData(taskIdToSearch) {\r\n        const currentTaskData = this.allTasksData.find((element) => element.taskId.toString() === taskIdToSearch.toString());\r\n        if (currentTaskData && currentTaskData.taskMeta !== undefined) {\r\n            let currentTaskSpotData = null;\r\n            try {\r\n                currentTaskSpotData = JSON.parse(currentTaskData.taskMeta);\r\n            } catch (error) {\r\n                currentTaskSpotData = null;\r\n            }\r\n            if (currentTaskSpotData !== null && typeof currentTaskSpotData === 'object') {\r\n                return currentTaskSpotData;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    bindWidgetInputsInteractive() {\r\n        // Customising placeholders\r\n        const inputs = document.querySelectorAll('.doboard_task_widget-field');\r\n        inputs.forEach(input => {\r\n            if (input.value) {\r\n                input.classList.add('has-value');\r\n            }\r\n\r\n            input.addEventListener('input', () => {\r\n                if (input.value) {\r\n                    input.classList.add('has-value');\r\n                } else {\r\n                    input.classList.remove('has-value');\r\n                }\r\n            });\r\n\r\n            input.addEventListener('blur', () => {\r\n                if (!input.value) {\r\n                    input.classList.remove('has-value');\r\n                }\r\n            });\r\n        });\r\n\r\n        // Customising accordion dropdown\r\n        const accordionController = document.querySelector('.doboard_task_widget-login span');\r\n        if ( accordionController ) {\r\n            const context = this;\r\n            accordionController.addEventListener('click', function() {\r\n                this.closest('.doboard_task_widget-login').classList.toggle('active');\r\n                // Scroll\r\n                context.positionWidgetContainer();\r\n                setTimeout(() => {\r\n                    const contentContainer = document.querySelector('.doboard_task_widget-content');\r\n                    contentContainer.scrollTo({\r\n                        top: contentContainer.scrollHeight,\r\n                        behavior: 'smooth'\r\n                    });\r\n                }, 0);\r\n            });\r\n        }\r\n\r\n        window.addEventListener('scroll', this.handleScroll.bind(this));\r\n        window.addEventListener('resize', this.handleResize.bind(this));\r\n    }\r\n\r\n    registrationShowMessage(messageText, type = 'error') {\r\n        const titleSpan = document.getElementById('doboard_task_widget-error_message-header');\r\n        const messageDiv = document.getElementById('doboard_task_widget-error_message');\r\n        const messageWrap = document.querySelector('.doboard_task_widget-message-wrapper');\r\n\r\n        if (typeof messageText === 'string' && messageDiv !== null && messageWrap !== null) {\r\n            messageDiv.innerText = ksesFilter(messageText);\r\n            messageWrap.classList.remove('hidden');\r\n            messageDiv.classList.remove('doboard_task_widget-notice_message', 'doboard_task_widget-error_message');\r\n            if (type === 'notice') {\r\n                titleSpan.innerText = ksesFilter('');\r\n                messageWrap.classList.add('doboard_task_widget-notice_message');\r\n                messageDiv.style.color = '#2a5db0';\r\n            } else {\r\n                titleSpan.innerText = ksesFilter('Registration error');\r\n                messageWrap.classList.add('doboard_task_widget-error_message');\r\n                messageDiv.style.color = 'red';\r\n            }\r\n        }\r\n    }\r\n\r\n    positionWidgetContainer() {\r\n        const selection = document.querySelector('.doboard_task_widget-text_selection');\r\n        const widget = document.querySelector('.doboard_task_widget')\r\n        const widgetCreateIssue = document.querySelector('.doboard_task_widget-content.doboard_task_widget-create_issue')\r\n        const widgetConcreteIssue = document.querySelector('.doboard_task_widget-concrete_issues-container')\r\n        if ( ! ( ( widgetCreateIssue || widgetConcreteIssue ) && selection ) ) {\r\n            // Skip if the widget is closed or highlight not exist\r\n            return;\r\n        }\r\n\r\n        const scrollY = window.scrollY;\r\n        const viewportHeight = window.innerHeight;\r\n\r\n        const selectionAbsoluteTop = selection.getBoundingClientRect().top + scrollY;\r\n\r\n        const widgetHeight = widget.offsetHeight;\r\n\r\n        let top;\r\n\r\n        // Check selection position\r\n        if (selectionAbsoluteTop - scrollY < 0) {\r\n            // 1) The selection is above the viewport - stuck the widget on the top\r\n            top = 10;\r\n        } else if (selectionAbsoluteTop - scrollY > viewportHeight) {\r\n            // 2) The selection is below the viewport - stuck the widget on the bottom\r\n            top = viewportHeight - widgetHeight - 10;\r\n        } else {\r\n            // 3) The selection is on viewport - the widget aligned against the selection\r\n            top = selectionAbsoluteTop - scrollY\r\n            if ( selectionAbsoluteTop - scrollY > viewportHeight - widgetHeight ) {\r\n                // 3.1) The selection is on viewport but is below than widget height - stuck the widget on the bottom\r\n                top = viewportHeight - widgetHeight - 10;\r\n            }\r\n        }\r\n\r\n        widget.style.top = `${top}px`;\r\n        widget.style.bottom = 'auto';\r\n    }\r\n\r\n    handleScroll() {\r\n        clearTimeout(this.scrollTimeout);\r\n        this.scrollTimeout = setTimeout(() => {\r\n            this.positionWidgetContainer();\r\n        }, 10);\r\n    }\r\n\r\n    handleResize() {\r\n        clearTimeout(this.resizeTimeout);\r\n        this.resizeTimeout = setTimeout(() => {\r\n            this.positionWidgetContainer();\r\n        }, 100);\r\n    }\r\n\r\n    /**\r\n     * Check nodePath, selectedData against page source and return is the provided nodePath is correct and can be highlighted\r\n     * @param taskData\r\n     * @return {boolean}\r\n     */\r\n    isSpotHaveToBeHighlighted(taskData) {\r\n        return true;\r\n    }\r\n\r\n    sanitizeNodePath(nodePath) {\r\n    let str = Array.isArray(nodePath) ? JSON.stringify(nodePath) : String(nodePath);\r\n    // Allow only digits, commas, spaces, and square brackets\r\n    if (/^[\\[\\]0-9,\\s]*$/.test(str)) {\r\n        return str;\r\n    }\r\n    return '';\r\n}\r\n}\r\n\nvar spotFixShowDelayTimeout = null;\r\nconst SPOTFIX_DEBUG = false;\r\nconst SPOTFIX_SHOW_DELAY = 1000;\r\n\r\nif( document.readyState !== 'loading' ) {\r\n    document.addEventListener('spotFixLoaded', spotFixInit);\r\n} else {\r\n    document.addEventListener('DOMContentLoaded', spotFixInit);\r\n}\r\n\r\nfunction spotFixInit() {\r\n    new SpotFixSourcesLoader();\r\n    new CleanTalkWidgetDoboard({}, 'wrap');\r\n    loadBotDetector()\r\n}\r\n\r\nfunction loadBotDetector() {\r\nif (document.querySelector('script[src=\"https://moderate.cleantalk.org/ct-bot-detector-wrapper.js\"]') ||\r\n    document.getElementById('ct-bot-detector-script')) {\r\n        return;\r\n    }\r\n\r\n    const script = document.createElement('script');\r\n        script.src = 'https://moderate.cleantalk.org/ct-bot-detector-wrapper.js';\r\n        script.async = true;\r\n        script.id = 'ct-bot-detector-script';\r\n    document.head.appendChild(script);\r\n}\r\n\r\ndocument.addEventListener('selectionchange', function(e) {\r\n    // Do not run widget for non-document events (i.e. inputs focused)\r\n\r\n    if (e.target !== document) {\r\n        return;\r\n    }\r\n\r\n    const isWrapReviewWidgetExists = !!(document.getElementsByClassName('wrap_review')[0]);\r\n    const sel = document.getSelection();\r\n\r\n    if ((!sel || sel.toString() === \"\") && isWrapReviewWidgetExists) {\r\n        new CleanTalkWidgetDoboard({}, 'wrap')\r\n        return;\r\n    }\r\n\r\n    if (spotFixShowDelayTimeout) {\r\n        clearTimeout(spotFixShowDelayTimeout);\r\n    }\r\n\r\n    spotFixShowDelayTimeout = setTimeout(() => {\r\n        const selection = window.getSelection();\r\n        if (\r\n            selection.type === 'Range'\r\n        ) {\r\n            // Check if selection is inside the widget\r\n            let anchorNode = selection.anchorNode;\r\n            let focusNode = selection.focusNode;\r\n            if (spotFixIsInsideWidget(anchorNode) || spotFixIsInsideWidget(focusNode)) {\r\n                return;\r\n            }\r\n            const selectedData = spotFixGetSelectedData(selection);\r\n\r\n             if ( selectedData ) {\r\n                // spotFixOpenWidget(selectedData, 'create_issue');\r\n                spotFixOpenWidget(selectedData, 'wrap_review');\r\n            }\r\n        }\r\n    }, SPOTFIX_SHOW_DELAY);\r\n});\r\n\r\n\r\n/**\r\n * Shows the spot fix widget.\r\n */\r\nfunction spotFixShowWidget() {\r\n    new CleanTalkWidgetDoboard(null, 'create_issue');\r\n}\r\n\r\n/**\r\n * Check if a node is inside the task widget.\r\n * @param {*} node\r\n * @returns {boolean}\r\n */\r\nfunction spotFixIsInsideWidget(node) {\r\n    if (!node) return false;\r\n    let el = node.nodeType === Node.ELEMENT_NODE ? node : node.parentElement;\r\n    while (el) {\r\n        if (el.classList && el.classList.contains('doboard_task_widget')) {\r\n            return true;\r\n        }\r\n        el = el.parentElement;\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Open the widget to create a task.\r\n * @param {*} selectedData\r\n * @param {*} type\r\n */\r\nfunction spotFixOpenWidget(selectedData, type) {\r\n    if (selectedData) {\r\n        new CleanTalkWidgetDoboard(selectedData, type);\r\n    }\r\n}\r\n\r\n/**\r\n * Write message into the console.\r\n *\r\n * @param {string} message\r\n */\r\nfunction spotFixDebugLog(message) {\r\n    if ( SPOTFIX_DEBUG ) {\r\n        console.log(message);\r\n    }\r\n}\r\n\r\nfunction hideContainersSpinner() {\r\n    const spinners = document.getElementsByClassName('doboard_task_widget-spinner_wrapper_for_containers');\r\n    if (spinners.length > 0) {\r\n        for (let i = 0; i < spinners.length ; i++) {\r\n            spinners[i].style.display = 'none';\r\n        }\r\n    }\r\n    const containerClassesToShow = ['doboard_task_widget-all_issues-container', 'doboard_task_widget-concrete_issues-container'];\r\n    for (let i = 0; i < containerClassesToShow.length ; i++) {\r\n        const containers = document.getElementsByClassName(containerClassesToShow[i]);\r\n        if (containers.length > 0) {\r\n            for (let i = 0; i < containers.length ; i++) {\r\n                containers[i].style.display = 'block';\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction getTaskFullDetails(tasksDetails, taskId) {\r\n    const comments = tasksDetails.comments.filter(comment => {\r\n        return comment?.taskId?.toString() === taskId?.toString()\r\n    });\r\n    const users = tasksDetails.users;\r\n    // Last comment\r\n    let lastComment = comments.length > 0 ? comments[0] : null;\r\n    // Author of the last comment\r\n    let author = null;\r\n    if (lastComment && users && users.length > 0) {\r\n        author = users.find(u => String(u.user_id) === String(lastComment.userId));\r\n    }\r\n    // Format date\r\n    let date = '', time = '';\r\n    if (lastComment) {\r\n        const dt = formatDate(lastComment.commentDate);\r\n        date = dt.date;\r\n        time = dt.time;\r\n    }\r\n    // Get the avatar and the name through separate functions\r\n    let avatarSrc = getAvatarSrc(author);\r\n    let authorName = getAuthorName(author);\r\n\r\n    return {\r\n        taskId: taskId,\r\n        taskAuthorAvatarImgSrc: avatarSrc,\r\n        taskAuthorName: authorName,\r\n        lastMessageText: lastComment ? lastComment.commentBody : 'No messages yet',\r\n        lastMessageTime: time,\r\n        issueTitle: comments.length > 0 ? comments[0].issueTitle : 'No Title',\r\n        issueComments: comments\r\n            .sort((a, b) => {\r\n                return new Date(a.commentDate) - new Date(b.commentDate);\r\n            })\r\n            .map(comment => {\r\n                const {date, time} = formatDate(comment.commentDate);\r\n                let author = null;\r\n                if (users && users.length > 0) {\r\n                    author = users.find(u => String(u.user_id) === String(comment.userId));\r\n                }\r\n                return {\r\n                    commentAuthorAvatarSrc: getAvatarSrc(author),\r\n                    commentAuthorName: getAuthorName(author),\r\n                    commentBody: comment.commentBody,\r\n                    commentDate: date,\r\n                    commentTime: time,\r\n                    commentUserId: comment.userId || 'Unknown User',\r\n                };\r\n            })\r\n    };\r\n}\r\n\r\nfunction getAvatarData(authorDetails) {\r\n    let avatarStyle;\r\n    let avatarCSSClass;\r\n    let taskAuthorInitials =\r\n        authorDetails.taskAuthorName && authorDetails.taskAuthorName != 'Anonymous'\r\n            ? authorDetails.taskAuthorName.trim().charAt(0).toUpperCase()\r\n            : null;\r\n    let initialsClass = 'doboard_task_widget-avatar-initials';\r\n    if (authorDetails.taskAuthorAvatarImgSrc === null && taskAuthorInitials !== null) {\r\n        avatarStyle = 'display: flex;background-color: #f8de7e;justify-content: center;align-items: center;';\r\n        avatarCSSClass = 'doboard_task_widget-avatar_container';\r\n    }\r\n    if (authorDetails.taskAuthorAvatarImgSrc === null && taskAuthorInitials === null) {\r\n        avatarStyle = `background-image:url(\\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAE9GlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4wLWMwMDAgNzkuMTcxYzI3ZmFiLCAyMDIyLzA4LzE2LTIyOjM1OjQxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjQuMCAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjQtMDQtMTBUMTk6MDg6MDkrMDU6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDI0LTA0LTEwVDE5OjIxOjA4KzA1OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDI0LTA0LTEwVDE5OjIxOjA4KzA1OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoxNWRjOWI0Yy04ZWVmLTRkNTEtYmE0MS1kOTkzZTZmNjNmMTIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MTVkYzliNGMt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');`;\r\n        avatarCSSClass = 'doboard_task_widget-avatar_container';\r\n        initialsClass += ' doboard_task_widget-hidden_element';\r\n    }\r\n    if (authorDetails.taskAuthorAvatarImgSrc !== null) {\r\n        avatarStyle = `background-image:url(\\'${authorDetails.taskAuthorAvatarImgSrc}\\');`;\r\n        avatarCSSClass = 'doboard_task_widget-avatar_container';\r\n        initialsClass = 'doboard_task_widget-hidden_element';\r\n    }\r\n    return {\r\n        avatarStyle: avatarStyle,\r\n        avatarCSSClass: avatarCSSClass,\r\n        taskAuthorInitials: taskAuthorInitials,\r\n        initialsClass: initialsClass\r\n    }\r\n}\r\n\r\n/**\r\n * Return first found updated task ID or false if no tasks were updated\r\n * @param allTasksData\r\n * @returns {string[]|false}\r\n */\r\nfunction isAnyTaskUpdated(allTasksData) {\r\n    let result = false;\r\n\r\n    const updatedtasksIDS = [];\r\n\r\n    for (let i = 0; i < allTasksData.length; i++) {\r\n        const currentStateOfTask = allTasksData[i];\r\n        const issuerId = localStorage.getItem('spotfix_user_id');\r\n        if (\r\n            currentStateOfTask.taskId &&\r\n            currentStateOfTask.taskLastUpdate &&\r\n            currentStateOfTask.taskCreatorTaskUser.toString() === issuerId.toString()\r\n        ) {\r\n            result = storageCheckTaskUpdate(currentStateOfTask.taskId, currentStateOfTask.taskLastUpdate);\r\n            if (result) {\r\n                updatedtasksIDS.push(currentStateOfTask.taskId.toString());\r\n            }\r\n        }\r\n    }\r\n\r\n    return updatedtasksIDS.length === 0 ? false : updatedtasksIDS;\r\n}\r\n\r\n/**\r\n * Check if any of the tasks has updates from site owner (not from the current user and not anonymous)\r\n * @returns {Promise<boolean>}\r\n */\r\nasync function checkIfTasksHasSiteOwnerUpdates(allTasksData, params) {\r\n    const updatedTaskIDs = isAnyTaskUpdated(allTasksData);\r\n    let result = false;\r\n    if (!updatedTaskIDs) {\r\n        return false;\r\n    }\r\n    for (let i = 0; i < updatedTaskIDs.length; i++) {\r\n        const updatedTaskId = updatedTaskIDs[i];\r\n        if (typeof updatedTaskId === 'string') {\r\n            const updatedTaskData =  await getTasksFullDetails(params, [updatedTaskId]);\r\n            if (updatedTaskData.comments) {\r\n                const lastMessage = updatedTaskData.comments[0];\r\n                if (\r\n                    lastMessage.commentUserId !== undefined &&\r\n                    lastMessage.commentUserId !== localStorage.getItem('spotfix_user_id') &&\r\n                    lastMessage.commentAuthorName !== 'Anonymous'\r\n                ) {\r\n                    storageAddUnreadUpdateForTaskID(updatedTaskId);\r\n                    result = true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return result;\r\n}\r\n\r\n/**\r\n * Check if the selection is correct - do not allow to select all page, or several different nesting nodes, or something else\r\n * @param selection\r\n * @return {boolean}\r\n */\r\nfunction isSelectionCorrect(selection) {\r\n    return true;\r\n}\r\n\r\n/**\r\n * Sanitize HTML\r\n * @param {*} html\r\n * @param {*} options\r\n * @returns\r\n */\r\nfunction ksesFilter(html, options = false) {\r\n    let allowedTags = {\r\n        a: true,\r\n        b: true,\r\n        i: true,\r\n        strong: true,\r\n        em: true,\r\n        ul: true,\r\n        ol: true,\r\n        li: true,\r\n        p: true,\r\n        s: true,\r\n        br: true,\r\n        span: true,\r\n        blockquote: true,\r\n        pre: true,\r\n        div: true,\r\n        img: true,\r\n        input: true,\r\n        label: true,\r\n        textarea: true,\r\n        button: true,\r\n        blockquote: true,\r\n        pre: true,\r\n        details: true,\r\n        summary: true,\r\n    };\r\n    let allowedAttrs = {\r\n        a: ['href', 'title', 'target', 'rel', 'style', 'class'],\r\n        span: ['style', 'class', 'id'],\r\n        p: ['style', 'class'],\r\n        div: ['style', 'class', 'id', 'data-node-path', 'data-task-id'],\r\n        img: ['src', 'alt', 'title', 'class', 'style', 'width', 'height'],\r\n        input: ['type', 'class', 'style', 'id', 'multiple', 'accept', 'value'],\r\n        label: ['for', 'class', 'style'],\r\n        textarea: ['class', 'id', 'style', 'rows', 'cols', 'readonly', 'required', 'name'],\r\n        button: ['type', 'class', 'style', 'id'],\r\n        details: ['class', 'style', 'open'],\r\n        summary: ['class', 'style'],\r\n    };\r\n\r\n    if (options && options.template === 'list_issues') {\r\n        allowedTags = { ...allowedTags, br: false };\r\n    }\r\n\r\n    const parser = new DOMParser();\r\n    const doc = parser.parseFromString(html, 'text/html');\r\n    function clean(node) {\r\n        if (node.nodeType === Node.ELEMENT_NODE) {\r\n            const tag = node.tagName.toLowerCase();\r\n\r\n            if (options) {\r\n                if (allowedTags[tag]) {\r\n                    // Special handling for images in 'concrete_issue_day_content' template (wrap img in link always)\r\n                    if (tag === 'img' && options.template === 'concrete_issue_day_content' && options.imgFilter) {\r\n                        const src = node.getAttribute('src') || '';\r\n                        const alt = node.getAttribute('alt') || '[image]';\r\n                        const link = doc.createElement('a');\r\n                        link.href = src;\r\n                        link.target = '_blank';\r\n                        link.className = 'doboard_task_widget-img-link';\r\n                        const img = doc.createElement('img');\r\n                        img.src = src;\r\n                        img.alt = alt;\r\n                        img.className = 'doboard_task_widget-comment_body-img-strict';\r\n                        link.appendChild(img);\r\n                        node.parentNode.insertBefore(link, node);\r\n                        node.remove();\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                if (!allowedTags[tag]) {\r\n                    // Special handling for images in 'list_issues' template\r\n                    if (tag === 'img' && options.template === 'list_issues' && options.imgFilter) {\r\n                        const src = node.getAttribute('src') || '';\r\n                        const alt = node.getAttribute('alt') || '[image]';\r\n                        const link = doc.createElement('a');\r\n                        link.href = src;\r\n                        link.target = '_blank';\r\n                        link.textContent = alt;\r\n                        node.parentNode.insertBefore(link, node);\r\n                    }\r\n                    node.remove();\r\n                    return;\r\n                }\r\n            }\r\n\r\n            // Remove disallowed attributes\r\n            [...node.attributes].forEach(attr => {\r\n                const attrName = attr.name.toLowerCase();\r\n                if (!allowedAttrs[tag]?.includes(attrName) ||\r\n                    attrName.startsWith('on') || // Remove event handlers\r\n                    attr.value.toLowerCase().includes('javascript:')) {\r\n                    node.removeAttribute(attr.name);\r\n                }\r\n            });\r\n        }\r\n        // Recursively clean children\r\n        [...node.childNodes].forEach(clean);\r\n    }\r\n    [...doc.body.childNodes].forEach(clean);\r\n    return doc.body.innerHTML;\r\n}\r\n\n/**\r\n * SELECTION will be grouped into three types:\r\n * 1 - Simple text within a single tag\r\n * 2 - Image tags\r\n * 3 - Any tag containing nested content\r\n * Each type will be processed differently.\r\n */\r\nconst SPOTFIX_SELECTION_TYPE_TEXT = 'text';\r\nconst SPOTFIX_SELECTION_TYPE_IMG = 'image';\r\nconst SPOTFIX_SELECTION_TYPE_ELEMENT = 'element';\r\n\r\n/**\r\n * Determines the type of selection\r\n * @param {Selection} selection - The DOM Selection object\r\n * @returns {string|null} Selection type\r\n */\r\nfunction spotFixGetSelectionType(selection) {\r\n    const range = selection.getRangeAt(0);\r\n    const commonAncestor = range.commonAncestorContainer;\r\n\r\n    // Case 1: Image selection\r\n    if (spotFixGetSelectedImage(selection)) {\r\n        return SPOTFIX_SELECTION_TYPE_IMG;\r\n    }\r\n\r\n    // Case 2: Element with nested content\r\n    if (commonAncestor.nodeType === Node.ELEMENT_NODE &&\r\n        commonAncestor.childNodes.length > 1 &&\r\n        range.toString().trim() === '' &&\r\n        range.startContainer === range.endContainer &&\r\n        range.startContainer.nodeType === Node.ELEMENT_NODE) {\r\n        return SPOTFIX_SELECTION_TYPE_ELEMENT;\r\n    }\r\n\r\n    // Case 3: Simple text\r\n    const hasTextContent = range.toString().trim().length > 0;\r\n    const isTextNode = commonAncestor.nodeType === Node.TEXT_NODE;\r\n    const isCollapsed = range.collapsed;\r\n\r\n    if (hasTextContent && (isTextNode || !isCollapsed)) {\r\n        return SPOTFIX_SELECTION_TYPE_TEXT;\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\n/**\r\n * Extracts selection data from DOM Selection object\r\n * @param {Selection} selection - The DOM Selection object\r\n * @returns {Object|null} Selection data with text, positions, URL and node path OR null (nothing)\r\n */\r\nfunction spotFixGetSelectedData(selection) {\r\n    // Prechecks:\r\n    // Selection not provided\r\n    if (!selection) {spotFixDebugLog('`spotFixGetSelectedData` skip by `Selection not provided`'); return null;  }\r\n    // Range not provided\r\n    if (selection.rangeCount === 0) { spotFixDebugLog('`spotFixGetSelectedData` skip by `Range not provided`'); return null; }\r\n    // Several ranges provided\r\n    if (selection.rangeCount > 1) { spotFixDebugLog('`spotFixGetSelectedData` skip by `Several ranges provided`'); return null; }\r\n\r\n    const range = selection.getRangeAt(0);\r\n    // Selection must be within a single DOM element.\r\n    if (range.startContainer !== range.endContainer) { spotFixDebugLog('`spotFixGetSelectedData` skip by `Selection within several tags nodes`'); return null; }\r\n\r\n    // FIRST - check selection type\r\n    const selectionType = spotFixGetSelectionType(selection);\r\n\r\n    // Selection type not determined\r\n    if (!selectionType) { spotFixDebugLog('`spotFixGetSelectedData` skip by `Selection type not determined`'); return null; }\r\n\r\n    // SECOND - generate selectedData for each selectionType\r\n    let selectedText = '';\r\n    let startSelectPosition = 0;\r\n    let endSelectPosition = 0;\r\n    let nodePath = '';\r\n    let imageUrl = '';\r\n\r\n    const commonNode = range.commonAncestorContainer;\r\n\r\n    switch (selectionType) {\r\n        case SPOTFIX_SELECTION_TYPE_TEXT:\r\n            if (range.toString().trim().length === 0) {\r\n                spotFixDebugLog('`spotFixGetSelectedData` skip by `Selection text is empty`');\r\n                return null;\r\n            }\r\n            const commonNodeElement = commonNode.nodeType === Node.ELEMENT_NODE ? commonNode : commonNode.parentElement;\r\n            selectedText = range.toString();\r\n            startSelectPosition = range.startOffset;\r\n            endSelectPosition = range.endOffset;\r\n            if ( startSelectPosition === 0 && selectedText.length > endSelectPosition ) {\r\n                endSelectPosition = selectedText.length;\r\n            }\r\n            nodePath = spotFixCalculateNodePath(commonNodeElement);\r\n            break;\r\n\r\n        case SPOTFIX_SELECTION_TYPE_IMG:\r\n            const imgElement = range.startContainer;\r\n            const selectedImage = spotFixGetSelectedImage(selection);\r\n            selectedText = `Image (${selectedImage.alt ? selectedImage.alt : 'no description'})`;\r\n            nodePath = spotFixCalculateNodePath(selectedImage);\r\n            // For images, positions represent the image element position in parent\r\n            startSelectPosition = Array.from(imgElement.parentNode.children).indexOf(imgElement);\r\n            endSelectPosition = startSelectPosition + 1;\r\n            break;\r\n\r\n        case SPOTFIX_SELECTION_TYPE_ELEMENT:\r\n            const element = commonNode.nodeType === Node.ELEMENT_NODE ? commonNode : commonNode.parentElement;\r\n            if (element.childNodes.length <= 1) {\r\n                spotFixDebugLog('`spotFixGetSelectedData` skip by `Selection have not inner data`');\r\n                return null;\r\n            }\r\n            selectedText = element.textContent || '';\r\n            nodePath = spotFixCalculateNodePath(element);\r\n            // For elements, positions represent the element's position in parent\r\n            startSelectPosition = Array.from(element.parentNode.children).indexOf(element);\r\n            endSelectPosition = startSelectPosition + 1;\r\n            break;\r\n    }\r\n\r\n    // Get page URL\r\n    const pageURL = window.location.href;\r\n\r\n    return {\r\n        startSelectPosition,\r\n        endSelectPosition,\r\n        selectedText: selectedText.trim(),\r\n        pageURL,\r\n        nodePath,\r\n        selectionType,\r\n        imageUrl: selectionType === SPOTFIX_SELECTION_TYPE_IMG ? imageUrl : ''\r\n    };\r\n}\r\n\r\n/**\r\n * Highlight elements.\r\n * @param {[object]} spotsToBeHighlighted\r\n * @param widgetInstance\r\n */\r\nfunction spotFixHighlightElements(spotsToBeHighlighted, widgetInstance) {\r\n\r\n    if (spotsToBeHighlighted.length === 0) return;\r\n\r\n    const elementsMap = new Map();\r\n\r\n    // Grouping elements with validation\r\n    spotsToBeHighlighted.forEach(spot => {\r\n        // nodePath validating: is array\r\n        if (!spot?.nodePath || !Array.isArray(spot?.nodePath)) {\r\n            spotFixDebugLog('Invalid spot: missing or invalid nodePath: ' + spot);\r\n            return;\r\n        }\r\n\r\n        // nodePath validating: is valid indexes list\r\n        if (!this.spotFixIsValidNodePath(spot.nodePath)) {\r\n            spotFixDebugLog('Invalid nodePath format: ' + spot.nodePath);\r\n            return;\r\n        }\r\n\r\n        const element = spotFixRetrieveNodeFromPath(spot.nodePath);\r\n        if (!element) {\r\n            spotFixDebugLog('Element not found for path: ' + spot.nodePath);\r\n            return;\r\n        }\r\n\r\n        if ( ! spot.selectionType ) {\r\n            // @ToDo need to apply backward capability here\r\n            // just `spot.selectionType = 'text';` is not able, this opens ability to unauthorized modify website content\r\n            spotFixDebugLog('Selection type is not provided.');\r\n            return;\r\n        }\r\n\r\n        // selectionType parameter validating\r\n        if (\r\n            spot.selectionType &&\r\n            ![\r\n                SPOTFIX_SELECTION_TYPE_TEXT,\r\n                SPOTFIX_SELECTION_TYPE_IMG,\r\n                SPOTFIX_SELECTION_TYPE_ELEMENT\r\n            ].includes(spot.selectionType)\r\n        ) {\r\n            spotFixDebugLog('Invalid selection type: ' + spot.selectionType);\r\n            return;\r\n        }\r\n\r\n        if (!elementsMap.has(element)) {\r\n            elementsMap.set(element, []);\r\n        }\r\n        elementsMap.get(element).push(spot);\r\n    });\r\n\r\n    elementsMap.forEach((spots, element) => {\r\n        const selectionType = spots[0].selectionType;\r\n\r\n        // MAIN LOGIC: highlight for the different types\r\n        switch (selectionType) {\r\n            case 'image':\r\n                this.spotFixHighlightImageElement(element);\r\n                break;\r\n\r\n            case 'element':\r\n                this.spotFixHighlightNestedElement(element);\r\n                break;\r\n\r\n            case 'text':\r\n                this.spotFixHighlightTextInElement(element, spots, widgetInstance);\r\n                break;\r\n\r\n            default:\r\n                spotFixDebugLog('Unknown selection type: ' + selectionType);\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Highlight image element by adding class\r\n * @param {Element} element\r\n */\r\nfunction spotFixHighlightImageElement(element) {\r\n    if (element.tagName !== 'IMG') {\r\n        spotFixDebugLog('Expected IMG element for image highlight, got: ' + element.tagName);\r\n        return;\r\n    }\r\n    element.classList.add('doboard_task_widget-image_selection');\r\n}\r\n\r\n/**\r\n * Highlight nested element by adding class\r\n * @param {Element} element\r\n */\r\nfunction spotFixHighlightNestedElement(element) {\r\n    element.classList.add('doboard_task_widget-element_selection');\r\n}\r\n\r\n/**\r\n * Highlight text in element with span wrapping\r\n * @param {Element} element\r\n * @param {Array} spots\r\n * @param widgetInstance\r\n */\r\nfunction spotFixHighlightTextInElement(element, spots,widgetInstance) {\r\n    let tooltipTitleText = '';\r\n    if (spots[0].isFixed) {\r\n        tooltipTitleText = `This issue already fixed.`;\r\n    } else {\r\n        tooltipTitleText = `We are already working on this issue.`;\r\n    }\r\n\r\n    const tooltip = `<div class=\"doboard_task_widget-text_selection_tooltip_element\">\r\n                            <span class=\"doboard_task_widget-text_selection_tooltip_icon\"></span>\r\n                            <span>\r\n                                <div>${tooltipTitleText}</div>\r\n                                <div>You can see history <span class=\"doboard_task_widget-see-task doboard_task_widget-see-task__task-id-${spots[0].taskId}\">Here</span></div>\r\n                            </span>\r\n                        </div>`;\r\n\r\n    const spotfixHighlightOpen = `<span class=\"doboard_task_widget-text_selection\"><span class=\"doboard_task_widget-text_selection_tooltip\">${tooltip}</span>`;\r\n    const spotfixHighlightClose = `</span>`;\r\n\r\n    let text = element.textContent;\r\n    const spotSelectedText = spots[0].selectedText;\r\n\r\n    // meta.selectedText can not be empty string\r\n    if ( ! spotSelectedText ) {\r\n        spotFixDebugLog('Provided metadata is invalid.');\r\n        return;\r\n    }\r\n\r\n    const markers = [];\r\n\r\n    // Mark positions for inserting\r\n    spots.forEach(spot => {\r\n        // Validating positions\r\n        const startPos = parseInt(spot.startSelectPosition) || 0;\r\n        const endPos = parseInt(spot.endSelectPosition) || 0;\r\n\r\n        if (startPos < 0 || endPos > text.length || startPos > endPos) {\r\n            spotFixDebugLog('Invalid text positions: ' + spot);\r\n            return;\r\n        }\r\n\r\n        markers.push({ position: startPos, type: 'start' });\r\n        markers.push({ position: endPos, type: 'end' });\r\n    });\r\n\r\n    if (markers.length === 0) return;\r\n\r\n    // Sort markers backward\r\n    markers.sort((a, b) => b.position - a.position);\r\n\r\n    // Check here that element (from meta.nodePath) contains same inner text as in meta.selectedText\r\n    // Is the `text` in the element equal to the selected text `spotSelectedText`\r\n    if ( text.slice(markers[1].position, markers[0].position) !== spotSelectedText ) {\r\n        spotFixDebugLog('It is not allow to highlight element by provided metadata.');\r\n        return;\r\n    }\r\n\r\n    let result = text;\r\n    markers.forEach(marker => {\r\n        const insertText = marker.type === 'start'\r\n            ? spotfixHighlightOpen\r\n            : spotfixHighlightClose;\r\n\r\n        result = result.slice(0, marker.position) + insertText + result.slice(marker.position);\r\n    });\r\n\r\n    // Safety HTML insert\r\n    try {\r\n        element.innerHTML = ksesFilter(result);\r\n        document.querySelectorAll('.doboard_task_widget-see-task').forEach(link => {\r\n            link.addEventListener('click', (e) => {\r\n\r\n                e.preventDefault();\r\n                const classList = link.className.split(' ');\r\n                const idClass = classList.find(cls => cls.includes('__task-id-'));\r\n                let taskId = null;\r\n                if (idClass) {\r\n                    taskId = idClass.split('__task-id-')[1];\r\n                }\r\n                if (taskId) {\r\n                    widgetInstance.currentActiveTaskId = taskId;\r\n                    widgetInstance.showOneTask();\r\n                }\r\n            });\r\n        });\r\n    } catch (error) {\r\n        spotFixDebugLog('Error updating element content: ' + error);\r\n    }\r\n}\r\n\r\n/**\r\n * Scroll to an element by tag, class, and text content\r\n * @param {array} path - The path to the element\r\n * @return {boolean} - True if the element was found and scrolled to, false otherwise\r\n */\r\nfunction spotFixScrollToNodePath(path) {\r\n    const node = spotFixRetrieveNodeFromPath(path);\r\n    if (node && node.scrollIntoView) {\r\n        node.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction spotFixRemoveHighlights() {\r\n    const textSelectionclassName = 'doboard_task_widget-text_selection';\r\n    const spans = document.querySelectorAll('.' + textSelectionclassName);\r\n    const affectedParents = new Set(); // Track unique parents\r\n\r\n    spans.forEach(span => {\r\n        const parent = span.parentNode;\r\n        affectedParents.add(parent); // Mark parent as affected\r\n        const tooltip = span.querySelector('.doboard_task_widget-text_selection_tooltip');\r\n        if (tooltip) tooltip.remove();\r\n\r\n        // Move all child nodes out of the span and into the parent\r\n        while (span.firstChild) {\r\n            parent.insertBefore(span.firstChild, span);\r\n        }\r\n        parent.removeChild(span);\r\n    });\r\n\r\n    // Normalize all affected parents to merge adjacent text nodes\r\n    affectedParents.forEach(parent => parent.normalize());\r\n\r\n    const elementSelectionClassName = 'doboard_task_widget-element_selection';\r\n    const elements = document.querySelectorAll(`.${elementSelectionClassName}`);\r\n    elements.forEach(element => {\r\n        element.classList.remove(elementSelectionClassName);\r\n    });\r\n    const imageSelectionClassName = 'doboard_task_widget-image_selection';\r\n    const images = document.querySelectorAll(`.${imageSelectionClassName}`);\r\n    images.forEach(element => {\r\n        element.classList.remove(imageSelectionClassName);\r\n    });\r\n}\r\n\r\n/**\r\n * Validate nodePath as array of indices\r\n * @param {Array} nodePath\r\n * @returns {boolean}\r\n */\r\nfunction spotFixIsValidNodePath(nodePath) {\r\n    if (!Array.isArray(nodePath)) return false;\r\n    if (nodePath.length === 0) return false;\r\n\r\n    return nodePath.every(index => {\r\n        return Number.isInteger(index) && index >= 0 && index < 1000;\r\n    });\r\n}\r\n\r\n/**\r\n * Try to find selected image in selection.\r\n * @param selection\r\n * @returns {Node|*|null}\r\n */\r\nfunction spotFixGetSelectedImage(selection) {\r\n\r\n    if (!selection || selection.rangeCount === 0 || selection.isCollapsed) {\r\n        return null;\r\n    }\r\n\r\n    const range = selection.getRangeAt(0);\r\n\r\n    // Is current end container IMG\r\n    if (range.startContainer === range.endContainer &&\r\n        range.startContainer.nodeType === Node.ELEMENT_NODE &&\r\n        range.startContainer.tagName === 'IMG') {\r\n        return range.startContainer;\r\n    }\r\n\r\n    // Get img in the range\r\n    const walker = document.createTreeWalker(\r\n        range.commonAncestorContainer,\r\n        NodeFilter.SHOW_ELEMENT,\r\n        {\r\n            acceptNode: function(node) {\r\n                return node.tagName === 'IMG' &&\r\n                spotFixIsElementInRange(node, range) ?\r\n                    NodeFilter.FILTER_ACCEPT :\r\n                    NodeFilter.FILTER_REJECT;\r\n            }\r\n        }\r\n    );\r\n\r\n    let imgNode = walker.nextNode();\r\n    if (imgNode) {\r\n        return imgNode;\r\n    }\r\n\r\n    // start/end containers\r\n    const startElement = spotFixGetElementFromNode(range.startContainer);\r\n    const endElement = spotFixGetElementFromNode(range.endContainer);\r\n\r\n    // If selection starts on image\r\n    if (startElement && startElement.tagName === 'IMG' &&\r\n        spotFixIsElementPartiallySelected(startElement, range)) {\r\n        return startElement;\r\n    }\r\n\r\n    if (endElement && endElement.tagName === 'IMG' &&\r\n        spotFixIsElementPartiallySelected(endElement, range)) {\r\n        return endElement;\r\n    }\r\n\r\n    // 4. Get closest IMG\r\n    const nearbyElements = spotFixFindNearbyElements(range);\r\n    for (const element of nearbyElements) {\r\n        if (element.tagName === 'IMG') {\r\n            return element;\r\n        }\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nfunction spotFixIsElementInRange(element, range) {\r\n    const elementRange = document.createRange();\r\n    elementRange.selectNode(element);\r\n    return range.compareBoundaryPoints(Range.START_TO_START, elementRange) <= 0 &&\r\n        range.compareBoundaryPoints(Range.END_TO_END, elementRange) >= 0;\r\n}\r\n\r\nfunction spotFixIsElementPartiallySelected(element, range) {\r\n    const elementRect = element.getBoundingClientRect();\r\n    const rangeRect = range.getBoundingClientRect();\r\n\r\n    //  bounding rectangles is crossed\r\n    return !(elementRect.right < rangeRect.left ||\r\n        elementRect.left > rangeRect.right ||\r\n        elementRect.bottom < rangeRect.top ||\r\n        elementRect.top > rangeRect.bottom);\r\n}\r\n\r\nfunction spotFixGetElementFromNode(node) {\r\n    return node.nodeType === Node.ELEMENT_NODE ? node : node.parentElement;\r\n}\r\n\r\n/**\r\n * Find nearby elements in the range.\r\n * @param range\r\n * @returns {*[]}\r\n */\r\nfunction spotFixFindNearbyElements(range) {\r\n    const elements = [];\r\n    const container = range.commonAncestorContainer;\r\n\r\n    // search elements\r\n    const previousElement = container.previousElementSibling;\r\n    const nextElement = container.nextElementSibling;\r\n\r\n    if (previousElement) {\r\n        elements.push(previousElement);\r\n    }\r\n    if (nextElement) {\r\n        elements.push(nextElement);\r\n    }\r\n\r\n    // Also check child container\r\n    if (container.nodeType === Node.ELEMENT_NODE) {\r\n        const children = container.children;\r\n        for (let i = 0; i < children.length; i++) {\r\n            if (spotFixIsElementPartiallySelected(children[i], range)) {\r\n                elements.push(children[i]);\r\n            }\r\n        }\r\n    }\r\n\r\n    return elements;\r\n}\r\n\r\n/**\r\n * Calculate the path of a DOM node\r\n *\r\n * @param {Node} node\r\n * @return {int[]}\r\n */\r\nfunction spotFixCalculateNodePath(node) {\r\n    let path = [];\r\n    while (node) {\r\n        let index = 0;\r\n        let sibling = node.previousSibling;\r\n        while (sibling) {\r\n            if (sibling.nodeType === 1) {\r\n                index++;\r\n            }\r\n            sibling = sibling.previousSibling;\r\n        }\r\n        path.unshift(index);\r\n        node = node.parentNode;\r\n    }\r\n\r\n    // Hard fix - need to remove first element to work correctly\r\n    path.shift();\r\n\r\n    return path;\r\n}\r\n\r\n/**\r\n * Retrieve a DOM node from a path\r\n *\r\n * @param {int[]} path\r\n * @return {*|null}\r\n */\r\nfunction spotFixRetrieveNodeFromPath(path) {\r\n    // @ToDo check if the path is correct\r\n    if ( ! path ) {\r\n        return null;\r\n    }\r\n\r\n    let node = document;\r\n    for (let i = 0; i < path.length; i++) {\r\n        node = node.children[path[i]];\r\n        if ( ! node ) {\r\n            return null;\r\n        }\r\n    }\r\n    return node;\r\n}\r\n\n/**\r\n * Return bool if widget is closed in local storage\r\n * @returns {boolean}\r\n */\r\nfunction storageGetWidgetIsClosed() {\r\n    return localStorage.getItem('spotfix_widget_is_closed') === '1';\r\n}\r\n\r\n/**\r\n * Return bool if widget closed state is defined in local storage\r\n * @returns {boolean}\r\n */\r\nfunction storageWidgetCloseIsSet() {\r\n    return localStorage.getItem('spotfix_widget_is_closed') !== null;\r\n}\r\n\r\n/**\r\n * Save widget closed state\r\n * @param visible\r\n */\r\nfunction storageSetWidgetIsClosed(visible) {\r\n    localStorage.setItem('spotfix_widget_is_closed', visible ? '1' : '0');\r\n}\r\n\r\n/**\r\n * Return bool if user is defined in local storage\r\n * @returns {boolean}\r\n */\r\nfunction storageGetUserIsDefined() {\r\n    return localStorage.getItem('spotfix_user_id') !== null;\r\n}\r\n\r\n/**\r\n * Save data for updates check\r\n * @param tasks\r\n */\r\nfunction storageSaveTasksUpdateData(tasks) {\r\n    if (!tasks || !Array.isArray(tasks)) {\r\n        return;\r\n    }\r\n\r\n    let storedTasks = {};\r\n    try {\r\n        storedTasks = JSON.parse(localStorage.getItem('spotfix_task_updates') || '{}');\r\n    } catch (error) {\r\n        storedTasks = {};\r\n    }\r\n\r\n    tasks.forEach(task => {\r\n        if (task.taskId && task.taskLastUpdate) {\r\n            storedTasks[task.taskId] = {\r\n                taskId: task.taskId,\r\n                taskLastUpdate: task.taskLastUpdate\r\n            };\r\n        }\r\n    });\r\n\r\n    localStorage.setItem('spotfix_task_updates', JSON.stringify(storedTasks));\r\n}\r\n\r\nfunction storageSaveTasksCount(tasks) {\r\n    if (!tasks || !Array.isArray(tasks)) {\r\n        return;\r\n    }\r\n\r\n    const count = tasks.filter(task => {\r\n        return task.taskMeta;\r\n    })?.length;\r\n\r\n    localStorage.setItem('spotfix_tasks_count', `${count}`);\r\n}\r\n\r\n/**\r\n * Check if a specific task has been updated since last check\r\n * @param taskId\r\n * @param currentLastUpdate\r\n * @returns {boolean|null}\r\n */\r\nfunction storageCheckTaskUpdate(taskId, currentLastUpdate) {\r\n    if (!taskId || !currentLastUpdate) {\r\n        return null;\r\n    }\r\n\r\n    let storedTasks = {};\r\n    try {\r\n        storedTasks = JSON.parse(localStorage.getItem('spotfix_task_updates') || '{}');\r\n    } catch (error) {\r\n        storedTasks = {};\r\n    }\r\n    const storedTask = storedTasks[taskId];\r\n\r\n    if (!storedTask) {\r\n        return false;\r\n    }\r\n\r\n    const storedUpdate = new Date(storedTask.taskLastUpdate);\r\n    const currentUpdate = new Date(currentLastUpdate);\r\n    return currentUpdate > storedUpdate;\r\n}\r\n\r\n/**\r\n * Add unread update for a specific task\r\n * @param taskId\r\n */\r\nfunction storageAddUnreadUpdateForTaskID(taskId) {\r\n    if (!taskId) {\r\n        return;\r\n    }\r\n\r\n    let storedUnread = [];\r\n    try {\r\n        storedUnread = JSON.parse(localStorage.getItem('spotfix_unread_updates') || '[]');\r\n    } catch (error) {\r\n        storedUnread = [];\r\n    }\r\n\r\n    if (!storedUnread.includes(taskId)) {\r\n        storedUnread.push(taskId);\r\n    }\r\n\r\n    localStorage.setItem('spotfix_unread_updates', JSON.stringify(storedUnread));\r\n}\r\n\r\n/**\r\n * Remove unread update for a specific task\r\n * @param taskId\r\n */\r\nfunction storageRemoveUnreadUpdateForTaskID(taskId) {\r\n    if (!taskId) {\r\n        return;\r\n    }\r\n\r\n    let storedUnread = [];\r\n    try {\r\n        storedUnread = JSON.parse(localStorage.getItem('spotfix_unread_updates') || '[]');\r\n    } catch (error) {\r\n        storedUnread = [];\r\n    }\r\n    storedUnread = storedUnread.filter(id => id !== taskId);\r\n    localStorage.setItem('spotfix_unread_updates', JSON.stringify(storedUnread));\r\n}\r\n\r\n/**\r\n * Check if there are any unread updates\r\n * @returns {boolean}\r\n */\r\nfunction storageTasksHasUnreadUpdates() {\r\n    let storedUnread = [];\r\n    try {\r\n        storedUnread = JSON.parse(localStorage.getItem('spotfix_unread_updates') || '[]');\r\n    } catch (error) {\r\n        storedUnread = [];\r\n    }\r\n\r\n    return storedUnread.length > 0;\r\n}\r\n\r\n/**\r\n *  Check if a specific task has unread updates\r\n * @param taskId\r\n * @returns {boolean}\r\n */\r\nfunction storageProvidedTaskHasUnreadUpdates(taskId) {\r\n    if (!taskId) {\r\n        return false;\r\n    }\r\n\r\n    let storedUnread = [];\r\n    try {\r\n        storedUnread = JSON.parse(localStorage.getItem('spotfix_unread_updates') || '[]');\r\n    } catch (error) {\r\n        storedUnread = [];\r\n    }\r\n\r\n    return storedUnread.includes(taskId.toString());\r\n}\r\n\r\nfunction storageSaveSpotfixVersion (version) {\r\n    localStorage.setItem('spotfix_app_version', `${version}`);\r\n}\r\n\r\nfunction clearLocalstorageOnLogout () {\r\n    localStorage.removeItem('spotfix_email');\r\n    localStorage.removeItem('spotfix_session_id');\r\n    localStorage.removeItem('spotfix_user_id');\r\n    localStorage.setItem('spotfix_widget_is_closed', '1');\r\n}\r\n\nlet spotFixCSS = `.doboard_task_widget-send_message_paperclip .doboard_task_widget-paperclip-tooltip::after{content:\"\";position:absolute;left:8%;top:100%;transform:translateX(-50%);pointer-events:none;background:0 0;border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid #545b61;display:block}.doboard_task_widget-send_message_paperclip{position:relative}.doboard_task_widget-send_message_paperclip .doboard_task_widget-paperclip-tooltip{display:none;position:absolute;left:0;bottom:0;transform:translateX(-3%) translateY(-43px);background:#545b61;color:#FFF;border:none;border-radius:3px;padding:10px 16px;font-size:13px;line-height:1.4;z-index:100;min-width:220px;max-width:320px;text-align:left;pointer-events:none;text-transform:none}.doboard_task_widget-send_message_paperclip:hover .doboard_task_widget-paperclip-tooltip{display:block}.doboard_task_widget *{font-family:Inter,sans-serif;font-weight:400;font-size:14px;line-height:130%;color:#40484F}.doboard_task_widget-header *{color:#252A2F;margin:0}.doboard_task_widget-header-icons{display:flex}.doboard_task_widget a{text-decoration:underline;color:#2F68B7}.doboard_task_widget a:hover{text-decoration:none}.doboard_task_widget{position:fixed;right:50px;bottom:20px;z-index:9999;vertical-align:middle;transition:top .1s;transform:translateZ(0);-webkit-transform:translateZ(0);will-change:transform}.doboard_task_widget_cursor-pointer{cursor:pointer}.doboard_task_widget-container-maximize{width:80vw!important;max-width:1120px!important;max-height:calc(100vh - 40px);display:flex;flex-direction:column;-moz-flex-direction:column}.doboard_task_widget-container{width:430px;max-height:calc(100vh - 40px);display:flex;flex-direction:column;-moz-flex-direction:column}@media (max-height:800px){.doboard_task_widget-container,.doboard_task_widget-container-maximize{max-height:calc(60vh - 40px)}}.doboard_task_widget-header{display:flex;height:41px;min-height:41px;padding:0 16px;background-color:#EBF0F4;border-radius:8px 8px 0 0;border:1px solid #BBC7D1;border-bottom:none;justify-content:space-between;align-items:center;color:#FFF}.doboard_task_widget-user_menu-header{display:flex;padding:16px;border:1px solid #BBC7D1;border-bottom-color:#EBF0F4;border-radius:8px 8px 0 0;flex-direction:column;align-items:center;color:#252A2F;background-color:#F3F6F9}.doboard_task_widget-user_menu-header-top{display:flex;height:fit-content;align-items:center;width:100%;justify-content:space-between}.doboard_task_widget-user_menu-header-avatar{max-width:60px;max-height:60px;width:60px;height:60px;border-radius:50%;margin-bottom:4px}.doboard_task_widget-user_menu-item{display:flex;align-items:center;border-bottom:1px #EBF0F4 solid;padding:0 16px;height:65px}.doboard_task_widget-content{flex:1;overflow-y:auto;background:#FFF;border-radius:0 0 8px 8px;border:1px #BBC7D1;border-style:none solid solid;box-shadow:0 4px 15px 8px #CACACA40;scrollbar-width:none;max-height:60vh}.doboard_task_widget-element-container{margin-bottom:30px}.doboard_task_widget-wrap{box-shadow:none;position:fixed;right:-50px;padding:0;cursor:pointer;width:69px;height:52px;border-top-left-radius:4px;border-bottom-left-radius:4px;background-color:rgba(255,255,255,.9);border:1px solid #EBF0F4;display:flex;align-items:center;justify-content:center}.doboard_task_widget-input-container.hidden,.doboard_task_widget-login.hidden,.doboard_task_widget-wrap.hidden,.wrap_review::after{display:none}.doboard_task_widget-wrap img{width:32px;height:32px;transform:scaleX(-1)}.wrap_review{width:164px;min-width:164px;height:54px}.wrap_review img{width:28px;height:28px;transform:scaleX(-1)}.wrap_review:hover{background-color:#fff}@media (max-width:480px){.doboard_task_widget-wrap{right:-20px}}#review_content_button_text{color:#D5991A;margin-left:6px;font-weight:600;font-size:14px;text-transform:none!important}#doboard_task_widget-task_count{position:absolute;top:-12px;right:4px;width:22px;height:22px;opacity:1;background:#ef8b43;border-radius:50%;color:#FFF;text-align:center;line-height:22px}#doboard_task_widget-task_count.hidden{width:0;height:0;opacity:0}.doboard_task_widget-input-container{position:relative;margin-bottom:24px}.doboard_task_widget-input-container .doboard_task_widget-field{padding:0 8px;border-radius:4px;border:1px solid #BBC7D1;outline:0!important;appearance:none;width:100%;height:40px;background:#FFF;color:#000;max-width:-webkit-fill-available;max-width:-moz-available}.doboard_task_widget-field:focus{border-color:#2F68B7}.doboard_task_widget-input-container textarea.doboard_task_widget-field{height:94px;padding-top:11px;padding-bottom:11px}.doboard_task_widget-field+label{color:#252A2F;background:#fff;position:absolute;top:20px;left:8px;transform:translateY(-50%);transition:all .2s ease-in-out}.doboard_task_widget-field.has-value+label,.doboard_task_widget-field:focus+label{font-size:10px;top:0;left:12px;padding:0 4px;z-index:5}.doboard_task_widget-field:focus+label{color:#2F68B7}.doboard_task_widget-login{background:#F9FBFD;border:1px solid #BBC7D1;border-radius:4px;padding:11px 8px 8px;margin-bottom:24px}.doboard_task_widget-login .doboard_task_widget-accordion{height:0;overflow:hidden;opacity:0;transition:all .2s ease-in-out}.doboard_task_widget-login.active .doboard_task_widget-accordion{height:auto;overflow:visible;opacity:1}.doboard_task_widget-login .doboard_task_widget-input-container:last-child{margin-bottom:0}.doboard_task_widget-login span{display:block;position:relative;padding-right:24px;cursor:pointer}.doboard_task_widget-login.active span{margin-bottom:24px}.doboard_task_widget-login span::after{position:absolute;top:0;right:4px;content:\"\";display:block;width:10px;height:10px;transform:rotate(45deg);border:2px solid #40484F;border-radius:1px;border-top:none;border-left:none;transition:all .2s ease-in-out}.doboard_task_widget-login.active span::after{transform:rotate(-135deg);top:7px}.doboard_task_widget-login .doboard_task_widget-field+label,.doboard_task_widget-login .doboard_task_widget-input-container .doboard_task_widget-field{background:#F9FBFD}.doboard_task_widget-submit_button{height:48px;width:100%;max-width:400px;margin-bottom:10px;color:#FFF;background:#22A475;border:none;border-radius:6px;font-family:Inter,sans-serif;font-weight:700;font-size:16px;line-height:150%;cursor:pointer;transition:all .2s ease-in-out}.doboard_task_widget-submit_button:hover{background:#1C7857;color:#FFF}.doboard_task_widget-submit_button:disabled{background:rgba(117,148,138,.92);color:#FFF;cursor:wait}.doboard_task_widget-issue-title{max-width:200px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.doboard_task_widget-hidden_element{opacity:0}.doboard_task_widget-message-wrapper{border-radius:4px;padding:8px;margin-bottom:14px;display:grid;justify-items:center}.doboard_task_widget-error_message-wrapper.hidden,.doboard_task_widget-message-wrapper.hidden{display:none}.doboard_task_widget-error_message{background:#fdd;border:1px solid #cf6868}.doboard_task_widget-notice_message{background:#dde9ff;border:1px solid #68a6cf}#doboard_task_widget-error_message-header{font-weight:600}#doboard_task_widget-error_message{text-align:center}.doboard_task_widget-task_row{display:flex;max-height:55px;cursor:pointer;align-items:center;justify-content:space-between;padding:1px 15px}.doboard_task_widget-task_row:last-child{margin-bottom:0}.doboard_task_widget-task-text_bold{font-weight:700}.doboard_task_widget-element_selection,.doboard_task_widget-image_selection,.doboard_task_widget-text_selection,.doboard_task_widget-text_selection.image-highlight>img{background:rgba(208,213,127,.68)}.doboard_task_widget-issues_list_empty{text-align:center;margin:20px 0}.doboard_task_widget-avatar_container{display:flex;height:44px;width:44px;border-radius:50%;background-repeat:no-repeat;background-position:center;background-size:100%}.doboard_task_widget-comment_data_owner .doboard_task_widget-avatar_container{opacity:0}.doboard_task_widget-avatar_placeholder{min-height:44px;min-width:44px;border-radius:50%;font-size:24px;line-height:1.2083333333;padding:0;background:#1C7857;display:inline-grid;align-content:center;justify-content:center}.doboard_task_widget-avatar-initials{color:#FFF;width:inherit;text-align:center}.doboard_task_widget-avatar{width:44px;height:44px;border-radius:50%;object-fit:cover}.doboard_task_widget-description_container{height:55px;width:calc(100% - 44px - 8px);border-bottom:1px solid #EBF0F4;display:block;margin-left:8px}.doboard_task_widget-task_row:last-child .doboard_task_widget-description_container{border-bottom:none}.doboard_task_widget-all_issues{padding-bottom:0}.doboard_task_widget-all_issues-container,.doboard_task_widget-concrete_issues-container{overflow:auto;max-height:85vh;display:none}.doboard_task_widget-task_last_message,.doboard_task_widget-task_page_url a,.doboard_task_widget-task_title span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.doboard_task_widget-all_issues-container{scrollbar-width:none;margin-top:10px}.doboard_task_widget-content.doboard_task_widget-concrete_issue{padding:0}.doboard_task_widget-concrete_issues-container{padding:10px 16px 5px}.doboard_task_widget-all_issues-container::-webkit-scrollbar,.doboard_task_widget-all_issues::-webkit-scrollbar,.doboard_task_widget-concrete_issues-container::-webkit-scrollbar,.doboard_task_widget-content::-webkit-scrollbar{width:0}.doboard_task_widget-task_title{font-weight:700;display:flex;justify-content:space-between;align-items:center}.doboard_task_widget-task_title span{font-weight:700;display:inline-block}.doboard_task_widget-task_title-details{display:flex;max-width:calc(100% - 40px);align-items:center}.doboard_task_widget-task_title-unread_block{opacity:0;height:8px;width:8px;background:#f08c43;border-radius:50%;display:inline-block;font-size:8px;font-weight:600;position:relative}.doboard_task_widget-task_title-unread_block.unread{opacity:1}.doboard_task_widget-task_last_message{max-width:85%;height:36px}.doboard_task_widget-task_page_url{max-width:70%;height:36px;display:flex;align-items:center}.doboard_task_widget-task_page_url a{color:#40484F;text-decoration:none;margin-left:8px;max-width:100%}.doboard_task_widget-bottom{display:flex;justify-content:space-between}.doboard_task_widget-bottom-is-fixed{border-radius:10px;background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkiIGhlaWdodD0iMTkiIHZpZXdCb3g9IjAgMCAxOSAxOSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGQ9Ik03LjA4MTE5IDAuMjIzNDM0QzguOTkxNjkgLTAuMjA4MTY3IDEwLjk5MTMgLTAuMDExMjE5NCAxMi43ODA0IDAuNzg1OTM0QzEzLjE1ODQgMC45NTQ2MjQgMTMuMzI4NiAxLjM5ODAzIDEzLjE2MDMgMS43NzYxN0MxMi45OTE3IDIuMTU0MTkgMTIuNTQ4MiAyLjMyNDI0IDEyLjE3MDEgMi4xNTYwNUMxMC42NzY0IDEuNDkwNTIgOS4wMDcyNiAxLjMyNiA3LjQxMjI1IDEuNjg2MzJDNS44MTcxNyAyLjA0NjcxIDQuMzgwOTcgMi45MTI5NiAzLjMxODUgNC4xNTYwNUMyLjI1NjIzIDUuMzk5MDEgMS42MjQ0MSA2Ljk1MjI5IDEuNTE2NzQgOC41ODM3OUMxLjQwOTI0IDEwLjIxNTQgMS44MzE4NCAxMS44MzkgMi43MjE4MiAxMy4yMTA3QzMuNjExNzkgMTQuNTgyMiA0LjkyMTY0IDE1LjYyOTQgNi40NTUyMSAxNi4xOTYxQzcuOTg5MDIgMTYuNzYyNiA5LjY2NTUzIDE2LjgxODkgMTEuMjMzNSAxNi4zNTUzQzEyLjgwMTYgMTUuODkxNiAxNC4xNzgzIDE0LjkzMzUgMTUuMTU3NCAxMy42MjM4QzE2LjEzNjQgMTIuMzE0MiAxNi42NjYxIDEwLjcyMjcgMTYuNjY3MSA5LjA4NzY5TDE4LjE2NzEgOS4wODg2N0MxOC4xNjU4IDExLjA0NzEgMTcuNTMxMiAxMi45NTM2IDE2LjM1ODUgMTQuNTIyM0MxNS4xODU5IDE2LjA5MDcgMTMuNTM3MyAxNy4yMzg0IDExLjY1OTMgMTcuNzkzN0M5Ljc4MTEgMTguMzQ5MSA3Ljc3MjkzIDE4LjI4MiA1LjkzNTY4IDE3LjYwMzNDNC4wOTg1IDE2LjkyNDYgMi41MjkxMiAxNS42NzAxIDEuNDYzMDMgMTQuMDI3MUMwLjM5NzAzNSAxMi4zODQxIC0wLjEwOTEwOSAxMC40Mzk1IDAuMDE5NjY4MyA4LjQ4NTE1QzAuMTQ4NjA3IDYuNTMwOCAwLjkwNjMyMyA0LjY3MDMzIDIuMTc4ODUgMy4xODE0NEMzLjQ1MTM2IDEuNjkyNjggNS4xNzA4OCAwLjY1NTE2MiA3LjA4MTE5IDAuMjIzNDM0WiIgZmlsbD0iIzIyQTQ3NSIvPg0KPHBhdGggZD0iTTE2Ljg4NTkgMS44OTA0M0MxNy4xNzg2IDEuNTk3NTMgMTcuNjUzNCAxLjU5Nzg0IDE3Ljk0NjQgMS44OTA0M0MxOC4yMzkzIDIuMTgzMTYgMTguMjQwMSAyLjY1Nzk2IDE3Ljk0NzQgMi45NTA5N0w5LjYxMzQyIDExLjI5MjhDOS40NzI4MiAxMS40MzMzIDkuMjgxOTYgMTEuNTEyNCA5LjA4MzE1IDExLjUxMjVDOC44ODQzMiAxMS41MTI1IDguNjkzNDggMTEuNDMzMyA4LjU1Mjg3IDExLjI5MjhMNi4wNTI4NyA4Ljc5Mjc3QzUuNzYwMTQgOC40OTk5IDUuNzYwMTEgOC4wMjUwOCA2LjA1Mjg3IDcuNzMyMjJDNi4zNDU3MiA3LjQzOTM3IDYuODIwNTEgNy40Mzk0NiA3LjExMzQyIDcuNzMyMjJMOS4wODIxNyA5LjcwMDk3TDE2Ljg4NTkgMS44OTA0M1oiIGZpbGw9IiMyMkE0NzUiLz4NCjxwYXRoIGQ9Ik0xNy40MTcxIDcuNTcxMDlDMTcuODMxIDcuNTcxNDQgMTguMTY3IDcuOTA3MTYgMTguMTY3MSA4LjMyMTA5VjkuMDg4NjdMMTcuNDE3MSA5LjA4NzY5SDE2LjY2NzFWOC4zMjEwOUMxNi42NjcyIDcuOTA2OTQgMTcuMDAzIDcuNTcxMDkgMTcuNDE3MSA3LjU3MTA5WiIgZmlsbD0iIzIyQTQ3NSIvPg0KPC9zdmc+) 8px center no-repeat #EBFAF4;padding:4px 7px 4px 30px}.doboard_task_widget-bottom-is-fixed-task-block{text-align:center}.doboard_task_widget-bottom-is-fixed-task{background:#F3F6F9;color:#1C7857;display:inline-block;border-radius:10px;padding:5px 8px;margin:0 auto}.doboard_task_widget-task_row-green{background:#EBF0F4}.doboard_task_widget_return_to_all{display:flex;gap:8px;flex-direction:row;-moz-flex-direction:row;align-content:center;flex-wrap:wrap}.doboard_task_widget-task_title-last_update_time{font-family:Inter,serif;font-weight:400;font-style:normal;font-size:11px;leading-trim:NONE;line-height:100%}.doboard_task_widget-task_title_public_status_img{opacity:50%;margin-left:5px;scale:90%}.doboard_task_widget-description-textarea{resize:none}.doboard_task_widget-switch_row{display:flex;align-items:center;gap:12px;margin:16px 0;justify-content:space-between}.doboard_task_widget-switch-label{font-weight:600;font-size:16px;height:24px;align-content:center}.doboard_task_widget-switch{position:relative;display:inline-block;width:44px;height:24px;flex-shrink:0}.doboard_task_widget-switch input{opacity:0;width:0;height:0}.doboard_task_widget-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;border-radius:24px;transition:.2s}.doboard_task_widget-slider:before{position:absolute;content:\"\";height:20px;width:20px;left:2px;bottom:2px;background-color:#fff;border-radius:50%;transition:.2s}.doboard_task_widget-switch input:checked+.doboard_task_widget-slider{background-color:#65D4AC}.doboard_task_widget-switch input:checked+.doboard_task_widget-slider:before{transform:translateX(20px)}.doboard_task_widget-switch-img{width:24px;height:24px;flex-shrink:0}.doboard_task_widget-switch-center{display:flex;gap:2px;flex-direction:column;-moz-flex-direction:column;flex:1 1 auto;min-width:0}.doboard_task_widget-switch-desc{display:block;font-size:12px;color:#707A83;margin:0;line-height:1.2;max-width:180px;word-break:break-word}.doboard_task_widget-concrete_issue-day_content{display:flex;flex-direction:column;-moz-flex-direction:column}.doboard_task_widget-concrete_issue_day_content-month_day{text-align:center;font-weight:400;font-size:12px;line-height:100%;padding:8px;opacity:.75}.doboard_task_widget-concrete_issue_day_content-messages_wrapper{display:flex;flex-direction:column;-moz-flex-direction:column}.doboard_task_widget-comment_data_wrapper{display:flex;flex-direction:row;-moz-flex-direction:row;margin-bottom:15px;align-items:flex-end}.doboard_task_widget-comment_text_container{position:relative;width:calc(100% - 44px - 5px);height:auto;margin-left:5px;background:#F3F6F9;border-radius:16px}.doboard_task_widget-comment_text_container:after{content:\"\";position:absolute;bottom:0;left:-5px;width:13px;height:19px;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTMiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAxMyAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTAuMTEyNTggMTkuMDMzNEM1LjI5NDg2IDE5LjgyMDEgMTAuNjEwNSAxNy45NzQxIDEyLjI3MTUgMTYuMTcxM0MxMi4yNzE1IDE2LjE3MTMgMTAuOTYyMyAtMi43ODEyNCA1LjA5NTU0IDAuMzQ5MDc5QzUuMDc0NCAxLjYxNDU0IDUuMDk1NTQgNS45OTQ5IDUuMDk1NTQgNi43NDA2OUM1LjA5NTU0IDE3LjA2NjIgLTAuODg0MDEyIDE4LjQ0MDEgMC4xMTI1OCAxOS4wMzM0WiIgZmlsbD0iI0YzRjZGOSIvPgo8L3N2Zz4K)}.doboard_task_widget-comment_data_owner .doboard_task_widget-comment_text_container{background:#EBFAF4}.doboard_task_widget-comment_data_owner .doboard_task_widget-comment_text_container:after{left:auto;right:-5px;height:13px;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTMiIGhlaWdodD0iMTMiIHZpZXdCb3g9IjAgMCAxMyAxMyIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyLjc3NzEgMTIuMzA2NkM3LjMzMTM1IDEzLjA5MzcgMS43NDU0NCAxMS4yNDY5IDAgOS40NDMxOUw3LjM5MTYgMEM3LjM5MTYgMTAuMzMwMyAxMy44MjQ0IDExLjcxMzEgMTIuNzc3MSAxMi4zMDY2WiIgZmlsbD0iI0VCRkFGNCIvPgo8L3N2Zz4K)}.doboard_task_widget-comment_body,.doboard_task_widget-comment_time{position:relative;z-index:1}.doboard_task_widget-comment_body{padding:6px 8px;min-height:30px}.doboard_task_widget-comment_body strong{font-variation-settings:\"wght\" 700}.doboard_task_widget-comment_body blockquote{margin:0;border-left:3px solid #22a475}.doboard_task_widget-comment_body blockquote p{margin:0 10px}.doboard_task_widget-comment_body details .mce-accordion-body{padding-left:20px}.doboard_task_widget-comment_body details .mce-accordion-summary{background:url(\"data:image/svg+xml;charset=utf-8,%3Csvg transform='rotate(180 0 0)' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' style='enable-background:new 0 0 20 20' xml:space='preserve'%3E%3Cpath d='M10 13.3c-.2 0-.4-.1-.6-.2l-5-5c-.3-.3-.3-.9 0-1.2.3-.3.9-.3 1.2 0l4.4 4.4 4.4-4.4c.3-.3.9-.3 1.2 0 .3.3.3.9 0 1.2l-5 5c-.2.2-.4.2-.6.2z'/%3E%3C/svg%3E\") 0 no-repeat;padding-left:20px}.doboard_task_widget-comment_body .mce-accordion[open] .mce-accordion-summary{background:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' style='enable-background:new 0 0 20 20' xml:space='preserve'%3E%3Cpath d='M10 13.3c-.2 0-.4-.1-.6-.2l-5-5c-.3-.3-.3-.9 0-1.2.3-.3.9-.3 1.2 0l4.4 4.4 4.4-4.4c.3-.3.9-.3 1.2 0 .3.3.3.9 0 1.2l-5 5c-.2.2-.4.2-.6.2z'/%3E%3C/svg%3E\") 0 no-repeat}.doboard_task_widget-comment_body details .mce-accordion-summary::marker{content:\"\"}.doboard_task_widget-comment_body pre{border:1px solid #d6dde3;border-left-width:8px;border-radius:4px;padding:13px 16px 14px 12px;white-space:pre-wrap}.doboard_task_widget-comment_time{font-weight:400;font-size:11px;opacity:.8;position:absolute;bottom:6px;right:6px}.doboard_task_widget-comment_body-img-strict{max-width:-webkit-fill-available;height:100px;margin-right:5px}.doboard_task_widget-send_message{padding:14px 10px;border-top:1px solid #BBC7D1;position:sticky;background:#fff;bottom:0;z-index:4}.doboard_task_widget-send_message_elements_wrapper{display:flex;flex-direction:row;-moz-flex-direction:row;align-content:center;flex-wrap:nowrap;justify-content:space-between;align-items:end}.doboard_task_widget-send_message_elements_wrapper button{height:37px;background:0 0;margin:0}.doboard_task_widget-send_message_elements_wrapper img{margin:0}.doboard_task_widget-send_message_input_wrapper{position:relative;display:inline-grid;align-items:center;justify-items:center;flex-grow:1;padding:0 6px}.doboard_task_widget-send_message_input_wrapper textarea{position:relative;width:100%;height:37px;border:none;outline:0;box-shadow:none;border-radius:24px;background:#F3F6F9;resize:none;margin-bottom:0!important;transition:height .2s ease-in-out;padding:8px;box-sizing:border-box}.doboard_task_widget-send_message_input_wrapper textarea.high{height:170px}.doboard_task_widget-send_message_input_wrapper textarea:focus{background:#F3F6F9;border-color:#007bff;outline:0}.doboard_task_widget-send_message_button,.doboard_task_widget-send_message_paperclip{display:inline-grid;border:none;background:0 0;cursor:pointer;padding:0;align-items:center;margin:0}.doboard_task_widget-send_message_button:hover,.doboard_task_widget-send_message_paperclip:hover rect{fill:#45a049}.doboard_task_widget-send_message_button:active,.doboard_task_widget-send_message_paperclip:active{transform:scale(.98)}.doboard_task_widget-spinner_wrapper_for_containers{display:flex;justify-content:center;align-items:center;min-height:60px;width:100%}.doboard_task_widget-spinner_for_containers{width:40px;height:40px;border-radius:50%;background:conic-gradient(transparent,#1C7857);mask:radial-gradient(farthest-side,transparent calc(100% - 4px),#fff 0);animation:spin 1s linear infinite}.doboard_task_widget-create_issue{padding:10px}.doboard_task_widget__file-upload__wrapper{display:none;border:1px solid #BBC7D1;margin-top:14px;padding:0 10px 10px;border-radius:4px}.doboard_task_widget__file-upload__list-header{text-align:left;font-size:.9em;margin:5px 0;color:#444c529e}.doboard_task_widget__file-upload__file-input-button{display:none}.doboard_task_widget__file-upload__file-list{border:1px solid #ddd;border-radius:5px;padding:6px;max-height:200px;overflow-y:auto;background:#f3f6f9}.doboard_task_widget__file-upload__file-item{display:flex;justify-content:space-between;align-items:center;padding:4px;border-bottom:1px solid #bbc7d16b}.doboard_task_widget__file-upload__file-item:last-child{border-bottom:none}.doboard_task_widget__file-upload__file_info{display:inline-flex;align-items:center}.doboard_task_widget__file-upload__file-name{font-weight:700;font-size:.9em}.doboard_task_widget__file-upload__file-item-content{width:100%}.doboard_task_widget__file-upload__file_size{color:#666;font-size:.8em;margin-left:6px}.doboard_task_widget__file-upload__remove-btn{background:#22a475;color:#fff;border:none;border-radius:3px;cursor:pointer}.doboard_task_widget__file-upload__error{display:block;margin:7px 0 0;padding:7px;border-radius:4px;background:#fdd;border:1px solid #cf6868}.doboard_task_widget-show_button{position:fixed;background:#1C7857;color:#FFF;padding:8px 12px;border-radius:4px;font-size:14px;z-index:10000;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,.3);transform:translate(-50%,-100%);margin-top:-8px;white-space:nowrap;border:none;font-family:inherit}@keyframes spin{to{transform:rotate(1turn)}}@media (max-width:480px){.doboard_task_widget{position:fixed;right:0;top:auto;bottom:0;margin:0 20px 20px;box-sizing:border-box;transform:translateZ(0);-moz-transform:translateZ(0);will-change:transform;max-height:90vh}.doboard_task_widget-header{padding:8px}.doboard_task_widget-issue-title{max-width:70px}.doboard_task_widget-container,.doboard_task_widget-container-maximize{width:100%;max-width:290px;margin:0 auto;max-height:90vh}.doboard_task_widget-content{height:auto;max-height:none;scrollbar-width:none}.doboard_task_widget-content::-webkit-scrollbar{display:none}.doboard_task_widget-all_issues-container,.doboard_task_widget-concrete_issues-container{max-height:80vh}}@supports (-webkit-overflow-scrolling:touch){.doboard_task_widget{position:fixed}}.doboard_task_widget_tasks_list{background-color:#fff;position:sticky;bottom:0;height:38px;display:flex;flex-direction:column-reverse;align-items:center;padding-bottom:8px}#doboard_task_widget-user_menu-logout_button{display:inline-flex;align-items:center}.doboard_task_widget-text_selection{position:relative;display:inline-block}.doboard_task_widget-see-task{cursor:pointer;text-decoration:underline}.doboard_task_widget-text_selection_tooltip{position:absolute;bottom:100%;left:50%;transform:translateX(-50%);background:#FFF;color:#000;padding:4px 8px;border-radius:4px;font-size:10px;white-space:nowrap;z-index:9000;border:1px solid #BBC7D1;margin-bottom:8px}.doboard_task_widget-text_selection_tooltip::after{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:5px solid transparent;border-top-color:#FFF}.doboard_task_widget-text_selection_tooltip::before{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:6px solid transparent;border-top-color:#BBC7D1;z-index:-1}.doboard_task_widget-text_selection_tooltip_icon{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDEwMyAxMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDEwMyAxMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+DQoJLnN0MHtmaWxsLXJ1bGU6ZXZlbm9kZDtjbGlwLXJ1bGU6ZXZlbm9kZDtmaWxsOiMxNzcyNTA7fQ0KPC9zdHlsZT4NCjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik01MywwSDB2MTAwaDMwLjJINTNDMTE5LjYsMTAwLDExOS42LDAsNTMsMHogTTMwLjIsMTAwYy0xNi42LDAtMzAtMTMuNC0zMC0zMHMxMy40LTMwLDMwLTMwDQoJYzE2LjYsMCwzMCwxMy40LDMwLDMwUzQ2LjgsMTAwLDMwLjIsMTAweiIvPg0KPC9zdmc+DQo=);background-repeat:no-repeat;width:22px;height:22px;margin:5px 3px}.doboard_task_widget-text_selection_tooltip_element{display:flex;justify-content:space-between}.toggle{position:relative;display:inline-block;width:46px;height:28px}.toggle input{opacity:0;width:0;height:0;position:absolute}.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#bbc7d1;border-radius:24px;transition:.3s}.slider:before{content:\"\";position:absolute;height:24px;width:24px;left:2px;top:2px;background-color:#fff;border-radius:50%;transition:.3s}input:checked+.slider{background-color:#65d4ac}input:checked+.slider:before{transform:translateX(16px)}.logout_button{font-weight:500;font-size:14px;color:#707A83;cursor:pointer}`;\n/**\r\n * File uploader handler for managing file attachments with validation and upload capabilities\r\n */\r\nclass FileUploader {\r\n    /**\r\n     * Create a new FileUploader instance\r\n     * @param {function} escapeHtmlHandler - Function to escape HTML strings for security\r\n     */\r\n    constructor(escapeHtmlHandler) {\r\n        /** @type {Array<{id: string, file: File}>} */\r\n        this.files = [];\r\n\r\n        /** @type {number} Maximum allowed file size in bytes */\r\n        this.maxFileSize = 5 * 1024 * 1024; // 5MB\r\n\r\n        /** @type {number} Maximum total size for all files in bytes */\r\n        this.maxTotalSize = 25 * 1024 * 1024; // 25MB\r\n\r\n        /** @type {number} Maximum number of files allowed */\r\n        this.maxFiles = 5;\r\n\r\n        /** @type {string[]} Allowed MIME types for files */\r\n        this.allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'application/pdf', 'text/plain', 'application/msword'];\r\n\r\n        /** @type {function} HTML escaping function for XSS protection */\r\n        this.escapeHtmlHandler = escapeHtmlHandler;\r\n\r\n        /** @type {string[]} File size units for display */\r\n        this.SIZE_UNITS = ['Bytes', 'KB', 'MB', 'GB'];\r\n    }\r\n\r\n    /**\r\n     * Initialize elements and bindings. Should be called only for comments.\r\n     * @returns {void}\r\n     */\r\n    init() {\r\n        this.initializeElements();\r\n        this.bindFilesInputChange();\r\n    }\r\n\r\n    /**\r\n     * Define widget elements to work with uploader.\r\n     * @returns {void}\r\n     */\r\n    initializeElements() {\r\n        /** @type {HTMLInputElement|null} */\r\n        this.fileInput = document.getElementById('doboard_task_widget__file-upload__file-input-button');\r\n\r\n        /** @type {HTMLElement|null} */\r\n        this.fileList = document.getElementById('doboard_task_widget__file-upload__file-list');\r\n\r\n        this.uploaderWrapper = document.getElementById('doboard_task_widget__file-upload__wrapper');\r\n\r\n        /** @type {HTMLElement|null} */\r\n        this.errorMessage = document.getElementById('doboard_task_widget__file-upload__error');\r\n\r\n        if (!this.fileInput || !this.fileList || !this.errorMessage || this.uploaderWrapper) {\r\n            console.warn('File uploader elements not found');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Define hidden file input change to run uploader logic.\r\n     * @returns {void}\r\n     */\r\n    bindFilesInputChange() {\r\n        if (this.fileInput) {\r\n            this.fileInput.addEventListener('change', (e) => this.handleFileInputChange(e));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Bind action to paperclip button.\r\n     * @param {HTMLElement} element - The paperclip button element\r\n     * @returns {void}\r\n     */\r\n    bindPaperClipAction(element) {\r\n        element.addEventListener('click', (e) => {\r\n            e.preventDefault();\r\n            if (this.fileInput) {\r\n                this.fileInput.click();\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Handle file input change event\r\n     * @param {Event} event - File input change event\r\n     * @returns {void}\r\n     */\r\n    handleFileInputChange(event) {\r\n        this.clearError();\r\n\r\n        const selectedFiles = Array.from(event.target.files);\r\n        if (this.files.length + selectedFiles.length > this.maxFiles) {\r\n            this.showError(`Maximum ${this.maxFiles} files can be attached.`);\r\n            return;\r\n        }\r\n        const validFiles = selectedFiles.filter(file => this.validateFile(file));\r\n\r\n        validFiles.forEach(file => this.addFile(file));\r\n\r\n        // Reset input to allow selecting same files again\r\n        event.target.value = '';\r\n\r\n        // show wrapper\r\n        this.uploaderWrapper.style.display = 'block';\r\n    }\r\n\r\n    /**\r\n     * Validate a file against upload constraints\r\n     * @param {File} file - File to validate\r\n     * @returns {boolean} True if file is valid, false otherwise\r\n     */\r\n    validateFile(file) {\r\n        // Check file size\r\n        if (file.size > this.maxFileSize) {\r\n            this.showError(`File \"${file.name}\" is too large. Maximum size: ${this.formatFileSize(this.maxFileSize)}`);\r\n            return false;\r\n        }\r\n\r\n        // Check total size\r\n        const totalSize = this.getTotalSize() + file.size;\r\n        if (totalSize > this.maxTotalSize) {\r\n            this.showError(`Total files size exceeded. Maximum: ${this.formatFileSize(this.maxTotalSize)}`);\r\n            return false;\r\n        }\r\n\r\n        // Check file type\r\n        if (this.allowedTypes.length > 0 && !this.allowedTypes.includes(file.type)) {\r\n            this.showError(`File type \"${file.type}\" for \"${file.name}\" is not supported.`);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Calculate total size of all files\r\n     * @returns {number} Total size in bytes\r\n     */\r\n    getTotalSize() {\r\n        return this.files.reduce((sum, fileData) => sum + fileData.file.size, 0);\r\n    }\r\n\r\n    /**\r\n     * Add a file to the upload queue\r\n     * @param {File} file - File to add\r\n     * @returns {void}\r\n     */\r\n    addFile(file) {\r\n        const fileWithId = {\r\n            id: this.generateFileId(),\r\n            file: file\r\n        };\r\n\r\n        this.files.push(fileWithId);\r\n        this.renderFileList();\r\n    }\r\n\r\n    /**\r\n     * Generate a unique file ID\r\n     * @returns {string} Unique file identifier\r\n     * @private\r\n     */\r\n    generateFileId() {\r\n        return Date.now() + Math.random().toString(36).substr(2, 9);\r\n    }\r\n\r\n    /**\r\n     * Remove a file from the upload queue\r\n     * @param {string} fileId - ID of the file to remove\r\n     * @returns {void}\r\n     */\r\n    removeFile(fileId) {\r\n        this.files = this.files.filter(f => f.id !== fileId);\r\n        this.renderFileList();\r\n        this.clearError();\r\n    }\r\n\r\n    /**\r\n     * Render the file list in the UI\r\n     * @returns {void}\r\n     */\r\n    renderFileList() {\r\n        if (!this.fileList) return;\r\n\r\n        if (this.files.length === 0) {\r\n            this.fileList.innerHTML = ksesFilter('<div style=\"text-align: center; color: #444c529e;\">No files attached</div>');\r\n            return;\r\n        }\r\n\r\n        const fileItems = this.files.map(fileData => this.createFileItem(fileData));\r\n        this.fileList.innerHTML = ksesFilter('');\r\n        fileItems.forEach(item => this.fileList.appendChild(item));\r\n    }\r\n\r\n    /**\r\n     * Create file item element for display\r\n     * @param {object} fileData - File data object\r\n     * @param {string} fileData.id - File identifier\r\n     * @param {File} fileData.file - File object\r\n     * @returns {HTMLDivElement} File item DOM element\r\n     */\r\n    createFileItem(fileData) {\r\n        const { file, id } = fileData;\r\n        const fileItem = document.createElement('div');\r\n        fileItem.className = 'doboard_task_widget__file-upload__file-item';\r\n\r\n        fileItem.innerHTML = ksesFilter(`\r\n            <div class=\"doboard_task_widget__file-upload__file-item-content\">\r\n                <div class=\"doboard_task_widget__file-upload__file_info\">\r\n                    <div class=\"doboard_task_widget__file-upload__file-name\">${this.escapeHtmlHandler(String(file.name))}</div>\r\n                    <div class=\"doboard_task_widget__file-upload__file_size\">${this.formatFileSize(file.size)}</div>\r\n                </div>\r\n            </div>\r\n            <button type=\"button\" class=\"doboard_task_widget__file-upload__remove-btn\" data-file-id=\"${id}\" aria-label=\"Remove file\"></button>\r\n        `);\r\n\r\n        const removeBtn = fileItem.querySelector('.doboard_task_widget__file-upload__remove-btn');\r\n        removeBtn.addEventListener('click', () => this.removeFile(id));\r\n\r\n        return fileItem;\r\n    }\r\n\r\n    /**\r\n     * Format file size for display\r\n     * @param {number} bytes - File size in bytes\r\n     * @returns {string} Formatted file size string\r\n     */\r\n    formatFileSize(bytes) {\r\n        if (bytes === 0) return '0 Bytes';\r\n\r\n        const k = 1024;\r\n        const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n\r\n        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + this.SIZE_UNITS[i];\r\n    }\r\n\r\n    /**\r\n     * Show uploader error message\r\n     * @param {string} message - Error message to display\r\n     * @returns {void}\r\n     */\r\n    showError(message) {\r\n        if (this.errorMessage) {\r\n            this.errorMessage.textContent = message;\r\n            this.errorMessage.style.display = 'block';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear uploader error message\r\n     * @returns {void}\r\n     */\r\n    clearError() {\r\n        if (this.errorMessage) {\r\n            this.errorMessage.textContent = '';\r\n            this.errorMessage.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if there are files to send\r\n     * @returns {boolean} True if files are present, false otherwise\r\n     */\r\n    hasFiles() {\r\n        return this.files.length > 0;\r\n    }\r\n\r\n    /**\r\n     * Clear all files from upload queue\r\n     * @returns {void}\r\n     */\r\n    clearFiles() {\r\n        this.files = [];\r\n        this.renderFileList();\r\n    }\r\n\r\n    /**\r\n     * Validate file data structure before upload\r\n     * @param {object} fileData - File data object to validate\r\n     * @param {string} fileData.sessionId - Session identifier\r\n     * @param {object} fileData.params - Additional parameters\r\n     * @param {string} fileData.params.accountId - Account identifier\r\n     * @param {string} fileData.params.projectToken - Project token\r\n     * @param {string} fileData.commentId - Comment identifier\r\n     * @param {string} fileData.fileName - File name\r\n     * @param {File} fileData.fileBinary - File binary data\r\n     * @returns {object} Validated file data\r\n     * @throws {Error} When file data validation fails\r\n     */\r\n    validateFileData(fileData) {\r\n        const validations = [\r\n            { field: 'sessionId', type: 'string', message: 'No valid session found.' },\r\n            { field: 'params.accountId', type: 'string', message: 'No valid account ID found.' },\r\n            { field: 'params.projectToken', type: 'string', message: 'No valid project token found.' },\r\n            { field: 'commentId', type: 'string', message: 'No valid commentId found.' },\r\n            { field: 'fileName', type: 'string', message: 'No valid filename found.' }\r\n        ];\r\n\r\n        for (const validation of validations) {\r\n            const value = this.getNestedValue(fileData, validation.field);\r\n            if (!value || typeof value !== validation.type) {\r\n                throw new Error(validation.message);\r\n            }\r\n        }\r\n\r\n        if (!fileData.fileBinary || !(fileData.fileBinary instanceof File)) {\r\n            throw new Error('No valid file object found.');\r\n        }\r\n\r\n        return fileData;\r\n    }\r\n\r\n    /**\r\n     * Helper to get nested object values\r\n     * @param {object} obj - Object to traverse\r\n     * @param {string} path - Dot notation path to value\r\n     * @returns {*} Value at the specified path\r\n     * @private\r\n     */\r\n    getNestedValue(obj, path) {\r\n        return path.split('.').reduce((current, key) => current?.[key], obj);\r\n    }\r\n\r\n    /**\r\n     * Send single file attachment\r\n     * @param {object} fileData - File data for upload\r\n     * @returns {Promise<object>} Upload response\r\n     */\r\n    async sendSingleAttachment(fileData) {\r\n        const validatedFileData = await this.validateFileData(fileData);\r\n        return await attachmentAddDoboard(validatedFileData);\r\n    }\r\n\r\n    /**\r\n     * Send all attachments for a comment\r\n     * @param {object} params - Upload parameters\r\n     * @param {string} sessionId - Session identifier\r\n     * @param {string} commentId - Comment identifier\r\n     * @returns {Promise<object>} Upload results\r\n     */\r\n    async sendAttachmentsForComment(params, sessionId, commentId) {\r\n        /** @type {object} */\r\n        const results = {\r\n            preparedFilesCount: this.files.length,\r\n            sentFilesCount: 0,\r\n            fileResults: [],\r\n            success: true\r\n        };\r\n\r\n        for (let i = 0; i < this.files.length; i++) {\r\n            const fileData = this.files[i];\r\n            /** @type {object} */\r\n            const result = {\r\n                success: false,\r\n                response: null,\r\n                error: null\r\n            };\r\n\r\n            try {\r\n                const attachmentData = {\r\n                    params,\r\n                    sessionId,\r\n                    commentId,\r\n                    fileName: fileData.file.name,\r\n                    fileBinary: fileData.file,\r\n                    attachmentOrder: i\r\n                };\r\n\r\n                const response = await this.sendSingleAttachment(attachmentData);\r\n                result.response = response;\r\n                result.success = response.status === 200;\r\n\r\n                if (result.success) {\r\n                    results.sentFilesCount++;\r\n                }\r\n            } catch (error) {\r\n                result.error = error.message;\r\n            }\r\n\r\n            results.fileResults.push(result);\r\n        }\r\n\r\n        results.success = results.preparedFilesCount === results.sentFilesCount;\r\n        this.clearFiles();\r\n\r\n        return results;\r\n    }\r\n}\r\n\nclass SpotFixTemplatesLoader {\r\n    static getTemplateCode(templateName) {\r\n        const templateMethod = this[templateName];\r\n\r\n        if (typeof templateMethod !== 'function') {\r\n            throw new Error(`Template method '${templateName}' not found`);\r\n        }\r\n\r\n        let template = templateMethod.call(this).trim();\r\n\r\n        return template;\r\n    }\r\n\r\n    static all_issues() {\r\n        return `\r\n<div class=\"doboard_task_widget-container\">\r\n    <div class=\"doboard_task_widget-header\">\r\n        <div style=\"display: flex;align-items: center;gap: 8px;\">\r\n            <img src=\"{{logoDoBoardGreen}}\"  alt=\"\">\r\n            <span>All spots </span>\r\n        </div>\r\n        <div class=\"doboard_task_widget-header-icons\">\r\n            <span id=\"addNewTaskButton\">\r\n                <img src=\"{{iconPlus}}\"  alt=\"\" class=\"doboard_task_widget_cursor-pointer\">\r\n            </span>\r\n            <span id=\"openUserMenuButton\">\r\n                <img src=\"{{iconEllipsesMore}}\"  alt=\"\" class=\"doboard_task_widget_cursor-pointer\">\r\n            </span>\r\n            <span id=\"maximizeWidgetContainer\">\r\n                <img src=\"{{iconMaximize}}\"  alt=\"\" class=\"doboard_task_widget_cursor-pointer\">\r\n            </span>\r\n            <img src=\"{{buttonCloseScreen}}\"  alt=\"\" class=\"doboard_task_widget-close_btn doboard_task_widget_cursor-pointer\">\r\n        </div>\r\n    </div>\r\n    <div class=\"doboard_task_widget-content doboard_task_widget-all_issues\">\r\n        <div class=\"doboard_task_widget-spinner_wrapper_for_containers\">\r\n            <div class=\"doboard_task_widget-spinner_for_containers\"></div>\r\n        </div>\r\n        <div class=\"doboard_task_widget-all_issues-container\">\r\n        </div>\r\n        <div class=\"doboard_task_widget_tasks_list\">\r\n            <a rel=\"nofollow\" target=\"_blank\" href=\"https://doboard.com/spotfix\">\r\n             doBoard / SpotFix\r\n            </a>\r\n        </div>\r\n    </div>\r\n</div>`;\r\n    }\r\n\r\n    static concrete_issue() {\r\n        return `\r\n<div class=\"{{contenerClasess}}\">\r\n    <div class=\"doboard_task_widget-header\">\r\n        <div class=\"doboard_task_widget_return_to_all doboard_task_widget_cursor-pointer\">\r\n            <img src=\"{{chevronBack}}\" alt=\"\" title=\"Return to all spots list\">\r\n            <span title=\"Return to all spots list\"> All {{issuesCounter}}</span>\r\n        </div>\r\n        <div class=\"doboard_task_widget-issue-title\">{{issueTitle}}</div>\r\n        <div class=\"doboard_task_widget-header-icons\">\r\n            <span id=\"addNewTaskButton\">\r\n                <img src=\"{{iconPlus}}\"  alt=\"\" class=\"doboard_task_widget_cursor-pointer\">\r\n            </span>\r\n            <span id=\"openUserMenuButton\">\r\n                <img src=\"{{iconEllipsesMore}}\"  alt=\"\" class=\"doboard_task_widget_cursor-pointer\">\r\n            </span>\r\n            <span id=\"maximizeWidgetContainer\">\r\n                <img src=\"{{iconMaximize}}\"  alt=\"\" class=\"doboard_task_widget_cursor-pointer\">\r\n            </span>\r\n            <img src=\"{{buttonCloseScreen}}\"  alt=\"\" class=\"doboard_task_widget-close_btn doboard_task_widget_cursor-pointer\">\r\n        </div>\r\n    </div>\r\n    <div class=\"doboard_task_widget-content doboard_task_widget-concrete_issue\">\r\n        <div style=\"background-color: #D6DDE3; padding: 12px 16px\">\r\n                <a rel=\"nofollow\" href=\"{{taskPageUrl}}\">{{taskFormattedPageUrl}}</a>\r\n        </div>\r\n        <div class=\"doboard_task_widget-spinner_wrapper_for_containers\">\r\n            <div class=\"doboard_task_widget-spinner_for_containers\"></div>\r\n        </div>\r\n        <div class=\"doboard_task_widget-concrete_issues-container\">\r\n        </div>\r\n        <div class=\"doboard_task_widget-send_message\">\r\n            <div class=\"doboard_task_widget-send_message_elements_wrapper\">\r\n                <button type=\"button\" class=\"doboard_task_widget-send_message_paperclip\">\r\n                    <img src=\"{{buttonPaperClip}}\" alt=\"Attach a file\">\r\n                    <div class=\"doboard_task_widget-paperclip-tooltip\">\r\n                        Upload up to 5 JPG, PNG, GIF, PDF, TXT or DOC files (5MB each, 25MB total).\r\n                    </div>\r\n                </button>\r\n    \r\n                <div class=\"doboard_task_widget-send_message_input_wrapper\">\r\n                    <textarea name=\"doboard_task_widget_message\" class=\"doboard_task_widget-send_message_input\" placeholder=\"Write a message...\"></textarea>\r\n                </div>\r\n    \r\n                <button type=\"button\" class=\"doboard_task_widget-send_message_button\">\r\n                    <img src=\"{{buttonSendMessage}}\" alt=\"Send message\" title=\"Send message\">\r\n                </button>\r\n            </div>\r\n            <div class=\"doboard_task_widget__file-upload__wrapper\" id=\"doboard_task_widget__file-upload__wrapper\">\r\n                <div class=\"doboard_task_widget__file-upload__list-header\">Attached files</div>\r\n                <div class=\"doboard_task_widget__file-upload__file-list\" id=\"doboard_task_widget__file-upload__file-list\"></div>\r\n                <div class=\"doboard_task_widget__file-upload__error\" id=\"doboard_task_widget__file-upload__error\"></div>\r\n                <input type=\"file\" class=\"doboard_task_widget__file-upload__file-input-button\" id=\"doboard_task_widget__file-upload__file-input-button\" multiple accept=\"*/*\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n`;\r\n    }\r\n\r\n    static concrete_issue_day_content() {\r\n        return `\r\n<div class=\"doboard_task_widget-concrete_issue-day_content\">\r\n    <div class=\"doboard_task_widget-concrete_issue_day_content-month_day\">{{dayContentMonthDay}}</div>\r\n    <div class=\"doboard_task_widget-concrete_issue_day_content-messages_wrapper\">{{dayContentMessages}}</div>\r\n    {{statusFixedHtml}}\r\n</div>\r\n`;\r\n    }\r\n\r\n    static concrete_issue_messages() {\r\n        return `\r\n<div class=\"doboard_task_widget-comment_data_wrapper doboard_task_widget-comment_data_{{issueMessageClassOwner}}\">\r\n    <div class=\"{{avatarCSSClass}}\" style=\"{{avatarStyle}}\">\r\n        <span class=\"doboard_task_widget-avatar-initials {{initialsClass}}\">{{taskAuthorInitials}}</span>\r\n    </div>\r\n    <div class=\"doboard_task_widget-comment_text_container\">\r\n        <div class=\"doboard_task_widget-comment_body\">{{commentBody}}</div>\r\n        <div class=\"doboard_task_widget-comment_time\">{{commentTime}}</div>\r\n    </div>\r\n</div>\r\n`;\r\n    }\r\n\r\n    static create_issue() {\r\n        return `\r\n<div class=\"doboard_task_widget-container\">\r\n    <div class=\"doboard_task_widget-header\">\r\n        <div style=\"display: flex;align-items: center;gap: 8px;\">\r\n            <img src=\"{{logoDoBoardGreen}}\"  alt=\"\">\r\n            <span>Report an issue</span>\r\n        </div>\r\n        <div class=\"doboard_task_widget-header-icons\">\r\n            <span id=\"openUserMenuButton\">\r\n                 <img src=\"{{iconEllipsesMore}}\"  alt=\"\" class=\"doboard_task_widget_cursor-pointer\">\r\n            </span>\r\n            <span id=\"maximizeWidgetContainer\">\r\n                <img src=\"{{iconMaximize}}\"  alt=\"\" class=\"doboard_task_widget_cursor-pointer\">\r\n            </span>\r\n            <img src=\"{{buttonCloseScreen}}\"  alt=\"\" class=\"doboard_task_widget-close_btn doboard_task_widget_cursor-pointer\">\r\n        </div>\r\n    </div>\r\n    <div class=\"doboard_task_widget-content doboard_task_widget-create_issue\">\r\n\r\n        <div class=\"doboard_task_widget-element-container\">\r\n            <span>\r\n                Tell us about any issue youre experiencing on <span style=\"color: #000000;\">{{currentDomain}}</span>. \r\n                Youre also welcome to review spelling, grammar, or ask a question related to this page.\r\n            </span>\r\n        </div>\r\n\r\n        <div class=\"doboard_task_widget-input-container\">\r\n            <input id=\"doboard_task_widget-title\" class=\"doboard_task_widget-field\" name=\"title\" value=\"{{selectedText}}\" required>\r\n            <label for=\"doboard_task_widget-title\">Report about</label>\r\n        </div>\r\n\r\n        <div class=\"doboard_task_widget-input-container\">\r\n            <textarea id=\"doboard_task_widget-description\" class=\"doboard_task_widget-field\" name=\"description\" required></textarea>\r\n            <label for=\"doboard_task_widget-description\">Description</label>\r\n        </div>\r\n\r\n        <div class=\"doboard_task_widget-login\">\r\n\r\n            <span>If you want to receive notifications by email write here you email contacts.</span>\r\n\r\n            <div class=\"doboard_task_widget-accordion\">\r\n\r\n                <div class=\"doboard_task_widget-input-container\">\r\n                    <input id=\"doboard_task_widget-user_name\" class=\"doboard_task_widget-field\" type=\"text\" name=\"user_name\">\r\n                    <label for=\"doboard_task_widget-user_name\">Nickname</label>\r\n                </div>\r\n\r\n                <div class=\"doboard_task_widget-input-container\">\r\n                    <input id=\"doboard_task_widget-user_email\" class=\"doboard_task_widget-field\" type=\"email\" name=\"user_email\">\r\n                    <label for=\"doboard_task_widget-user_email\">Email</label>\r\n                </div>\r\n\r\n                <div class=\"doboard_task_widget-input-container hidden\">\r\n                    <input id=\"doboard_task_widget-user_password\" class=\"doboard_task_widget-field\" type=\"password\" name=\"user_password\">\r\n                    <label for=\"doboard_task_widget-user_password\">Password</label>\r\n                </div>\r\n\r\n                <i>Note about DoBoard register and accepting email notifications about tasks have to be here.</i>\r\n\r\n            </div>\r\n\r\n        </div>\r\n\r\n        <div class=\"doboard_task_widget-field\">\r\n            <button id=\"doboard_task_widget-submit_button\" class=\"doboard_task_widget-submit_button\">Submit</button>\r\n        </div>\r\n\r\n        <div class=\"doboard_task_widget-message-wrapper hidden\">\r\n            <span id=\"doboard_task_widget-error_message-header\"></span>\r\n            <div id=\"doboard_task_widget-error_message\"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n`;\r\n    }\r\n\r\n    static list_issues() {\r\n        return `\r\n<div class=\"doboard_task_widget-task_row issue-item {{elementBgCSSClass}}\" data-node-path='[{{nodePath}}]' data-task-id='{{taskId}}'>\r\n    <div class=\"{{avatarCSSClass}}\" style=\"{{avatarStyle}}\">\r\n        <span class=\"doboard_task_widget-avatar-initials {{initialsClass}}\">{{taskAuthorInitials}}</span>\r\n    </div>\r\n    <div class=\"doboard_task_widget-description_container\">\r\n        <div class=\"doboard_task_widget-task_title\">\r\n            <div class=\"doboard_task_widget-task_title-details\">\r\n                <span class=\"doboard_task_widget-task_title-text\">{{taskTitle}}</span>\r\n                <div class=\"doboard_task_widget-task_title_public_status_img\">\r\n                    <img src=\"{{taskPublicStatusImgSrc}}\" alt=\"\" title=\"{{taskPublicStatusHint}}\">\r\n                </div>\r\n                <span class=\"doboard_task_widget-task_title-unread_block {{classUnread}}\"></span>\r\n            </div>\r\n<!--            <div class=\"doboard_task_widget-task_title-last_update_time\">{{taskLastUpdate}}</div>-->\r\n        </div>\r\n        <div class=\"doboard_task_widget-bottom\">\r\n            <div class=\"doboard_task_widget-task_page_url\">\r\n                <img src=\"{{iconLinkChain}}\" />\r\n                <a title=\"The spot is located on this {{taskPageUrl}}\" href=\"{{taskPageUrl}}\">{{taskFormattedPageUrl}}</a>\r\n             </div>\r\n                {{statusFixedHtml}}\r\n        </div>\r\n    </div>\r\n</div>\r\n`;\r\n    }\r\n\r\n    static user_menu() {\r\n        return `\r\n<div class=\"doboard_task_widget-container\">\r\n    <div class=\"doboard_task_widget-user_menu-header\">\r\n        <div class=\"doboard_task_widget-user_menu-header-top\">\r\n            <div id=\"spotfix_back_button\" class=\"doboard_task_widget_cursor-pointer\" \r\n            style=\"display: flex;align-items: center;gap: 8px;\">\r\n                <img src=\"{{chevronBackDark}}\" alt=\"\">\r\n                <span> Back</span>\r\n            </div>\r\n            <div>\r\n                <img src=\"{{buttonCloseScreen}}\"  alt=\"\" class=\"doboard_task_widget-close_btn doboard_task_widget_cursor-pointer\">\r\n            </div>\r\n        </div>\r\n        <div style=\"display: flex; flex-direction: column; align-items: center\">\r\n             <img class=\"doboard_task_widget-user_menu-header-avatar\" src=\"{{avatar}}\" alt=\"\">\r\n             <span style=\"font-size: 16px; font-weight: 700\">{{userName}}</span>\r\n             <span style=\"font-size: 12px;\">{{email}}</span>\r\n             <span id=\"doboard_task_widget-user_menu-signlog_button\">\r\n                 <a style=\"cursor: pointer\" rel=\"nofollow\" target=\"_blank\">Sign up or Log in</a>\r\n             </span>\r\n        </div>\r\n    </div>\r\n    <div class=\"doboard_task_widget-content\" style=\"min-height:200px \">\r\n        <div style=\"height: 392px\">\r\n        <div style=\"position: sticky; top: 0\">\r\n            <div class=\"doboard_task_widget-user_menu-item\">\r\n                <img src=\"{{iconEye}}\" alt=\"\" style=\"margin-right: 12px\">\r\n                <div style=\"display: flex; justify-content: space-between; flex-grow: 1; align-items: center\">\r\n                    <span style=\"display: inline-flex; flex-direction: column\">\r\n                        <span style=\"font-weight: 500; font-size: 14px; color: #252A2F\">\r\n                        Show widget on my screen</span>\r\n                        <span style=\"font-size: 10px; color: #40484F\">\r\n                        The widget will be visible again if you select any text on the site</span>\r\n                    </span>\r\n                    <label class=\"toggle\" style=\"margin-left: 8px\">\r\n                      <input id=\"widget_visibility\" type=\"checkbox\">\r\n                      <span class=\"slider\"></span>\r\n                    </label>\r\n                </div>\r\n            </div>\r\n            <div class=\"doboard_task_widget-user_menu-item\">\r\n                <span id=\"doboard_task_widget-user_menu-logout_button\">\r\n                    <img src=\"{{iconDoor}}\" alt=\"\" style=\"margin-right: 12px; cursor: pointer\">\r\n                    <span class=\"logout_button\">Log out</span>\r\n                </span>\r\n            </div>\r\n        </div>\r\n        </div>\r\n        <div style=\"padding: 16px; font-size: 13px; position: sticky; bottom: 0\">\r\n            <span>{{spotfixVersion}}</span>\r\n            <span>Powered by\r\n            <a rel=\"nofollow\" target=\"_blank\" href=\"https://doboard.com\">\r\n             doBoard\r\n            </a></span>\r\n        </div>\r\n    </div>\r\n</div>`;\r\n    }\r\n\r\n    static wrap() {\r\n        return `\r\n<div class=\"doboard_task_widget-wrap\" style=\"bottom: {{position}}\">\r\n<img src=\"{{iconMarker}}\" />\r\n<!--    <img src=\"{{logoDoBoardWrap}}\" alt=\"Doboard logo\">-->\r\n    <div id=\"doboard_task_widget-task_count\" class=\"hidden\"></div>\r\n</div>`;\r\n    }\r\n\r\n    static wrap_review() {\r\n        return `\r\n<button id=\"doboard_task_widget_button\" class=\"doboard_task_widget-wrap wrap_review\" style=\"bottom: {{position}};\">\r\n<img src=\"{{iconMarker}}\" />\r\n<span id=\"review_content_button_text\">Review content</span>\r\n</button>`;\r\n    }\r\n\r\n    static fixedHtml() {\r\n        return `<p><span class=\"doboard_task_widget-bottom-is-fixed\">Finished</span></p>`;\r\n    }\r\n    static fixedTaskHtml() {\r\n        return `<p class=\"doboard_task_widget-bottom-is-fixed-task-block\"><span class=\"doboard_task_widget-bottom-is-fixed-task\">This issue already fixed</span></p>`;\r\n    }\r\n\r\n}\r\n\nclass SpotFixSVGLoader {\r\n    static loadSVG(svgName) {\r\n        const svgMethod = this[svgName];\r\n\r\n        if (typeof svgMethod !== 'function') {\r\n            throw new Error(`Template method '${svgName}' not found`);\r\n        }\r\n\r\n        return svgMethod.call(this).trim();\r\n    }\r\n\r\n    static getAsRawSVG(svgName) {\r\n        return this.loadSVG(svgName);\r\n    }\r\n\r\n    static getAsDataURI(svgName) {\r\n        const svg = this.loadSVG(svgName);\r\n        return this.svgToDataURI(svg);\r\n    }\r\n\r\n    static svgToDataURI(svgString) {\r\n        const bytes = new TextEncoder().encode(svgString);\r\n        const baseBtoa = btoa(String.fromCharCode(...bytes));\r\n        return `data:image/svg+xml;base64,${baseBtoa}`;\r\n    }\r\n\r\n    static chevronBack() {\r\n        return `\r\n<svg width=\"8\" height=\"14\" viewBox=\"0 0 8 14\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n    <path d=\"M7 13L1 7L7 1\" stroke=\"#252A2F\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n</svg>`;\r\n    }\r\n\r\n    static chevronBackDark() {\r\n        return `\r\n<svg width=\"8\" height=\"14\" viewBox=\"0 0 8 14\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n    <path d=\"M7 13L1 7L7 1\" stroke=\"#252A2F\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n</svg>`;\r\n    }\r\n\r\n    static buttonCloseScreen() {\r\n        return `\r\n<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n<path d=\"M18 6L6 18\" stroke=\"#252A2F\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n<path d=\"M6 6L18 18\" stroke=\"#252A2F\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n</svg>`;\r\n    }\r\n\r\n    static buttonSendMessage() {\r\n        return `\r\n<svg width=\"30\" height=\"30\" viewBox=\"0 0 30 30\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n    <circle cx=\"15\" cy=\"15\" r=\"15\" fill=\"#22A475\"/>\r\n    <g clip-path=\"url(#clip0_458_94)\">\r\n        <path d=\"M22.3337 7.6665L13.167 16.8332\" stroke=\"white\" stroke-width=\"1.66667\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n        <path d=\"M22.3337 7.6665L16.5003 24.3332L13.167 16.8332L5.66699 13.4998L22.3337 7.6665Z\" stroke=\"white\" stroke-width=\"1.66667\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n    </g>\r\n    <defs>\r\n        <clipPath id=\"clip0_458_94\">\r\n            <rect width=\"20\" height=\"20\" fill=\"white\" transform=\"translate(4 6)\"/>\r\n        </clipPath>\r\n    </defs>\r\n</svg>`;\r\n    }\r\n\r\n    static buttonPaperClip() {\r\n        return `\r\n<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n    <path d=\"M21.4393 11.0499L12.2493 20.2399C11.1235 21.3658 9.5965 21.9983 8.00431 21.9983C6.41213 21.9983 4.88516 21.3658 3.75931 20.2399C2.63347 19.1141 2.00098 17.5871 2.00098 15.9949C2.00098 14.4027 2.63347 12.8758 3.75931 11.7499L12.9493 2.55992C13.6999 1.80936 14.7179 1.3877 15.7793 1.3877C16.8408 1.3877 17.8588 1.80936 18.6093 2.55992C19.3599 3.31048 19.7815 4.32846 19.7815 5.38992C19.7815 6.45138 19.3599 7.46936 18.6093 8.21992L9.40931 17.4099C9.03403 17.7852 8.52504 17.996 7.99431 17.996C7.46359 17.996 6.95459 17.7852 6.57931 17.4099C6.20403 17.0346 5.9932 16.5256 5.9932 15.9949C5.9932 15.4642 6.20403 14.9552 6.57931 14.5799L15.0693 6.09992\" stroke=\"#707A83\" stroke-width=\"1.71429\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n</svg>`;\r\n    }\r\n\r\n    static logoDoBoardGreen() {\r\n        return `\r\n<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M12.3435 1.87294e-10H0V24H7.04064H12.3435C27.8855 24 27.8855 -7.7417e-05 12.3435 1.87294e-10ZM7.04064 24C3.18002 24 0.0503678 20.7764 0.0503678 16.8C0.0503678 12.8236 3.18002 9.6 7.04064 9.6C10.9012 9.6 14.0309 12.8236 14.0309 16.8C14.0309 20.7764 10.9012 24 7.04064 24Z\" fill=\"#1C7857\"/>\r\n</svg>`;\r\n    }\r\n\r\n    static logoDoBoardWrap() {\r\n        return `\r\n<svg width=\"71\" height=\"72\" viewBox=\"0 0 71 72\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n<path d=\"M0.113132 71.1182L0.109378 35.8851C0.106353 28.9195 2.16921 22.1096 6.03703 16.3165C9.90485 10.5235 15.4039 6.00773 21.8385 3.34038C28.2731 0.673036 35.3543 -0.0260367 42.1862 1.33159C49.0182 2.68922 55.2941 6.04255 60.22 10.9674C65.1459 15.8923 68.5006 22.1675 69.8597 28.9991C71.2188 35.8308 70.5212 42.9121 67.8552 49.3473C65.1893 55.7825 60.6746 61.2825 54.8824 65.1515C49.0903 69.0206 42.2807 71.0849 35.3151 71.0834L0.113132 71.1182Z\" fill=\"#1C7857\"/>\r\n<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M37.5152 20H19V56H29.561H37.5152C60.8283 56 60.8283 19.9999 37.5152 20ZM29.561 56C23.77 56 19.0756 51.1647 19.0756 45.2C19.0756 39.2353 23.77 34.4 29.561 34.4C35.3519 34.4 40.0463 39.2353 40.0463 45.2C40.0463 51.1647 35.3519 56 29.561 56Z\" fill=\"white\"/>\r\n</svg>`;\r\n    }\r\n\r\n    static iconSpotPublic() {\r\n        return `\r\n<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n<path d=\"M12.0008 3.00027C7.17178 2.96187 2.97093 7.00382 3.00088 12.0003C2.91808 17.8096 8.71723 22.2578 14.3059 20.7002C24.3554 17.8039 22.5675 3.27107 12.0008 3.00027ZM17.2508 14.9653C16.9608 17.0153 15.9608 18.4703 14.8258 19.4853C14.6508 19.5503 14.4758 19.6103 14.2958 19.6603C14.1558 17.2853 13.0958 16.9203 12.0608 16.5603C10.7322 16.2243 9.99648 15.2916 9.96088 14.0202C9.89083 13.3953 9.82083 12.7453 9.14083 12.2903C8.43083 11.8203 7.81583 11.7753 7.27078 11.7303C6.62578 11.6803 6.15578 11.6453 5.71578 10.8753C4.81578 9.30527 5.90578 7.25027 7.28578 5.54027C8.61078 4.57527 10.2408 4.00027 12.0008 4.00027C12.8538 3.90392 14.0209 4.33902 14.2658 5.08032C14.5767 5.92247 13.1037 6.60767 12.7758 7.39027C12.4607 8.02027 12.6508 8.49527 12.7908 8.84027C12.9208 9.16027 12.9258 9.22027 12.8258 9.32527C12.5558 9.59027 12.1558 9.42527 11.5258 9.13527C10.8908 8.84527 10.1708 8.51527 9.42078 8.76527C7.72903 9.29942 8.01078 11.1962 9.50078 11.2503C9.94588 11.2463 10.8294 10.9818 11.1558 11.2353C11.1958 11.2703 11.2508 11.3353 11.2508 11.5003C11.3243 12.6158 12.6735 12.6987 13.6107 12.2253C14.4508 11.8053 14.5508 11.9053 15.3258 12.6752C16.081 13.5538 17.4843 13.5449 17.2508 14.9653Z\" fill=\"#252A2F\"/>\r\n</svg>`;\r\n    }\r\n\r\n    static iconSpotPrivate() {\r\n        return `\r\n<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n<path d=\"M12.0008 2.99978C7.17178 2.96138 2.97093 7.00333 3.00088 11.9998C2.91808 17.8091 8.71723 22.2573 14.3059 20.6997C24.3554 17.8034 22.5675 3.27058 12.0008 2.99978ZM17.2508 14.9648C16.9608 17.0148 15.9608 18.4698 14.8258 19.4848C14.6508 19.5498 14.4758 19.6098 14.2958 19.6598C14.1558 17.2848 13.0958 16.9198 12.0608 16.5598C10.7322 16.2238 9.99648 15.2911 9.96088 14.0197C9.89083 13.3948 9.82083 12.7448 9.14083 12.2898C8.43083 11.8198 7.81583 11.7748 7.27078 11.7298C6.62578 11.6798 6.15578 11.6448 5.71578 10.8748C4.81578 9.30478 5.90578 7.24978 7.28578 5.53978C8.61078 4.57478 10.2408 3.99978 12.0008 3.99978C12.8538 3.90343 14.0209 4.33853 14.2658 5.07983C14.5767 5.92198 13.1037 6.60718 12.7758 7.38978C12.4607 8.01978 12.6508 8.49478 12.7908 8.83978C12.9208 9.15978 12.9258 9.21978 12.8258 9.32478C12.5558 9.58978 12.1558 9.42478 11.5258 9.13478C10.8908 8.84478 10.1708 8.51478 9.42078 8.76478C7.72903 9.29893 8.01078 11.1957 9.50078 11.2498C9.94588 11.2458 10.8294 10.9813 11.1558 11.2348C11.1958 11.2698 11.2508 11.3348 11.2508 11.4998C11.3243 12.6153 12.6735 12.6982 13.6107 12.2248C14.4508 11.8048 14.5508 11.9048 15.3258 12.6747C16.081 13.5533 17.4843 13.5444 17.2508 14.9648Z\" fill=\"#252A2F\"/>\r\n<path d=\"M4.5001 20.5L21.5 4.5\" stroke=\"white\" stroke-width=\"1.5\"/>\r\n<line x1=\"3.08787\" y1=\"19.8516\" x2=\"21.0879\" y2=\"3.05161\" stroke=\"#252A2F\" stroke-width=\"1.5\"/>\r\n</svg>`;\r\n    }\r\n\r\n    static iconSpotWidgetWrapPencil() {\r\n        return `\r\n<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n<path d=\"M17 2.99981C17.2626 2.73717 17.5744 2.52883 17.9176 2.38669C18.2608 2.24455 18.6286 2.17139 19 2.17139C19.3714 2.17139 19.7392 2.24455 20.0824 2.38669C20.4256 2.52883 20.7374 2.73717 21 2.99981C21.2626 3.26246 21.471 3.57426 21.6131 3.91742C21.7553 4.26058 21.8284 4.62838 21.8284 4.99981C21.8284 5.37125 21.7553 5.73905 21.6131 6.08221C21.471 6.42537 21.2626 6.73717 21 6.99981L7.5 20.4998L2 21.9998L3.5 16.4998L17 2.99981Z\" stroke=\"white\" stroke-width=\"1.7\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n</svg>`;\r\n    }\r\n\r\n    static iconLinkChain() {\r\n        return `<svg width=\"18\" height=\"18\" viewBox=\"0 0 18 18\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n<path d=\"M11.25 5.25H13.5C13.9925 5.25 14.4801 5.347 14.9351 5.53545C15.39 5.72391 15.8034 6.00013 16.1517 6.34835C16.4999 6.69657 16.7761 7.10997 16.9645 7.56494C17.153 8.01991 17.25 8.50754 17.25 9C17.25 9.49246 17.153 9.98009 16.9645 10.4351C16.7761 10.89 16.4999 11.3034 16.1517 11.6517C15.8034 11.9999 15.39 12.2761 14.9351 12.4645C14.4801 12.653 13.9925 12.75 13.5 12.75H11.25M6.75 12.75H4.5C4.00754 12.75 3.51991 12.653 3.06494 12.4645C2.60997 12.2761 2.19657 11.9999 1.84835 11.6517C1.14509 10.9484 0.75 9.99456 0.75 9C0.75 8.00544 1.14509 7.05161 1.84835 6.34835C2.55161 5.64509 3.50544 5.25 4.5 5.25H6.75\" stroke=\"#707A83\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n<path d=\"M6 9H12\" stroke=\"#707A83\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n</svg>`;\r\n    }\r\n\r\n    static iconEllipsesMore() {\r\n        return `<svg width=\"22\" height=\"22\" viewBox=\"0 0 22 22\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n<path d=\"M12 13C12.5523 13 13 12.5523 13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12C11 12.5523 11.4477 13 12 13Z\" stroke=\"#252A2F\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n<path d=\"M12 6C12.5523 6 13 5.55228 13 5C13 4.44772 12.5523 4 12 4C11.4477 4 11 4.44772 11 5C11 5.55228 11.4477 6 12 6Z\" stroke=\"#252A2F\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n<path d=\"M12 20C12.5523 20 13 19.5523 13 19C13 18.4477 12.5523 18 12 18C11.4477 18 11 18.4477 11 19C11 19.5523 11.4477 20 12 20Z\" stroke=\"#252A2F\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n</svg>`;\r\n    }\r\n\r\n    static iconAvatar() {\r\n        return `<svg viewBox=\"0 0 128 128\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" role=\"img\" aria-label=\"xxlarge\">\r\n    <g>\r\n        <circle cx=\"64\" cy=\"64\" r=\"64\" fill=\"#c1c7d0\" />\r\n        <g>\r\n            <path fill=\"#fff\"\r\n                d=\"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z\" />\r\n            <path fill=\"#fff\"\r\n                d=\"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24\" />\r\n        </g>\r\n    </g>\r\n</svg>\r\n`;\r\n    }\r\n\r\n    static iconEye() {\r\n        return `<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n<path d=\"M16.2194 15.0246C16.2119 17.3608 14.3025 19.2659 11.9713 19.2627C9.62876 19.2596 7.71314 17.3327 7.72876 14.9952C7.74439 12.6571 9.66064 10.7565 11.9888 10.7696C14.3275 10.7827 16.2269 12.6933 16.2194 15.0246Z\" fill=\"#252A2F\"/>\r\n<path d=\"M5.06499 9.76998C4.65374 9.05685 4.24999 8.36435 3.85312 7.66748C3.67124 7.3481 3.71062 7.00623 3.94249 6.7581C4.16437 6.5206 4.53687 6.44123 4.81999 6.60935C4.96 6.69248 5.08749 6.82748 5.17249 6.9681C5.54249 7.58185 5.89374 8.20685 6.25249 8.82685C6.29124 8.89373 6.33249 8.95873 6.38124 9.03873C7.91124 8.2956 9.52062 7.87935 11.2256 7.76685C11.2256 7.02498 11.2237 6.3006 11.2262 5.57685C11.2275 5.1956 11.4331 4.90873 11.7619 4.81435C12.25 4.67435 12.715 5.02185 12.7212 5.54435C12.7287 6.19185 12.7231 6.83873 12.7231 7.48623C12.7231 7.57123 12.7231 7.6556 12.7231 7.76623C14.4225 7.87873 16.0331 8.28998 17.5725 9.04185C17.6937 8.83248 17.8094 8.63123 17.9256 8.4306C18.2144 7.93185 18.5 7.4306 18.7925 6.93435C19.0269 6.53685 19.465 6.40935 19.8331 6.6231C20.2019 6.83685 20.3137 7.27998 20.0875 7.67935C19.7337 8.3031 19.3719 8.92123 19.0144 9.54248C18.9725 9.6156 18.9337 9.68998 18.8969 9.7581C19.3437 10.1037 19.8069 10.4119 20.2106 10.785C20.9894 11.5037 21.74 12.2537 22.4906 13.0025C22.7912 13.3025 22.77 13.7669 22.4775 14.0531C22.1831 14.3406 21.7362 14.3456 21.4262 14.0437C20.8787 13.5106 20.3506 12.9581 19.8 12.4275C17.8019 10.5012 15.4112 9.42373 12.6444 9.27498C9.33875 9.09748 6.47437 10.1775 4.08812 12.4875C3.57249 12.9862 3.07062 13.4994 2.56437 14.0075C2.35687 14.2156 2.11374 14.3156 1.82187 14.2462C1.26124 14.1144 1.04187 13.4231 1.45249 13.01C2.56687 11.8887 3.62624 10.7037 4.97562 9.84185C5.00124 9.8256 5.02312 9.80435 5.06499 9.76998Z\" fill=\"#252A2F\"/>\r\n</svg>\r\n`;\r\n    }\r\n\r\n    static iconDoor() {\r\n        return `<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n<path d=\"M22.9287 10.734C22.882 10.6222 22.8151 10.5204 22.7298 10.4352L19.9807 7.68609C19.6223 7.32859 19.043 7.32859 18.6846 7.68609C18.3262 8.04449 18.3262 8.62474 18.6846 8.98224L19.8698 10.1675H14.7493C14.2424 10.1675 13.8326 10.5781 13.8326 11.0841C13.8326 11.5901 14.2424 12.0008 14.7493 12.0008H19.8698L18.6845 13.186C18.3261 13.5444 18.3261 14.1247 18.6845 14.4822C18.8633 14.6618 19.0979 14.7508 19.3326 14.7508C19.5673 14.7508 19.802 14.6619 19.9807 14.4822L22.7298 11.7331C22.8151 11.6487 22.882 11.547 22.9287 11.4343C23.0213 11.2107 23.0213 10.9577 22.9287 10.734Z\" fill=\"#252A2F\"/>\r\n<path d=\"M16.5823 13.8333C16.0754 13.8333 15.6656 14.244 15.6656 14.75V19.3333H11.999V4.66665C11.999 4.2624 11.7332 3.9049 11.3454 3.78849L8.16181 2.83334H15.6656V7.41668C15.6656 7.92268 16.0754 8.33333 16.5823 8.33333C17.0892 8.33333 17.4989 7.92268 17.4989 7.41668V1.91669C17.4989 1.41065 17.0892 1 16.5823 1H1.91567C1.88267 1 1.85333 1.01375 1.82127 1.0174C1.77817 1.022 1.73877 1.0293 1.69752 1.0394C1.60127 1.06415 1.51417 1.10175 1.43262 1.15305C1.41247 1.1659 1.38772 1.1668 1.36847 1.18146C1.36108 1.187 1.35833 1.1971 1.35098 1.2026C1.25108 1.2814 1.16768 1.37765 1.10718 1.49225C1.09433 1.517 1.09158 1.5436 1.08152 1.56925C1.05218 1.6389 1.02012 1.70675 1.00912 1.78375C1.00452 1.81125 1.01277 1.8369 1.01187 1.8635C1.01097 1.88185 0.999023 1.89835 0.999023 1.91665V20.25C0.999023 20.6872 1.30793 21.0631 1.73602 21.1483L10.9027 22.9817C10.9623 22.9945 11.0228 23 11.0823 23C11.2922 23 11.4985 22.9276 11.6635 22.7919C11.8752 22.6178 11.999 22.3583 11.999 22.0833V21.1667H16.5823C17.0892 21.1667 17.4989 20.756 17.4989 20.25V14.75C17.4989 14.244 17.0892 13.8333 16.5823 13.8333Z\" fill=\"#252A2F\"/>\r\n</svg>\r\n`;\r\n    }\r\n\r\n    static iconPlus() {\r\n        return `<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n<path d=\"M11 4.58398V17.4173\" stroke=\"#252A2F\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n<path d=\"M4.58331 11H17.4166\" stroke=\"#252A2F\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n</svg>\r\n`;\r\n    }\r\n\r\n    static iconMaximize() {\r\n        return `<svg width=\"22\" height=\"22\" viewBox=\"0 0 22 22\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n<path d=\"M13.75 2.75H19.25V8.25\" stroke=\"#252A2F\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n<path d=\"M8.25 19.25H2.75V13.75\" stroke=\"#252A2F\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n<path d=\"M19.25 2.75L12.8333 9.16667\" stroke=\"#252A2F\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n<path d=\"M2.75 19.2507L9.16667 12.834\" stroke=\"#252A2F\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n</svg>\r\n`;\r\n    }\r\n\r\n    static iconMarker() {\r\n        return `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\"><image href=\"data:image/png;base64,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\" \r\nheight=\"100%\" width=\"100%\"/></svg>`;\r\n    }\r\n}\r\n\nclass SpotFixSourcesLoader {\r\n\r\n    constructor() {\r\n        this.loadAll();\r\n    }\r\n\r\n    getCSSCode() {\r\n        // global gulp wrapper var\r\n        return spotFixCSS;\r\n    }\r\n\r\n    loadAll() {\r\n        this.loadFonts();\r\n        this.loadCSS();\r\n    };\r\n\r\n    loadFonts() {\r\n        const preconnect_first = document.createElement('link');\r\n        preconnect_first.rel = 'preconnect';\r\n        preconnect_first.href = 'https://fonts.googleapis.com';\r\n        document.head.appendChild(preconnect_first);\r\n\r\n        const preconnect_second = document.createElement('link');\r\n        preconnect_second.rel = 'preconnect';\r\n        preconnect_second.href = 'https://fonts.gstatic.com';\r\n        preconnect_second.crossOrigin = 'crossorigin';\r\n        document.head.appendChild(preconnect_second);\r\n\r\n        const fontLink = document.createElement('link');\r\n        fontLink.rel = 'stylesheet';\r\n        fontLink.href = 'https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap';\r\n        document.head.appendChild(fontLink);\r\n    }\r\n\r\n    loadCSS() {\r\n        const style = document.createElement('style');\r\n        style.setAttribute('id', 'spotfix_css');\r\n        style.textContent = this.getCSSCode();\r\n        document.head.appendChild(style);\r\n    }\r\n}\r\n\ndocument.dispatchEvent(new CustomEvent('spotFixLoaded', {\r\n    detail: {\r\n        timestamp: new Date().toISOString(),\r\n        message: 'All scripts loaded successfully'\r\n    }\r\n}));\r\n"],"names":["DOBOARD_API_URL","spotfixApiCall","async","data","method","accountId","undefined","Error","key","formData","FormData","hasOwnProperty","append","let","endpointUrl","URL","error","response","await","fetch","body","networkError","message","responseBody","json","parseError","operation_status","errorMessage","operation_message","userConfirmEmailDoboard","emailConfirmationToken","email_confirmation_token","encodeURIComponent","result","sessionId","session_id","userId","user_id","email","accounts","operationStatus","createTaskDoboard","taskDetails","project_token","projectToken","project_id","projectId","localStorage","getItem","name","taskTitle","comment","taskDescription","meta","taskMeta","task_type","taskId","task_id","createTaskCommentDoboard","status","commentId","comment_id","attachmentAddDoboard","fileData","params","account_id","filename","fileName","file","fileBinary","attachment_order","attachmentOrder","registerUserDoboard","nickname","pageURL","confirmation_url","botDetectorData","JSON","parse","value","bot_detector_event_token","accountExists","user_email_confirmed","operationMessage","userEmailConfirmed","loginUserDoboard","password","logoutUserDoboard","includes","clearLocalstorageOnLogout","getTasksDoboard","tasks","map","task","taskLastUpdate","updated","taskCreated","created","taskCreatorTaskUser","creator_user_id","taskStatus","storageSaveTasksCount","getTasksCommentsDoboard","comments","commentBody","commentDate","issueTitle","task_name","getUserDoboard","users","userUpdateDoboard","timezone","timestamp","success","getReleaseVersion","length","tag_name","storageSaveSpotfixVersion","err","confirmUserEmail","pendingTaskRaw","setItem","pendingTask","selectedText","description","selectedData","stringify","createdTask","handleCreateTask","removeItem","getTasksFullDetails","currentActiveTaskId","find","item","getUserDetails","currentUserId","sign","window","location","href","addTaskComment","commentText","getUserTasks","getAllTasks","filter","formatDate","dateStr","date","time","dateObj","Date","replace","isNaN","getTime","offsetMinutes","getTimezoneOffset","localDateObj","getMonth","getDate","getHours","toString","padStart","getMinutes","getTaskAuthorDetails","taskAuthorAvatarImgSrc","taskAuthorName","element","getIssuesCounterString","onPageSpotsCount","totalSpotsCount","getAvatarSrc","author","avatar","m","getAuthorName","trim","registerUser","userEmail","userName","then","document","querySelector","innerText","ksesFilter","classList","remove","getElementById","focus","userUpdate","showMessageCallback","catch","loginUser","userPassword","Intl","DateTimeFormat","resolvedOptions","timeZone","spotFixSplitUrl","url","u","domain","segments","reversed","host","pathname","split","Boolean","reverse","push","join","setToggleStatus","rootElement","toggle","checked","addEventListener","timer","setTimeout","hide","clearTimeout","checkLogInOutButtonsVisible","el","style","display","closest","changeSize","container","add","CleanTalkWidgetDoboard","widgetElement","savedIssuesQuantityOnPage","savedIssuesQuantityAll","allTasksData","srcVariables","constructor","type","this","init","buttonCloseScreen","SpotFixSVGLoader","getAsDataURI","iconEllipsesMore","iconPlus","iconMaximize","chevronBack","buttonPaperClip","buttonSendMessage","logoDoBoardGreen","logoDoBoardWrap","iconSpotWidgetWrapPencil","iconMarker","iconSpotPublic","iconSpotPrivate","iconLinkChain","fileUploader","FileUploader","escapeHtml","getParams","urlParams","URLSearchParams","search","emailToken","get","newUrl","storageSetWidgetIsClosed","delete","history","replaceState","title","registrationShowMessage","isWidgetClosed","taskHasSiteOwnerUpdate","storageTasksHasUnreadUpdates","checkIfTasksHasSiteOwnerUpdates","storageSaveTasksUpdateData","storageWidgetCloseIsSet","createWidgetElement","bindWidgetInputsInteractive","script","src","Object","fromEntries","searchParams","entries","bindCreateTaskEvents","submitButton","taskTitleElement","taskDescriptionElement","loginSectionElement","contains","userEmailElement","userNameElement","userPasswordElement","borderColor","disabled","submitTaskResult","submitTask","cursor","needToLogin","isPublic","hideContainersSpinner","showOnlyCurrentPage","widgetContainer","createElement","className","innerHTML","removeAttribute","templateName","tasksFullDetails","templateVariables","config","SpotfixWidgetConfig","position","extraCompact","compact","extraShort","short","regular","extraRegular","tall","extraTall","extra","type_name","currentDomain","hostname","storageGetUserIsDefined","storageGetWidgetIsClosed","verticalPosition","versionFromLS","spotfixVersion","iconEye","iconDoor","chevronBackDark","Array","isArray","e","issueComments","issuesCounter","loadTemplate","appendChild","spotFixRemoveHighlights","selection","getSelection","sessionIdExists","spotFixScrollToNodePath","spotFixGetSelectedData","nodePath","positionWidgetContainer","getTaskCount","widgetElementClasses","currentTarget","spotFixOpenWidget","issuesQuantityOnPage","spotsToBeHighlighted","currentURL","sortedTasks","sort","a","b","aIsHere","i","elTask","taskMetaString","taskData","isFixed","taskFullDetails","avatarData","currentPageURL","taskNodePath","taskPublicStatusImgSrc","taskPublicStatusHint","getAvatarData","getTaskFullDetails","listIssuesTemplateVariables","taskLastMessage","lastMessageText","taskPageUrl","taskFormattedPageUrl","lastMessageTime","sanitizeNodePath","avatarCSSClass","avatarStyle","taskAuthorInitials","initialsClass","classUnread","elementBgCSSClass","statusFixedHtml","storageProvidedTaskHasUnreadUpdates","isSpotHaveToBeHighlighted","spotFixHighlightElements","bindIssuesClick","user","gitHubAppVersion","version","s","issueTitleElement","currentTaskData","String","origin","issuesCommentsContainer","protocol","contenerClasess","dayMessagesData","initIssuerID","storageRemoveUnreadUpdateForTaskID","userIsIssuer","Number","commentUserId","commentAuthorAvatarSrc","commentAuthorName","commentData","commentTime","issueMessageClassOwner","daysWrapperHTML","day","messageId","currentDayMessages","dayMessagesWrapperHTML","localeCompare","currentMessageTemplateVariables","dayContentMonthDay","dayContentMessages","textarea","handleTextareaChange","contentContainer","scrollTo","top","scrollHeight","behavior","sendButton","widgetClass","preventDefault","input","newCommentResponse","alert","hasFiles","attachmentsSendResult","sendAttachmentsForComment","showError","toConsole","console","log","backToAllIssuesController","self","paperclipController","bindPaperClipAction","spotFixShowWidget","querySelectorAll","forEach","getAttribute","showOneTask","taskHighlightData","getTaskHighlightData","variables","template","SpotFixTemplatesLoader","getTemplateCode","placeholder","replacement","isPlaceholderInAttribute","imgFilter","replaceAll","escapedPlaceholder","RegExp","test","unsafe","tasksCountLS","tasksCount","taskCountElement","wrapElementWithSpotfixHighlight","newElement","cloneNode","wrapper","insertAdjacentElement","taskIdToSearch","currentTaskSpotData","accordionController","context","handleScroll","bind","handleResize","messageText","titleSpan","messageDiv","messageWrap","color","widget","widgetCreateIssue","widgetConcreteIssue","scrollY","viewportHeight","innerHeight","selectionAbsoluteTop","getBoundingClientRect","widgetHeight","offsetHeight","bottom","scrollTimeout","resizeTimeout","str","spotFixShowDelayTimeout","SPOTFIX_DEBUG","SPOTFIX_SHOW_DELAY","spotFixInit","SpotFixSourcesLoader","loadBotDetector","id","head","spotFixIsInsideWidget","node","nodeType","Node","ELEMENT_NODE","parentElement","spotFixDebugLog","spinners","getElementsByClassName","containerClassesToShow","containers","tasksDetails","lastComment","dt","avatarSrc","authorName","authorDetails","charAt","toUpperCase","isAnyTaskUpdated","updatedtasksIDS","currentStateOfTask","issuerId","storageCheckTaskUpdate","updatedTaskIDs","lastMessage","updatedTaskId","updatedTaskData","storageAddUnreadUpdateForTaskID","isSelectionCorrect","html","options","allowedTags","strong","em","ul","ol","li","p","br","span","blockquote","pre","div","img","label","button","details","summary","allowedAttrs","doc","DOMParser","parseFromString","childNodes","clean","tag","tagName","toLowerCase","link","alt","target","parentNode","insertBefore","textContent","attributes","attr","attrName","startsWith","readyState","sel","isWrapReviewWidgetExists","focusNode","anchorNode","SPOTFIX_SELECTION_TYPE_TEXT","SPOTFIX_SELECTION_TYPE_IMG","SPOTFIX_SELECTION_TYPE_ELEMENT","spotFixGetSelectionType","range","getRangeAt","commonAncestor","commonAncestorContainer","spotFixGetSelectedImage","startContainer","endContainer","hasTextContent","isTextNode","TEXT_NODE","isCollapsed","collapsed","rangeCount","selectionType","startSelectPosition","endSelectPosition","commonNode","commonNodeElement","startOffset","endOffset","spotFixCalculateNodePath","imgElement","selectedImage","from","children","indexOf","imageUrl","widgetInstance","elementsMap","Map","spot","spotFixIsValidNodePath","spotFixRetrieveNodeFromPath","has","set","spots","spotFixHighlightImageElement","spotFixHighlightNestedElement","spotFixHighlightTextInElement","tooltipTitleText","spotfixHighlightOpen","text","spotSelectedText","markers","startPos","parseInt","endPos","slice","marker","insertText","idClass","cls","path","scrollIntoView","block","spans","affectedParents","Set","elementSelectionClassName","parent","tooltip","firstChild","removeChild","normalize","imageSelectionClassName","every","index","isInteger","imgNode","createTreeWalker","NodeFilter","SHOW_ELEMENT","acceptNode","spotFixIsElementInRange","FILTER_ACCEPT","FILTER_REJECT","nextNode","startElement","spotFixGetElementFromNode","endElement","spotFixIsElementPartiallySelected","spotFixFindNearbyElements","elementRange","createRange","selectNode","compareBoundaryPoints","Range","START_TO_START","END_TO_END","elementRect","rangeRect","right","left","elements","previousElement","previousElementSibling","nextElement","nextElementSibling","sibling","previousSibling","unshift","shift","visible","storedTasks","count","currentLastUpdate","storedTask","storedUnread","spotFixCSS","escapeHtmlHandler","files","maxFileSize","maxTotalSize","maxFiles","allowedTypes","SIZE_UNITS","initializeElements","bindFilesInputChange","fileInput","fileList","uploaderWrapper","warn","handleFileInputChange","click","event","clearError","selectedFiles","validateFile","addFile","size","formatFileSize","getTotalSize","reduce","sum","fileWithId","generateFileId","renderFileList","now","Math","random","substr","removeFile","fileId","f","fileItems","createFileItem","fileItem","bytes","floor","parseFloat","pow","toFixed","clearFiles","validateFileData","validation","field","getNestedValue","File","obj","current","sendSingleAttachment","validatedFileData","results","preparedFilesCount","sentFilesCount","fileResults","attachmentData","templateMethod","call","all_issues","concrete_issue","concrete_issue_day_content","concrete_issue_messages","create_issue","list_issues","user_menu","wrap","wrap_review","fixedHtml","fixedTaskHtml","loadSVG","svgName","svgMethod","getAsRawSVG","svg","svgToDataURI","svgString","TextEncoder","encode","btoa","fromCharCode","iconAvatar","loadAll","getCSSCode","loadFonts","loadCSS","preconnect_first","preconnect_second","rel","fontLink","crossOrigin","setAttribute","dispatchEvent","CustomEvent","detail","toISOString"],"mappings":"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"}